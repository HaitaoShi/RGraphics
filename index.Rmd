--- 
title: "R 语言绘图基础"
subtitle: "R Graphics Foundations"
author: "黄湘云"
date: "`r format(Sys.time(), tz = 'Asia/Taipei', usetz = TRUE)`"
site: bookdown::bookdown_site
documentclass: book
papersize: b5
linestretch: 1.25 # 1.25 倍行间距
#lof: yes
#lot: yes
#indent: 40pt # 段首缩进两个汉字
toccolor: magenta
fontsize: 10pt
secnumdepth: 2
colorlinks: yes
classoption: "UTF8,twoside"
bibliography: [latex/book.bib, latex/refer.bib, packages.bib]
biblio-style: apalike
link-citations: yes
subparagraph: true
compact-title: true
geometry: [b5paper, tmargin=2.5cm, bmargin=2.5cm, lmargin=3.5cm, rmargin=2.5cm]
description: "R Graphics Foundations.R is a language and environment for statistical computing and graphics. R is similar to the award-winning S system, which was developed at Bell Laboratories by John Chambers et al. It provides a wide variety of statistical and graphical techniques (linear and nonlinear modelling, statistical tests, time series analysis, classification, clustering, ...). R is designed as a true computer language with control-flow constructions for iteration and alternation, and it allows users to add additional functionality by defining new functions. For computationally intensive tasks, C, C++ and Fortran code can be linked and called at run time. 学习 R Base Graphics 部分的测试代码，函数各参数含义的查询手册，主要目的是帮助读者读懂参考手册，写作过程分步走：学习知识，记笔记，可写本书上或博客上，博客侧重在某个点的内容扩展上，书籍需要照顾覆盖面，各部分平衡一点，整理心得，再次修改笔记以符合书籍。所有的案例都基于真实数据集，基础R打包的数据集都是真实的，扩展案例就是在规模上进行扩展，选用基础R中的数据，原因是收集清洗真实数据是比较麻烦和费时间的事情"
keywords: ["graphics", "grid", "lattice", "ggplot2"]
# twitter-handle: tom_hengl
# cover-image: figures/f0_web.png
# url: 'http\://soilmapper.org'
# layout: default
# comments: true
---

\mainmatter

`r if (knitr::is_latex_output()) '<!--'` 

# 准备 {#prerequisites}
\index{bookdown}
\index{knitr}
\index{pandoc}

- [字符串处理与正则表达式]{.todo}
- [动手学习Python]{.todo}
- [自然语言处理与Python实现]{.todo}
- [容器技术与 Docker]{.todo}
- [数据结构与算法基础C++]{.todo}


The **bookdown** package [@xie_2015_knitr] can be installed from CRAN or Github:

::: base
This is a _sample_ book written in **Markdown**. You can use anything that Pandoc's Markdown supports, e.g., a math equation $a^2 + b^2 = c^2$.
:::

```{r eval=FALSE,echo=TRUE}
install.packages("bookdown")
# or the development version
# devtools::install_github("rstudio/bookdown")
```

## Why R? {#why-r}

不管是在本科生还是研究生水平的教学中，R 语言都是帮助学习数理统计的[理想平台][why-r]

[why-r]: https://www.ejwagenmakers.com/misc/HortonEtAl2004.pdf

在数据科学领域内，选择 R 的理由

> 1. written by statisticians for statisticians
2. built-in matrix type and matrix manipulations
3. great graphics, both base and CRAN
4. excellent parallelization facilities, etc.  
> --- Norm Matloff[^matloff] 

[^matloff]: 参考博文 R > Python: A Concrete Example 来自 https://matloff.wordpress.com/

## 记号约定 {#conventions}

写作风格，R 包名称都加粗表示，如 **bookdown**， **rmarkdown** 等，软件、编程语言名称保持原样，如 TinyTeX，LyX，TeXLive，R，Python，Stan，C++，SQL等，在代码块中，我们不使用`R>`或`+`，代码输出结果用`#>`注释。**knitr** [@xie_2015_knitr] **bookdown** [@xie_2016_bookdown] 和 Pandoc \index{Pandoc} TinyTeX \index{TinyTeX}，请使用 pdfLaTeX 编译这本书，等宽字体为 [inconsolata](https://ctan.org/pkg/inconsolata) 默认的文本字体为 [Times](https://ctan.org/pkg/mathptmx)

## 本书结构 {#structure-of-book}


## 历史 {#history-of-r}

1. Ross Ihaka

  维基主页 https://en.wikipedia.org/wiki/Ross_Ihaka
  
  Ross Ihaka 的学术族谱
  https://www.stat.auckland.ac.nz/%7Eihaka/downloads/ihaka.pdf
  
  R: Lessons Learned, Directions for the Future.
  https://www.stat.auckland.ac.nz/%7Eihaka/downloads/JSM-Talk.pdf
  
  R语言的前世今生 https://www.cnblogs.com/chenkai/archive/2013/05/16/3082889.html

1. Robert Gentleman

  维基主页 https://en.wikipedia.org/wiki/Robert_Gentleman_(statistician)

## 相关资源 {#related-books}

分为 Github、书籍、课程和博客等四个方面介绍学习 R 语言的资料

* 书籍
   1. 道家的小无相功 穷毕生之力修习小无相功，这是一门内家功夫
      - 高级R语言编程 [Advanced R](https://adv-r.hadley.nz)
      
   1. 编程指南
      - R 语言编程风格指南  [R Style Guide](https://style.tidyverse.org/)
      - 高效R语言编程 [Efficient R programming](https://csgillespie.github.io/efficientR)
   
   1. 开发 R 包
      - 开发 R 包 [R packages](http://r-pkgs.had.co.nz)  [Writing R Extensions](https://cran.r-project.org/doc/manuals/r-release/R-exts.html)
      - Git [Pro Git 中文第二版](https://git-scm.com/book/zh/v2)
      
   1. 数据科学 
      - 数据科学与 R 语言 [R for data science](https://r4ds.had.co.nz/)
      - 可解释的机器学习 [Interpretable Machine Learning: A Guide for Making Black Box Models Explainable](https://christophm.github.io/interpretable-ml-book/)
      - 数据科学入门 [Introduction to Data Science](https://rafalab.github.io/dsbook/) Rafael A. Irizarry
      - 特征工程与特征选择 [Feature Engineering and Selection: A Practical Approach for Predictive Models](http://www.feat.engineering) Max Kuhn and Kjell Johnson
      - 分类与回归：caret 包 [The caret Package](https://topepo.github.io/caret/)
      - 统计机器学习与应用 [An Introduction to Statistical Learning with Applications in R](https://www-bcf.usc.edu/~gareth/ISL/) [PDF](https://www-bcf.usc.edu/~gareth/ISL/ISLR%20Seventh%20Printing.pdf)
      - 机器学习与R语言 [Machine Learning in R](https://mlr.mlr-org.com/)
      - 贝叶斯数据分析 [Bayesian Data Analysis](http://www.stat.columbia.edu/~gelman/book/)
      - 空间点模式：理论与应用 [Spatial Point Patterns: Methodology and Applications with R](https://spatstat.org)
      - 地统计计算与R语言 [Geocomputation with R](https://geocompr.robinlovelace.net/) 
      - 空间微观模拟与R语言 [Spatial Microsimulation with R](https://spatial-microsim-book.robinlovelace.net/) 
      - 应用时间序列分析与R语言 [Time Series Analysis with Applications in R](http://homepage.divms.uiowa.edu/~kchan/TSA.htm)
      - 时间序列预测预测：原理与实践 [Forecasting: Principles and Practice](https://www.otexts.org/fpp2/) [Rob J Hyndman](https://robjhyndman.com/)
      - 时间序列分析及其应用 [Time Series Analysis and Its Applications: With R Examples](https://www.stat.pitt.edu/stoffer/tsa4/)
      - 线性模型与R语言 [Extending the Linear Model with R](http://people.bath.ac.uk/jjf23/ELM/) [Julian Faraway](https://farawaystatistics.wordpress.com/)
      - 统计反思 [Statistical Rethinking](http://xcelab.net/rm/statistical-rethinking/)  [Statistical Rethinking Resources](https://rpruim.github.io/Statistical-Rethinking/)
      - 回归模型策略 [Regression Modeling Strategies](http://biostat.mc.vanderbilt.edu/wiki/Main/RmS)
      - 应用预测建模 [Applied Predictive Modeling](http://appliedpredictivemodeling.com/)
      - 应用回归分析与广义线性模型 [Applied Regression Analysis and Generalized Linear Models](https://socialsciences.mcmaster.ca/jfox/)
   
   1. 数据可视化   
      - 数据可视化基础 [Fundamentals of Data Visualization](https://serialmentor.com/dataviz)
      - 数据可视化与R语言 [Data Visualisation with R --- 100 Examples](http://www.datavisualisation-r.com/)
      - R语言绘图手册 [R Graphics Cookbook](https://github.com/wch/gcookbook) [PDF](https://raw.githubusercontent.com/irichgreen/GCookBook/master/R%20Graphics%20Cookbook.pdf)
      - 数据分析与图形艺术 [ggplot2: Elegant Graphics for Data Analysis](https://link.springer.com/book/10.1007%2F978-3-319-24277-4) [PDF](http://moderngraphics11.pbworks.com/f/ggplot2-Book09hWickham.pdf)
      - 数据可视化：实践指南 [Data Visualization: A practical introduction](https://socviz.co/) [Github](https://github.com/kjhealy/socviz)
      - 可视化数据分析与R语言 [Graphical Data Analysis with R](http://www.gradaanwr.net/)
   
   1. 空间数据分析
      - 时空统计与 R 语言 [Spatio-Temporal Statistics with R](https://spacetimewithr.org/)
      - 地质统计计算与 R 语言 [Geocomputation with R](https://geocompr.robinlovelace.net/)
   
   1. 文本挖掘
      - 初识命令行 [The Unix Workbench](https://seankross.com/the-unix-workbench/)
      - 数据科学与命令行 [Data Science at the Command Line](https://www.datascienceatthecommandline.com/)
      - 字符串处理 [Handling Strings with R](https://www.gastonsanchez.com/r4strings/)
      - 文本挖掘 [Text Mining with R: A Tidy Approach](https://www.tidytextmining.com/)
   
   1. 动态文档
      - 动态文档 [R Markdown: The Definitive Guide](https://bookdown.org/yihui/rmarkdown/)
      - 写作 [bookdown: Authoring Books and Technical Documents with R Markdown](https://bookdown.org/yihui/bookdown)
      - 网站 [blogdown: Creating Websites with R Markdown](https://bookdown.org/yihui/blogdown/)
   
   1. 模型部署
      - Docker 入门 [A Docker Tutorial for Beginners](https://docker-curriculum.com/)
      - Docker 从入门到实践 [docker practice](https://www.gitbook.com/book/yeasy/docker_practice)
   
   1. 学习 R
      - R 安装与管理 [R Installation and Administration](https://cran.r-project.org/doc/manuals/r-release/R-admin.html)
      - R 导论 [An Introduction to R](https://cran.r-project.org/doc/manuals/r-release/R-intro.html)
      - 数据导入导出 [R Data Import/Export](https://cran.r-project.org/doc/manuals/r-release/R-data.html)
      - 高频问题合集 [R-FAQs](https://cran.r-project.org/faqs.html)
   
   1. 学习 Python
      - Python 最佳实践指南 [Hitchhiker's Guide to Python](https://pythonguidecn.readthedocs.io/zh/latest/)

   更多在线书籍合集 https://bookdown.org 还有一个[传送门](http://gen.lib.rus.ec/)，要记住学习 R 语言的天花板不在编程而在统计。可参考 [COPSS大师开设的课程](https://en.wikipedia.org/wiki/COPSS_Presidents'_Award)

* 课程
   1. Tony Cai
      - Fall 2018: STAT 972: [Advanced Topics in Mathematical Statistics](http://www-stat.wharton.upenn.edu/~tcai/Stat972-Syllabus-Fall18.pdf)
   1. Ben Bolker
      - fall 2018: STAT 4/6c03 [Generalized Linear Models](https://bbolker.github.io/stat4c03/) 
      - Morelia 2018 workshop [Generalized Linear/Mixed models](https://bbolker.github.io/morelia_2018)

* 博客
  - [Ilya Kashnitsky](https://ikashnitsky.github.io/)
  - [Max Woolf](https://minimaxir.com/)
  - [Eugene Joh](https://incidental-ideas.org/)
  - [Shirin Glander](https://shirinsplayground.netlify.com/)
  - [Paul Murrell](https://www.stat.auckland.ac.nz/~paul/)
  - [统计之都](https://cosx.org/)
  - [谢益辉](https://yihui.name/)
  - [Simply Statistics](https://simplystatistics.org/)
  - [Edzer Pebesma](https://www.r-spatial.org/)
  - [Data Science Plus](https://datascienceplus.com/)
  - [Stan Core Team](https://mc-stan.org) [case studies](https://mc-stan.org/users/documentation/case-studies.html)
  - [Håvard Rue](http://www.r-inla.org/) Bayesian computing with INLA
  - [R Graph Gallery](https://www.r-graph-gallery.com/)
  - [htmlwidgets Gallery](http://gallery.htmlwidgets.org/)
  - [Jared P. Lander](https://www.jaredlander.com/) R for Everyone 的作者
* 学者
  - [朱力行](http://www.math.hkbu.edu.hk/~lzhu/)
  - [姚琦伟](http://stats.lse.ac.uk/q.yao/)
  - [范剑青](https://orfe.princeton.edu/~jqfan/index.html) [Jianqing Fan-Fudan](http://www.sds.fudan.edu.cn/wp/?p=1695)
  - [蔡天文](http://www-stat.wharton.upenn.edu/~tcai/)
  - [李润泽](http://personal.psu.edu/ril4/)
  - [孟晓犁](https://statistics.fas.harvard.edu/people/xiao-li-meng)

  - [Peter J. Diggle](https://www.lancaster.ac.uk/staff/diggle/)
  - [Rob J Hyndman](https://robjhyndman.com/)
  - [Julian Faraway](https://farawaystatistics.wordpress.com/)
  - [Andrew Gelman](https://andrewgelman.com/)
  - [Norm Matloff](https://matloff.wordpress.com/)
  - [Brian Ripley](http://www.stats.ox.ac.uk/~ripley/)
  - [John Fox](https://socialsciences.mcmaster.ca/jfox/)
  - [Charlie Geyer](http://users.stat.umn.edu/~geyer/)
  - [Michael L. Stein](http://www.stat.uchicago.edu/faculty/stein.shtml)

  - [李航](http://hangli-hl.com)

* 主页
  - [王江浩](https://jianghao.github.io) 地理信息
  - [陈新鹏](https://chenxinpeng.github.io/) 腾讯 AI lab 实习生
  - [于淼](https://yufree.cn/)  加拿大，COS 执行主编
  - [朱雪宁](https://xueningzhu.github.io/) COS主编，李润泽高足
  - [余光创](https://guangchuangyu.github.io/) 生物统计 ggtree 开发者
  - [肖楠](https://nanx.me/)
  - [高策](https://gaocegege.com) 交大，可视化
  - [赵鹏](http://www.pzhao.org/zh/) 德国
  - [高涛](https://joegaotao.github.io)
  
  - [黄晨成](https://liam.page/) TeX 专家
  - [边蓓蕾](http://statsjoke.me) 上届 COS 副主编
  - [郎大为](http://langdawei.com/) 词云 recharts
  - [寇强](http://qkou.info/) Rcpp/mxnet 核心开发者
  - [邱怡轩](https://yixuan.cos.name/cn/) or [Yixuan Qiu-en](https://statr.me/) 普渡大学博后，人称小轩哥
  - [杨洵默](https://tcya.xyz/) 化学码农，谷歌工程师
  - [杜亚蕾](http://yalei.name/) 51talk
  - [冯俊晨](http://www.fengjunchen.com/)
  - [刘思喆](http://www.bjt.name/) 51talk
  - [陈丽云](http://www.loyhome.com/) 落园博主
  - [唐源](https://terrytangyuan.github.io) tensorflow/xgboost/mxnet 活跃贡献者 
  - [WenSui Liu](https://statcompute.wordpress.com/)
  - [Yuling Yao](https://www.yulingyao.com/)
  - [handong1587](https://handong1587.github.io/)

  - [Paula Moraga](https://paula-moraga.github.io) Peter J. Diggle 的学生，研究 Geostatistics 
  - [John MacFarlane](https://johnmacfarlane.net/) Pandoc 开发者
  - [Paul Bürkner](https://paul-buerkner.github.io/) Stan/brms 开发者  
  - [Francesco Bailo](http://www.francescobailo.net/) 空间数据分析

* 搜索
  - [Sci-Hub: removing barriers in the way of science](https://sci-hub.tw/)
  - [书籍传送门](http://gen.lib.rus.ec/) 需要科学上网 http://gen.lib.rus.ec/
  - [Stack Overflow](https://stackoverflow.com/)

* RStudio
  - https://gt.rstudio.com/
  - https://shiny.rstudio.com/
  - https://db.rstudio.com
  - https://spark.rstudio.com/
  - https://tensorflow.rstudio.com/
  - https://keras.rstudio.com
  - https://rmarkdown.rstudio.com/
  - https://rmarkdown.rstudio.com/flexdashboard/
  
* RStudio 成员出品  
  - https://bookdown.org/yihui/blogdown
  - https://bookdown.org/yihui/bookdown
  - https://rstudio.github.io/reticulate/
  - https://rstudio.github.io/leaflet
  - https://rstudio.github.io/dygraphs/
  - https://rstudio.github.io/DT
  - https://rstudio.github.io/r2d3/
  - https://rstudio.github.io/radix/
  - https://rstudio.github.io/learnr/
  - https://rstudio.github.io/profvis/
  
* tidyverse
  - https://dbplyr.tidyverse.org/
  - https://dplyr.tidyverse.org
  - https://purrr.tidyverse.org/
  - https://lubridate.tidyverse.org
  - https://ggplot2.tidyverse.org
  - https://tidyr.tidyverse.org
  - https://readr.tidyverse.org
  - https://magrittr.tidyverse.org
  - https://stringr.tidyverse.org
  - https://forcats.tidyverse.org
  - https://style.tidyverse.org
  - https://glue.tidyverse.org
  - https://haven.tidyverse.org

* 博客聚合
  - https://rweekly.org/
  - https://www.r-bloggers.com/
  - https://dailyr.netlify.com/
  - https://datascienceplus.com/

## 关于作者 {#about-author}

热心开源事业，目前在统计之都担任副主编 Associated Editor of Captial of Statistics

## 软件信息 {#softwares-rsession-info}

重现本书内容需要的 R 包

```{r,echo=FALSE}
packages = c(
  "colorspace", "magrittr", "bookdown", "rmarkdown",
  "tikzDevice", "fontcm",
  "sp", "maptools", "maps", "mapdata", "mapproj",
  "ggplot2", "devtools", "sf", "rgdal"
)
lapply(packages, function(pkg) {
  if (system.file(package = pkg) == '') install.packages(pkg)
})
```
```{r sessioninfo,echo=TRUE}
xfun::session_info(packages = c(
  "colorspace", "magrittr", "bookdown", "rmarkdown",
  "tikzDevice", "fontcm",
  "sp", "maptools", "maps", "mapdata", "mapproj",
  "ggplot2", "devtools", "sf", "rgdal"
))
```

> 为了重复实现，我准备了一个虚拟机，存放在百度云盘上，链接: <https://pan.baidu.com/s/1K7R55QfFHGu6_QsyUlpCJA> 密码: 2ixt
登陆用户名：xyhuang 密码：cloud

当然，你也可以选择来自 rocker 项目的 Docker 镜像，包含的数据分析环境是 `rocker/verse`

```bash
docker run --name rstudio -d -p 8787:8787 -e ROOT=TRUE \
 -e USER=cloud -e PASSWORD=cloud rocker/verse
```

在本地拉取了一个名叫 rstudio 的镜像，从虚拟机到宿主机的映射端口是，8787 端口是虚拟机中 RStudio IDE 默认占用的，这样就可以在宿主机的浏览器里打开链接 <http://localhost:8787>

```{r include=FALSE}
# automatically create a bib database for R packages
knitr::write_bib(c(
  .packages(), 'bookdown', 'knitr', 'rmarkdown', 'tikzDevice'
), 'packages.bib')
```

`r if (knitr::is_latex_output()) '-->'`
