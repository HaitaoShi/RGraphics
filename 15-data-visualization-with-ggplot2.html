<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>第 14 章 数据可视化 | 数据可视化与R语言</title>
  <meta name="description" content="学习 R Graphics 部分的测试代码，函数各参数含义的查询手册，主要目的是帮助读者读懂参考手册，写作过程分步走：学习知识，记笔记，可写本书上，博客侧重在某个点的内容扩展上，书籍需要照顾覆盖面，各部分平衡一点，整理心得，再次修改笔记以符合书籍。所有的案例都基于真实数据集，基础 R 打包的数据集都是真实的，扩展案例就是在规模上进行扩展，选用基础 R 中的数据，原因是收集清洗真实数据是比较麻烦和费时间的事情。数据操作和数据清理部分以Base R为主，在sidebar中给出tidyverse的等价表示。数据可视化部分以ggplot2为主，在sidebar中给出Base R的等价表示" />
  <meta name="generator" content="bookdown 0.11 and GitBook 2.6.7" />

  <meta property="og:title" content="第 14 章 数据可视化 | 数据可视化与R语言" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://bookdown.org/xiangyun/RGraphics/" />
  
  <meta property="og:description" content="学习 R Graphics 部分的测试代码，函数各参数含义的查询手册，主要目的是帮助读者读懂参考手册，写作过程分步走：学习知识，记笔记，可写本书上，博客侧重在某个点的内容扩展上，书籍需要照顾覆盖面，各部分平衡一点，整理心得，再次修改笔记以符合书籍。所有的案例都基于真实数据集，基础 R 打包的数据集都是真实的，扩展案例就是在规模上进行扩展，选用基础 R 中的数据，原因是收集清洗真实数据是比较麻烦和费时间的事情。数据操作和数据清理部分以Base R为主，在sidebar中给出tidyverse的等价表示。数据可视化部分以ggplot2为主，在sidebar中给出Base R的等价表示" />
  <meta name="github-repo" content="XiangyunHuang/RGraphics" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="第 14 章 数据可视化 | 数据可视化与R语言" />
  
  <meta name="twitter:description" content="学习 R Graphics 部分的测试代码，函数各参数含义的查询手册，主要目的是帮助读者读懂参考手册，写作过程分步走：学习知识，记笔记，可写本书上，博客侧重在某个点的内容扩展上，书籍需要照顾覆盖面，各部分平衡一点，整理心得，再次修改笔记以符合书籍。所有的案例都基于真实数据集，基础 R 打包的数据集都是真实的，扩展案例就是在规模上进行扩展，选用基础 R 中的数据，原因是收集清洗真实数据是比较麻烦和费时间的事情。数据操作和数据清理部分以Base R为主，在sidebar中给出tidyverse的等价表示。数据可视化部分以ggplot2为主，在sidebar中给出Base R的等价表示" />
  

<meta name="author" content="黄湘云" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
<link rel="prev" href="14-data-visualization-with-plot3d.html">
<link rel="next" href="16-data-visualization-with-colors-fonts.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css\style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">数据可视化与R语言</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>欢迎</a></li>
<li class="chapter" data-level="" data-path="01-preface.html"><a href="01-preface.html"><i class="fa fa-check"></i>前言</a><ul>
<li class="chapter" data-level="" data-path="01-preface.html"><a href="01-preface.html#what-talk-about"><i class="fa fa-check"></i>关于本书</a></li>
<li class="chapter" data-level="" data-path="01-preface.html"><a href="01-preface.html#structure-of-book"><i class="fa fa-check"></i>本书结构</a></li>
<li class="chapter" data-level="" data-path="01-preface.html"><a href="01-preface.html#about-author"><i class="fa fa-check"></i>关于作者</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="02-introduction.html"><a href="02-introduction.html"><i class="fa fa-check"></i><b>1</b> 介绍</a><ul>
<li class="chapter" data-level="1.1" data-path="02-introduction.html"><a href="02-introduction.html#why-r"><i class="fa fa-check"></i><b>1.1</b> Why R</a></li>
<li class="chapter" data-level="1.2" data-path="02-introduction.html"><a href="02-introduction.html#who-read-this-book"><i class="fa fa-check"></i><b>1.2</b> 目标读者</a></li>
<li class="chapter" data-level="1.3" data-path="02-introduction.html"><a href="02-introduction.html#Getting-Help-with-R"><i class="fa fa-check"></i><b>1.3</b> 获取帮助</a></li>
<li class="chapter" data-level="1.4" data-path="02-introduction.html"><a href="02-introduction.html#history-of-r"><i class="fa fa-check"></i><b>1.4</b> 发展历史</a></li>
<li class="chapter" data-level="1.5" data-path="02-introduction.html"><a href="02-introduction.html#conventions"><i class="fa fa-check"></i><b>1.5</b> 记号约定</a></li>
<li class="chapter" data-level="1.6" data-path="02-introduction.html"><a href="02-introduction.html#softwares-rsession-info"><i class="fa fa-check"></i><b>1.6</b> 软件信息</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="03-setup.html"><a href="03-setup.html"><i class="fa fa-check"></i><b>2</b> 安装与配置</a><ul>
<li class="chapter" data-level="2.1" data-path="03-setup.html"><a href="03-setup.html#repo-install"><i class="fa fa-check"></i><b>2.1</b> 仓库安装</a><ul>
<li class="chapter" data-level="2.1.1" data-path="03-setup.html"><a href="03-setup.html#ubuntu"><i class="fa fa-check"></i><b>2.1.1</b> Ubuntu</a></li>
<li class="chapter" data-level="2.1.2" data-path="03-setup.html"><a href="03-setup.html#centos"><i class="fa fa-check"></i><b>2.1.2</b> CentOS</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="03-setup.html"><a href="03-setup.html#source-install"><i class="fa fa-check"></i><b>2.2</b> 源码安装</a><ul>
<li class="chapter" data-level="2.2.1" data-path="03-setup.html"><a href="03-setup.html#ubuntu-1"><i class="fa fa-check"></i><b>2.2.1</b> Ubuntu</a></li>
<li class="chapter" data-level="2.2.2" data-path="03-setup.html"><a href="03-setup.html#centos-1"><i class="fa fa-check"></i><b>2.2.2</b> CentOS</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="03-setup.html"><a href="03-setup.html#ninja-install"><i class="fa fa-check"></i><b>2.3</b> 忍者安装</a></li>
<li class="chapter" data-level="2.4" data-path="03-setup.html"><a href="03-setup.html#settings"><i class="fa fa-check"></i><b>2.4</b> 配置</a><ul>
<li class="chapter" data-level="2.4.1" data-path="03-setup.html"><a href="03-setup.html#init-session"><i class="fa fa-check"></i><b>2.4.1</b> 初始会话 <code>.Rprofile</code></a></li>
<li class="chapter" data-level="2.4.2" data-path="03-setup.html"><a href="03-setup.html#environ-vars"><i class="fa fa-check"></i><b>2.4.2</b> 环境变量 <code>.Renviron</code></a></li>
<li class="chapter" data-level="2.4.3" data-path="03-setup.html"><a href="03-setup.html#make-vars"><i class="fa fa-check"></i><b>2.4.3</b> 编译选项 <code>Makevars</code></a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="03-setup.html"><a href="03-setup.html#command-line-arguments"><i class="fa fa-check"></i><b>2.5</b> 命令行参数</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="04-file-system.html"><a href="04-file-system.html"><i class="fa fa-check"></i><b>3</b> 文件管理员</a><ul>
<li class="chapter" data-level="3.1" data-path="04-file-system.html"><a href="04-file-system.html#list"><i class="fa fa-check"></i><b>3.1</b> 查看文件</a></li>
<li class="chapter" data-level="3.2" data-path="04-file-system.html"><a href="04-file-system.html#manipulation"><i class="fa fa-check"></i><b>3.2</b> 操作文件</a></li>
<li class="chapter" data-level="3.3" data-path="04-file-system.html"><a href="04-file-system.html#compression"><i class="fa fa-check"></i><b>3.3</b> 压缩文件</a></li>
<li class="chapter" data-level="3.4" data-path="04-file-system.html"><a href="04-file-system.html#paths"><i class="fa fa-check"></i><b>3.4</b> 路径操作</a></li>
<li class="chapter" data-level="3.5" data-path="04-file-system.html"><a href="04-file-system.html#find"><i class="fa fa-check"></i><b>3.5</b> 查找文件</a></li>
<li class="chapter" data-level="3.6" data-path="04-file-system.html"><a href="04-file-system.html#permissions"><i class="fa fa-check"></i><b>3.6</b> 文件权限</a></li>
<li class="chapter" data-level="3.7" data-path="04-file-system.html"><a href="04-file-system.html#locale"><i class="fa fa-check"></i><b>3.7</b> 区域设置</a></li>
<li class="chapter" data-level="3.8" data-path="04-file-system.html"><a href="04-file-system.html#process"><i class="fa fa-check"></i><b>3.8</b> 进程管理</a></li>
<li class="chapter" data-level="3.9" data-path="04-file-system.html"><a href="04-file-system.html#system-commands"><i class="fa fa-check"></i><b>3.9</b> 系统命令</a></li>
<li class="chapter" data-level="3.10" data-path="04-file-system.html"><a href="04-file-system.html#time"><i class="fa fa-check"></i><b>3.10</b> 时间管理</a></li>
<li class="chapter" data-level="3.11" data-path="04-file-system.html"><a href="04-file-system.html#package"><i class="fa fa-check"></i><b>3.11</b> R 包管理</a></li>
<li class="chapter" data-level="3.12" data-path="04-file-system.html"><a href="04-file-system.html#lookup-function"><i class="fa fa-check"></i><b>3.12</b> 查找函数</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="05-data-object.html"><a href="05-data-object.html"><i class="fa fa-check"></i><b>4</b> 对象在哪里</a><ul>
<li class="chapter" data-level="4.1" data-path="05-data-object.html"><a href="05-data-object.html#oop-vector"><i class="fa fa-check"></i><b>4.1</b> 向量</a></li>
<li class="chapter" data-level="4.2" data-path="05-data-object.html"><a href="05-data-object.html#oop-matrix"><i class="fa fa-check"></i><b>4.2</b> 矩阵</a></li>
<li class="chapter" data-level="4.3" data-path="05-data-object.html"><a href="05-data-object.html#oop-array"><i class="fa fa-check"></i><b>4.3</b> 数组</a></li>
<li class="chapter" data-level="4.4" data-path="05-data-object.html"><a href="05-data-object.html#oop-data.frame"><i class="fa fa-check"></i><b>4.4</b> 数据框</a></li>
<li class="chapter" data-level="4.5" data-path="05-data-object.html"><a href="05-data-object.html#oop-table"><i class="fa fa-check"></i><b>4.5</b> 表格</a></li>
<li class="chapter" data-level="4.6" data-path="05-data-object.html"><a href="05-data-object.html#oop-list"><i class="fa fa-check"></i><b>4.6</b> 列表</a></li>
<li class="chapter" data-level="4.7" data-path="05-data-object.html"><a href="05-data-object.html#oop-ts"><i class="fa fa-check"></i><b>4.7</b> 时间序列</a></li>
<li class="chapter" data-level="4.8" data-path="05-data-object.html"><a href="05-data-object.html#oop-sf"><i class="fa fa-check"></i><b>4.8</b> 空间数据</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="06-data-import-export.html"><a href="06-data-import-export.html"><i class="fa fa-check"></i><b>5</b> 数据搬运工</a><ul>
<li class="chapter" data-level="5.1" data-path="06-data-import-export.html"><a href="06-data-import-export.html#import-data-files"><i class="fa fa-check"></i><b>5.1</b> 导入数据文件</a><ul>
<li class="chapter" data-level="5.1.1" data-path="06-data-import-export.html"><a href="06-data-import-export.html#scan-file"><i class="fa fa-check"></i><b>5.1.1</b> <code>scan</code></a></li>
<li class="chapter" data-level="5.1.2" data-path="06-data-import-export.html"><a href="06-data-import-export.html#read-write-table"><i class="fa fa-check"></i><b>5.1.2</b> <code>read.table</code></a></li>
<li class="chapter" data-level="5.1.3" data-path="06-data-import-export.html"><a href="06-data-import-export.html#read-write-lines"><i class="fa fa-check"></i><b>5.1.3</b> <code>readLines</code></a></li>
<li class="chapter" data-level="5.1.4" data-path="06-data-import-export.html"><a href="06-data-import-export.html#read-save-rds"><i class="fa fa-check"></i><b>5.1.4</b> <code>readRDS</code></a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="06-data-import-export.html"><a href="06-data-import-export.html#load-save"><i class="fa fa-check"></i><b>5.2</b> 保存输出结果</a></li>
<li class="chapter" data-level="5.3" data-path="06-data-import-export.html"><a href="06-data-import-export.html#save-data-object"><i class="fa fa-check"></i><b>5.3</b> 保存数据对象</a></li>
<li class="chapter" data-level="5.4" data-path="06-data-import-export.html"><a href="06-data-import-export.html#other-data-source"><i class="fa fa-check"></i><b>5.4</b> 其它数据格式</a></li>
<li class="chapter" data-level="5.5" data-path="06-data-import-export.html"><a href="06-data-import-export.html#batch-import-data"><i class="fa fa-check"></i><b>5.5</b> 批量导入数据</a></li>
<li class="chapter" data-level="5.6" data-path="06-data-import-export.html"><a href="06-data-import-export.html#batch-export-data"><i class="fa fa-check"></i><b>5.6</b> 批量导出数据</a></li>
<li class="chapter" data-level="5.7" data-path="06-data-import-export.html"><a href="06-data-import-export.html#import-large-csv-files"><i class="fa fa-check"></i><b>5.7</b> 导入大数据集</a></li>
<li class="chapter" data-level="5.8" data-path="06-data-import-export.html"><a href="06-data-import-export.html#import-data-from-database"><i class="fa fa-check"></i><b>5.8</b> 从数据库导入</a><ul>
<li class="chapter" data-level="5.8.1" data-path="06-data-import-export.html"><a href="06-data-import-export.html#rsqlite"><i class="fa fa-check"></i><b>5.8.1</b> RSQLite</a></li>
<li class="chapter" data-level="5.8.2" data-path="06-data-import-export.html"><a href="06-data-import-export.html#postgresql"><i class="fa fa-check"></i><b>5.8.2</b> PostgreSQL</a></li>
<li class="chapter" data-level="5.8.3" data-path="06-data-import-export.html"><a href="06-data-import-export.html#clickhouse"><i class="fa fa-check"></i><b>5.8.3</b> ClickHouse</a></li>
<li class="chapter" data-level="5.8.4" data-path="06-data-import-export.html"><a href="06-data-import-export.html#mysql"><i class="fa fa-check"></i><b>5.8.4</b> MySQL</a></li>
<li class="chapter" data-level="5.8.5" data-path="06-data-import-export.html"><a href="06-data-import-export.html#spark"><i class="fa fa-check"></i><b>5.8.5</b> Spark</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="07-data-rectangling.html"><a href="07-data-rectangling.html"><i class="fa fa-check"></i><b>6</b> 数据异形者</a></li>
<li class="chapter" data-level="7" data-path="08-data-manipulation.html"><a href="08-data-manipulation.html"><i class="fa fa-check"></i><b>7</b> 数据操作手</a><ul>
<li class="chapter" data-level="7.1" data-path="08-data-manipulation.html"><a href="08-data-manipulation.html#show"><i class="fa fa-check"></i><b>7.1</b> 查看数据</a></li>
<li class="chapter" data-level="7.2" data-path="08-data-manipulation.html"><a href="08-data-manipulation.html#base-reshape"><i class="fa fa-check"></i><b>7.2</b> 数据变形</a></li>
<li class="chapter" data-level="7.3" data-path="08-data-manipulation.html"><a href="08-data-manipulation.html#base-transform"><i class="fa fa-check"></i><b>7.3</b> 数据转换</a></li>
<li class="chapter" data-level="7.4" data-path="08-data-manipulation.html"><a href="08-data-manipulation.html#base-subset"><i class="fa fa-check"></i><b>7.4</b> 提取子集</a></li>
<li class="chapter" data-level="7.5" data-path="08-data-manipulation.html"><a href="08-data-manipulation.html#base-order"><i class="fa fa-check"></i><b>7.5</b> 按列排序</a></li>
<li class="chapter" data-level="7.6" data-path="08-data-manipulation.html"><a href="08-data-manipulation.html#base-split"><i class="fa fa-check"></i><b>7.6</b> 数据拆分</a></li>
<li class="chapter" data-level="7.7" data-path="08-data-manipulation.html"><a href="08-data-manipulation.html#base-merge"><i class="fa fa-check"></i><b>7.7</b> 数据合并</a></li>
<li class="chapter" data-level="7.8" data-path="08-data-manipulation.html"><a href="08-data-manipulation.html#base-duplicated"><i class="fa fa-check"></i><b>7.8</b> 数据去重</a></li>
<li class="chapter" data-level="7.9" data-path="08-data-manipulation.html"><a href="08-data-manipulation.html#base-aggregate"><i class="fa fa-check"></i><b>7.9</b> 数据聚合</a></li>
<li class="chapter" data-level="7.10" data-path="08-data-manipulation.html"><a href="08-data-manipulation.html#base-table"><i class="fa fa-check"></i><b>7.10</b> 表格统计</a></li>
<li class="chapter" data-level="7.11" data-path="08-data-manipulation.html"><a href="08-data-manipulation.html#base-index"><i class="fa fa-check"></i><b>7.11</b> 索引访问</a></li>
<li class="chapter" data-level="7.12" data-path="08-data-manipulation.html"><a href="08-data-manipulation.html#base-array"><i class="fa fa-check"></i><b>7.12</b> 多维数组</a></li>
<li class="chapter" data-level="7.13" data-path="08-data-manipulation.html"><a href="08-data-manipulation.html#base-others"><i class="fa fa-check"></i><b>7.13</b> 其它操作</a><ul>
<li class="chapter" data-level="7.13.1" data-path="08-data-manipulation.html"><a href="08-data-manipulation.html#list-or-unlist"><i class="fa fa-check"></i><b>7.13.1</b> 列表属性</a></li>
<li class="chapter" data-level="7.13.2" data-path="08-data-manipulation.html"><a href="08-data-manipulation.html#stack-or-unstack"><i class="fa fa-check"></i><b>7.13.2</b> 堆叠向量</a></li>
<li class="chapter" data-level="7.13.3" data-path="08-data-manipulation.html"><a href="08-data-manipulation.html#class-or-unclass"><i class="fa fa-check"></i><b>7.13.3</b> 属性转化</a></li>
<li class="chapter" data-level="7.13.4" data-path="08-data-manipulation.html"><a href="08-data-manipulation.html#attach-or-detach"><i class="fa fa-check"></i><b>7.13.4</b> 绑定环境</a></li>
<li class="chapter" data-level="7.13.5" data-path="08-data-manipulation.html"><a href="08-data-manipulation.html#with-or-within"><i class="fa fa-check"></i><b>7.13.5</b> 数据环境</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="09-vector-manipulation.html"><a href="09-vector-manipulation.html"><i class="fa fa-check"></i><b>8</b> 向量化操作</a><ul>
<li class="chapter" data-level="8.1" data-path="09-vector-manipulation.html"><a href="09-vector-manipulation.html#common-operations"><i class="fa fa-check"></i><b>8.1</b> 常用操作</a><ul>
<li class="chapter" data-level="8.1.1" data-path="09-vector-manipulation.html"><a href="09-vector-manipulation.html#tibble-show"><i class="fa fa-check"></i><b>8.1.1</b> 查看</a></li>
<li class="chapter" data-level="8.1.2" data-path="09-vector-manipulation.html"><a href="09-vector-manipulation.html#dplyr-subset"><i class="fa fa-check"></i><b>8.1.2</b> 筛选</a></li>
<li class="chapter" data-level="8.1.3" data-path="09-vector-manipulation.html"><a href="09-vector-manipulation.html#dplyr-order"><i class="fa fa-check"></i><b>8.1.3</b> 排序</a></li>
<li class="chapter" data-level="8.1.4" data-path="09-vector-manipulation.html"><a href="09-vector-manipulation.html#dplyr-aggregate"><i class="fa fa-check"></i><b>8.1.4</b> 聚合</a></li>
<li class="chapter" data-level="8.1.5" data-path="09-vector-manipulation.html"><a href="09-vector-manipulation.html#dplyr-merge"><i class="fa fa-check"></i><b>8.1.5</b> 合并</a></li>
<li class="chapter" data-level="8.1.6" data-path="09-vector-manipulation.html"><a href="09-vector-manipulation.html#dplyr-reshape"><i class="fa fa-check"></i><b>8.1.6</b> 重塑</a></li>
<li class="chapter" data-level="8.1.7" data-path="09-vector-manipulation.html"><a href="09-vector-manipulation.html#dplyr-transform"><i class="fa fa-check"></i><b>8.1.7</b> 变换</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="09-vector-manipulation.html"><a href="09-vector-manipulation.html#common-dataframe-operations"><i class="fa fa-check"></i><b>8.2</b> 高频问题</a><ul>
<li class="chapter" data-level="8.2.1" data-path="09-vector-manipulation.html"><a href="09-vector-manipulation.html#create-empty-dataframe"><i class="fa fa-check"></i><b>8.2.1</b> 初始化数据框</a></li>
<li class="chapter" data-level="8.2.2" data-path="09-vector-manipulation.html"><a href="09-vector-manipulation.html#remove-missing-values"><i class="fa fa-check"></i><b>8.2.2</b> 移除缺失记录</a></li>
<li class="chapter" data-level="8.2.3" data-path="09-vector-manipulation.html"><a href="09-vector-manipulation.html#coerce-data-type"><i class="fa fa-check"></i><b>8.2.3</b> 数据类型转化</a></li>
<li class="chapter" data-level="8.2.4" data-path="09-vector-manipulation.html"><a href="09-vector-manipulation.html#cross-group-by"><i class="fa fa-check"></i><b>8.2.4</b> 跨列分组求和</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="09-vector-manipulation.html"><a href="09-vector-manipulation.html#parallel-computing"><i class="fa fa-check"></i><b>8.3</b> 并行计算</a><ul>
<li class="chapter" data-level="8.3.1" data-path="09-vector-manipulation.html"><a href="09-vector-manipulation.html#apply"><i class="fa fa-check"></i><b>8.3.1</b> apply</a></li>
<li class="chapter" data-level="8.3.2" data-path="09-vector-manipulation.html"><a href="09-vector-manipulation.html#map-reduce"><i class="fa fa-check"></i><b>8.3.2</b> MapReduce</a></li>
<li class="chapter" data-level="8.3.3" data-path="09-vector-manipulation.html"><a href="09-vector-manipulation.html#parallel"><i class="fa fa-check"></i><b>8.3.3</b> parallel</a></li>
<li class="chapter" data-level="8.3.4" data-path="09-vector-manipulation.html"><a href="09-vector-manipulation.html#rmpi"><i class="fa fa-check"></i><b>8.3.4</b> Rmpi</a></li>
<li class="chapter" data-level="8.3.5" data-path="09-vector-manipulation.html"><a href="09-vector-manipulation.html#gpur"><i class="fa fa-check"></i><b>8.3.5</b> gpuR</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="09-vector-manipulation.html"><a href="09-vector-manipulation.html#pipe-manipulation"><i class="fa fa-check"></i><b>8.4</b> 管道操作</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="10-data-cleaning-with-string.html"><a href="10-data-cleaning-with-string.html"><i class="fa fa-check"></i><b>9</b> 字符串操作</a><ul>
<li class="chapter" data-level="9.1" data-path="10-data-cleaning-with-string.html"><a href="10-data-cleaning-with-string.html#base-count"><i class="fa fa-check"></i><b>9.1</b> 字符数统计</a></li>
<li class="chapter" data-level="9.2" data-path="10-data-cleaning-with-string.html"><a href="10-data-cleaning-with-string.html#base-translations"><i class="fa fa-check"></i><b>9.2</b> 字符串翻译</a></li>
<li class="chapter" data-level="9.3" data-path="10-data-cleaning-with-string.html"><a href="10-data-cleaning-with-string.html#base-concatenate"><i class="fa fa-check"></i><b>9.3</b> 字符串连接</a></li>
<li class="chapter" data-level="9.4" data-path="10-data-cleaning-with-string.html"><a href="10-data-cleaning-with-string.html#base-strsplit"><i class="fa fa-check"></i><b>9.4</b> 字符串拆分</a></li>
<li class="chapter" data-level="9.5" data-path="10-data-cleaning-with-string.html"><a href="10-data-cleaning-with-string.html#base-match"><i class="fa fa-check"></i><b>9.5</b> 字符串匹配</a></li>
<li class="chapter" data-level="9.6" data-path="10-data-cleaning-with-string.html"><a href="10-data-cleaning-with-string.html#base-search"><i class="fa fa-check"></i><b>9.6</b> 字符串查询</a></li>
<li class="chapter" data-level="9.7" data-path="10-data-cleaning-with-string.html"><a href="10-data-cleaning-with-string.html#base-replacement"><i class="fa fa-check"></i><b>9.7</b> 字符串替换</a></li>
<li class="chapter" data-level="9.8" data-path="10-data-cleaning-with-string.html"><a href="10-data-cleaning-with-string.html#base-extract"><i class="fa fa-check"></i><b>9.8</b> 字符串提取</a></li>
<li class="chapter" data-level="9.9" data-path="10-data-cleaning-with-string.html"><a href="10-data-cleaning-with-string.html#other-string-op"><i class="fa fa-check"></i><b>9.9</b> 其它字符串操作</a><ul>
<li class="chapter" data-level="9.9.1" data-path="10-data-cleaning-with-string.html"><a href="10-data-cleaning-with-string.html#strwrap"><i class="fa fa-check"></i><b>9.9.1</b> strwrap</a></li>
<li class="chapter" data-level="9.9.2" data-path="10-data-cleaning-with-string.html"><a href="10-data-cleaning-with-string.html#strtrim"><i class="fa fa-check"></i><b>9.9.2</b> strtrim</a></li>
<li class="chapter" data-level="9.9.3" data-path="10-data-cleaning-with-string.html"><a href="10-data-cleaning-with-string.html#strrep"><i class="fa fa-check"></i><b>9.9.3</b> strrep</a></li>
<li class="chapter" data-level="9.9.4" data-path="10-data-cleaning-with-string.html"><a href="10-data-cleaning-with-string.html#trimws"><i class="fa fa-check"></i><b>9.9.4</b> trimws</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="11-data-cleaning-with-stringr.html"><a href="11-data-cleaning-with-stringr.html"><i class="fa fa-check"></i><b>10</b> 数据清洁工</a><ul>
<li class="chapter" data-level="10.1" data-path="11-data-cleaning-with-stringr.html"><a href="11-data-cleaning-with-stringr.html#performance"><i class="fa fa-check"></i><b>10.1</b> 处理性能</a></li>
<li class="chapter" data-level="10.2" data-path="11-data-cleaning-with-stringr.html"><a href="11-data-cleaning-with-stringr.html#Web-crawler"><i class="fa fa-check"></i><b>10.2</b> 网络爬虫</a></li>
<li class="chapter" data-level="10.3" data-path="11-data-cleaning-with-stringr.html"><a href="11-data-cleaning-with-stringr.html#text-mining"><i class="fa fa-check"></i><b>10.3</b> 文本挖掘</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="12-data-cleaning-with-regexp.html"><a href="12-data-cleaning-with-regexp.html"><i class="fa fa-check"></i><b>11</b> 正则表达式</a><ul>
<li class="chapter" data-level="11.1" data-path="12-data-cleaning-with-regexp.html"><a href="12-data-cleaning-with-regexp.html#character-constants"><i class="fa fa-check"></i><b>11.1</b> 字符常量</a></li>
<li class="chapter" data-level="11.2" data-path="12-data-cleaning-with-regexp.html"><a href="12-data-cleaning-with-regexp.html#environments"><i class="fa fa-check"></i><b>11.2</b> 软件环境</a></li>
<li class="chapter" data-level="11.3" data-path="12-data-cleaning-with-regexp.html"><a href="12-data-cleaning-with-regexp.html#foundations"><i class="fa fa-check"></i><b>11.3</b> 基本概念</a></li>
<li class="chapter" data-level="11.4" data-path="12-data-cleaning-with-regexp.html"><a href="12-data-cleaning-with-regexp.html#match"><i class="fa fa-check"></i><b>11.4</b> 字符串匹配</a></li>
<li class="chapter" data-level="11.5" data-path="12-data-cleaning-with-regexp.html"><a href="12-data-cleaning-with-regexp.html#concatenation"><i class="fa fa-check"></i><b>11.5</b> 级联表达式</a></li>
<li class="chapter" data-level="11.6" data-path="12-data-cleaning-with-regexp.html"><a href="12-data-cleaning-with-regexp.html#backreference"><i class="fa fa-check"></i><b>11.6</b> 反向引用</a></li>
<li class="chapter" data-level="11.7" data-path="12-data-cleaning-with-regexp.html"><a href="12-data-cleaning-with-regexp.html#named-capture"><i class="fa fa-check"></i><b>11.7</b> 命名捕捉</a></li>
<li class="chapter" data-level="11.8" data-path="12-data-cleaning-with-regexp.html"><a href="12-data-cleaning-with-regexp.html#comment"><i class="fa fa-check"></i><b>11.8</b> 表达式注释</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="13-data-visualization-with-plot.html"><a href="13-data-visualization-with-plot.html"><i class="fa fa-check"></i><b>12</b> 绘图素材库</a><ul>
<li class="chapter" data-level="12.1" data-path="13-data-visualization-with-plot.html"><a href="13-data-visualization-with-plot.html#elements"><i class="fa fa-check"></i><b>12.1</b> 基本要素</a><ul>
<li class="chapter" data-level="12.1.1" data-path="13-data-visualization-with-plot.html"><a href="13-data-visualization-with-plot.html#base-points"><i class="fa fa-check"></i><b>12.1.1</b> 点线</a></li>
<li class="chapter" data-level="12.1.2" data-path="13-data-visualization-with-plot.html"><a href="13-data-visualization-with-plot.html#base-rect"><i class="fa fa-check"></i><b>12.1.2</b> 区域</a></li>
<li class="chapter" data-level="12.1.3" data-path="13-data-visualization-with-plot.html"><a href="13-data-visualization-with-plot.html#base-lines"><i class="fa fa-check"></i><b>12.1.3</b> 参考线</a></li>
<li class="chapter" data-level="12.1.4" data-path="13-data-visualization-with-plot.html"><a href="13-data-visualization-with-plot.html#base-axis"><i class="fa fa-check"></i><b>12.1.4</b> 坐标轴</a></li>
<li class="chapter" data-level="12.1.5" data-path="13-data-visualization-with-plot.html"><a href="13-data-visualization-with-plot.html#base-title"><i class="fa fa-check"></i><b>12.1.5</b> 标题</a></li>
<li class="chapter" data-level="12.1.6" data-path="13-data-visualization-with-plot.html"><a href="13-data-visualization-with-plot.html#base-annotation"><i class="fa fa-check"></i><b>12.1.6</b> 注释</a></li>
<li class="chapter" data-level="12.1.7" data-path="13-data-visualization-with-plot.html"><a href="13-data-visualization-with-plot.html#base-legend"><i class="fa fa-check"></i><b>12.1.7</b> 图例</a></li>
<li class="chapter" data-level="12.1.8" data-path="13-data-visualization-with-plot.html"><a href="13-data-visualization-with-plot.html#base-par"><i class="fa fa-check"></i><b>12.1.8</b> 边空</a></li>
<li class="chapter" data-level="12.1.9" data-path="13-data-visualization-with-plot.html"><a href="13-data-visualization-with-plot.html#base-layer"><i class="fa fa-check"></i><b>12.1.9</b> 图层</a></li>
<li class="chapter" data-level="12.1.10" data-path="13-data-visualization-with-plot.html"><a href="13-data-visualization-with-plot.html#base-layout"><i class="fa fa-check"></i><b>12.1.10</b> 布局</a></li>
<li class="chapter" data-level="12.1.11" data-path="13-data-visualization-with-plot.html"><a href="13-data-visualization-with-plot.html#base-combine"><i class="fa fa-check"></i><b>12.1.11</b> 组合</a></li>
<li class="chapter" data-level="12.1.12" data-path="13-data-visualization-with-plot.html"><a href="13-data-visualization-with-plot.html#base-screen"><i class="fa fa-check"></i><b>12.1.12</b> 分屏</a></li>
<li class="chapter" data-level="12.1.13" data-path="13-data-visualization-with-plot.html"><a href="13-data-visualization-with-plot.html#identify-locator"><i class="fa fa-check"></i><b>12.1.13</b> 交互</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="13-data-visualization-with-plot.html"><a href="13-data-visualization-with-plot.html#plot-gallary"><i class="fa fa-check"></i><b>12.2</b> 统计图形</a><ul>
<li class="chapter" data-level="12.2.1" data-path="13-data-visualization-with-plot.html"><a href="13-data-visualization-with-plot.html#plot-bar"><i class="fa fa-check"></i><b>12.2.1</b> 条形图</a></li>
<li class="chapter" data-level="12.2.2" data-path="13-data-visualization-with-plot.html"><a href="13-data-visualization-with-plot.html#plot-hist"><i class="fa fa-check"></i><b>12.2.2</b> 直方图</a></li>
<li class="chapter" data-level="12.2.3" data-path="13-data-visualization-with-plot.html"><a href="13-data-visualization-with-plot.html#plot-density"><i class="fa fa-check"></i><b>12.2.3</b> 密度图</a></li>
<li class="chapter" data-level="12.2.4" data-path="13-data-visualization-with-plot.html"><a href="13-data-visualization-with-plot.html#plot-ecdf"><i class="fa fa-check"></i><b>12.2.4</b> 经验图</a></li>
<li class="chapter" data-level="12.2.5" data-path="13-data-visualization-with-plot.html"><a href="13-data-visualization-with-plot.html#plot-qqnorm"><i class="fa fa-check"></i><b>12.2.5</b> QQ 图</a></li>
<li class="chapter" data-level="12.2.6" data-path="13-data-visualization-with-plot.html"><a href="13-data-visualization-with-plot.html#plot-ts"><i class="fa fa-check"></i><b>12.2.6</b> 时序图</a></li>
<li class="chapter" data-level="12.2.7" data-path="13-data-visualization-with-plot.html"><a href="13-data-visualization-with-plot.html#plot-pie"><i class="fa fa-check"></i><b>12.2.7</b> 饼图</a></li>
<li class="chapter" data-level="12.2.8" data-path="13-data-visualization-with-plot.html"><a href="13-data-visualization-with-plot.html#plot-stem-leaf"><i class="fa fa-check"></i><b>12.2.8</b> 茎叶图</a></li>
<li class="chapter" data-level="12.2.9" data-path="13-data-visualization-with-plot.html"><a href="13-data-visualization-with-plot.html#plot-scatter"><i class="fa fa-check"></i><b>12.2.9</b> 散点图</a></li>
<li class="chapter" data-level="12.2.10" data-path="13-data-visualization-with-plot.html"><a href="13-data-visualization-with-plot.html#base-jitter"><i class="fa fa-check"></i><b>12.2.10</b> 抖动图</a></li>
<li class="chapter" data-level="12.2.11" data-path="13-data-visualization-with-plot.html"><a href="13-data-visualization-with-plot.html#plot-box"><i class="fa fa-check"></i><b>12.2.11</b> 箱线图</a></li>
<li class="chapter" data-level="12.2.12" data-path="13-data-visualization-with-plot.html"><a href="13-data-visualization-with-plot.html#error-bars"><i class="fa fa-check"></i><b>12.2.12</b> 残差图</a></li>
<li class="chapter" data-level="12.2.13" data-path="13-data-visualization-with-plot.html"><a href="13-data-visualization-with-plot.html#plot-violin"><i class="fa fa-check"></i><b>12.2.13</b> 提琴图</a></li>
<li class="chapter" data-level="12.2.14" data-path="13-data-visualization-with-plot.html"><a href="13-data-visualization-with-plot.html#plot-contour"><i class="fa fa-check"></i><b>12.2.14</b> 轮廓图</a></li>
<li class="chapter" data-level="12.2.15" data-path="13-data-visualization-with-plot.html"><a href="13-data-visualization-with-plot.html#plot-line"><i class="fa fa-check"></i><b>12.2.15</b> 折线图</a></li>
<li class="chapter" data-level="12.2.16" data-path="13-data-visualization-with-plot.html"><a href="13-data-visualization-with-plot.html#function"><i class="fa fa-check"></i><b>12.2.16</b> 函数图</a></li>
<li class="chapter" data-level="12.2.17" data-path="13-data-visualization-with-plot.html"><a href="13-data-visualization-with-plot.html#plot-mosaic"><i class="fa fa-check"></i><b>12.2.17</b> 马赛克图</a></li>
<li class="chapter" data-level="12.2.18" data-path="13-data-visualization-with-plot.html"><a href="13-data-visualization-with-plot.html#dotchart"><i class="fa fa-check"></i><b>12.2.18</b> 克利夫兰点图</a></li>
<li class="chapter" data-level="12.2.19" data-path="13-data-visualization-with-plot.html"><a href="13-data-visualization-with-plot.html#plot-matrix"><i class="fa fa-check"></i><b>12.2.19</b> 矩阵图</a></li>
<li class="chapter" data-level="12.2.20" data-path="13-data-visualization-with-plot.html"><a href="13-data-visualization-with-plot.html#plot-radar"><i class="fa fa-check"></i><b>12.2.20</b> 雷达图</a></li>
<li class="chapter" data-level="12.2.21" data-path="13-data-visualization-with-plot.html"><a href="13-data-visualization-with-plot.html#plot-rose"><i class="fa fa-check"></i><b>12.2.21</b> 玫瑰图</a></li>
<li class="chapter" data-level="12.2.22" data-path="13-data-visualization-with-plot.html"><a href="13-data-visualization-with-plot.html#plot-map"><i class="fa fa-check"></i><b>12.2.22</b> 地形图</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="13-data-visualization-with-plot.html"><a href="13-data-visualization-with-plot.html#tikz"><i class="fa fa-check"></i><b>12.3</b> TikZ 绘图</a></li>
<li class="chapter" data-level="12.4" data-path="13-data-visualization-with-plot.html"><a href="13-data-visualization-with-plot.html#export-save"><i class="fa fa-check"></i><b>12.4</b> 图形导出</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="14-data-visualization-with-plot3d.html"><a href="14-data-visualization-with-plot3d.html"><i class="fa fa-check"></i><b>13</b> 三维可视化</a><ul>
<li class="chapter" data-level="13.1" data-path="14-data-visualization-with-plot3d.html"><a href="14-data-visualization-with-plot3d.html#pie-3d"><i class="fa fa-check"></i><b>13.1</b> 饼图</a></li>
<li class="chapter" data-level="13.2" data-path="14-data-visualization-with-plot3d.html"><a href="14-data-visualization-with-plot3d.html#bar-3d"><i class="fa fa-check"></i><b>13.2</b> 柱形图</a></li>
<li class="chapter" data-level="13.3" data-path="14-data-visualization-with-plot3d.html"><a href="14-data-visualization-with-plot3d.html#scatter-3d"><i class="fa fa-check"></i><b>13.3</b> 散点图</a></li>
<li class="chapter" data-level="13.4" data-path="14-data-visualization-with-plot3d.html"><a href="14-data-visualization-with-plot3d.html#curve-3d"><i class="fa fa-check"></i><b>13.4</b> 函数图</a></li>
<li class="chapter" data-level="13.5" data-path="14-data-visualization-with-plot3d.html"><a href="14-data-visualization-with-plot3d.html#persp-3d"><i class="fa fa-check"></i><b>13.5</b> 透视图</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="15-data-visualization-with-ggplot2.html"><a href="15-data-visualization-with-ggplot2.html"><i class="fa fa-check"></i><b>14</b> 数据可视化</a><ul>
<li class="chapter" data-level="14.1" data-path="15-data-visualization-with-ggplot2.html"><a href="15-data-visualization-with-ggplot2.html#intro-ggplot2"><i class="fa fa-check"></i><b>14.1</b> 基础语法</a><ul>
<li class="chapter" data-level="14.1.1" data-path="15-data-visualization-with-ggplot2.html"><a href="15-data-visualization-with-ggplot2.html#ggplot2-layer"><i class="fa fa-check"></i><b>14.1.1</b> 图层</a></li>
<li class="chapter" data-level="14.1.2" data-path="15-data-visualization-with-ggplot2.html"><a href="15-data-visualization-with-ggplot2.html#ggplot2-theme"><i class="fa fa-check"></i><b>14.1.2</b> 主题</a></li>
<li class="chapter" data-level="14.1.3" data-path="15-data-visualization-with-ggplot2.html"><a href="15-data-visualization-with-ggplot2.html#ggplot2-color"><i class="fa fa-check"></i><b>14.1.3</b> 配色</a></li>
<li class="chapter" data-level="14.1.4" data-path="15-data-visualization-with-ggplot2.html"><a href="15-data-visualization-with-ggplot2.html#ggplot2-scale"><i class="fa fa-check"></i><b>14.1.4</b> 刻度</a></li>
<li class="chapter" data-level="14.1.5" data-path="15-data-visualization-with-ggplot2.html"><a href="15-data-visualization-with-ggplot2.html#ggplot2-annotate"><i class="fa fa-check"></i><b>14.1.5</b> 注释</a></li>
<li class="chapter" data-level="14.1.6" data-path="15-data-visualization-with-ggplot2.html"><a href="15-data-visualization-with-ggplot2.html#ggplot2-legend"><i class="fa fa-check"></i><b>14.1.6</b> 图例</a></li>
<li class="chapter" data-level="14.1.7" data-path="15-data-visualization-with-ggplot2.html"><a href="15-data-visualization-with-ggplot2.html#ggplot2-grid"><i class="fa fa-check"></i><b>14.1.7</b> 组合</a></li>
<li class="chapter" data-level="14.1.8" data-path="15-data-visualization-with-ggplot2.html"><a href="15-data-visualization-with-ggplot2.html#ggplot2-coord"><i class="fa fa-check"></i><b>14.1.8</b> 坐标系</a></li>
<li class="chapter" data-level="14.1.9" data-path="15-data-visualization-with-ggplot2.html"><a href="15-data-visualization-with-ggplot2.html#ggplot2-axes"><i class="fa fa-check"></i><b>14.1.9</b> 坐标轴</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="15-data-visualization-with-ggplot2.html"><a href="15-data-visualization-with-ggplot2.html#ggplot2-gallary"><i class="fa fa-check"></i><b>14.2</b> 统计图形</a><ul>
<li class="chapter" data-level="14.2.1" data-path="15-data-visualization-with-ggplot2.html"><a href="15-data-visualization-with-ggplot2.html#ggplot2-scatter"><i class="fa fa-check"></i><b>14.2.1</b> 散点图</a></li>
<li class="chapter" data-level="14.2.2" data-path="15-data-visualization-with-ggplot2.html"><a href="15-data-visualization-with-ggplot2.html#ggplot2-boxplot"><i class="fa fa-check"></i><b>14.2.2</b> 箱线图</a></li>
<li class="chapter" data-level="14.2.3" data-path="15-data-visualization-with-ggplot2.html"><a href="15-data-visualization-with-ggplot2.html#ggplot2-barplot"><i class="fa fa-check"></i><b>14.2.3</b> 条形图</a></li>
<li class="chapter" data-level="14.2.4" data-path="15-data-visualization-with-ggplot2.html"><a href="15-data-visualization-with-ggplot2.html#ggplot2-line"><i class="fa fa-check"></i><b>14.2.4</b> 折线图</a></li>
<li class="chapter" data-level="14.2.5" data-path="15-data-visualization-with-ggplot2.html"><a href="15-data-visualization-with-ggplot2.html#ggplot2-histogram"><i class="fa fa-check"></i><b>14.2.5</b> 直方图</a></li>
<li class="chapter" data-level="14.2.6" data-path="15-data-visualization-with-ggplot2.html"><a href="15-data-visualization-with-ggplot2.html#ggplot2-violin"><i class="fa fa-check"></i><b>14.2.6</b> 提琴图</a></li>
<li class="chapter" data-level="14.2.7" data-path="15-data-visualization-with-ggplot2.html"><a href="15-data-visualization-with-ggplot2.html#ggplot2-jitter"><i class="fa fa-check"></i><b>14.2.7</b> 抖动图</a></li>
<li class="chapter" data-level="14.2.8" data-path="15-data-visualization-with-ggplot2.html"><a href="15-data-visualization-with-ggplot2.html#ggplot2-ridge"><i class="fa fa-check"></i><b>14.2.8</b> 密度图</a></li>
<li class="chapter" data-level="14.2.9" data-path="15-data-visualization-with-ggplot2.html"><a href="15-data-visualization-with-ggplot2.html#ggplot2-rose"><i class="fa fa-check"></i><b>14.2.9</b> 玫瑰图</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="15-data-visualization-with-ggplot2.html"><a href="15-data-visualization-with-ggplot2.html#ggplot2-spatial"><i class="fa fa-check"></i><b>14.3</b> 空间数据</a><ul>
<li class="chapter" data-level="14.3.1" data-path="15-data-visualization-with-ggplot2.html"><a href="15-data-visualization-with-ggplot2.html#ggplot2-raster"><i class="fa fa-check"></i><b>14.3.1</b> raster</a></li>
<li class="chapter" data-level="14.3.2" data-path="15-data-visualization-with-ggplot2.html"><a href="15-data-visualization-with-ggplot2.html#ggplot2-sp"><i class="fa fa-check"></i><b>14.3.2</b> sp</a></li>
<li class="chapter" data-level="14.3.3" data-path="15-data-visualization-with-ggplot2.html"><a href="15-data-visualization-with-ggplot2.html#ggplot2-sf"><i class="fa fa-check"></i><b>14.3.3</b> sf</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="15-data-visualization-with-ggplot2.html"><a href="15-data-visualization-with-ggplot2.html#ggplot2-network"><i class="fa fa-check"></i><b>14.4</b> 网络数据</a></li>
<li class="chapter" data-level="14.5" data-path="15-data-visualization-with-ggplot2.html"><a href="15-data-visualization-with-ggplot2.html#analysis-cran"><i class="fa fa-check"></i><b>14.5</b> CRAN 分析</a></li>
<li class="chapter" data-level="14.6" data-path="15-data-visualization-with-ggplot2.html"><a href="15-data-visualization-with-ggplot2.html#ggplot2-session-info"><i class="fa fa-check"></i><b>14.6</b> 软件信息</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="16-data-visualization-with-colors-fonts.html"><a href="16-data-visualization-with-colors-fonts.html"><i class="fa fa-check"></i><b>15</b> 色彩与字体</a><ul>
<li class="chapter" data-level="15.1" data-path="16-data-visualization-with-colors-fonts.html"><a href="16-data-visualization-with-colors-fonts.html#colors"><i class="fa fa-check"></i><b>15.1</b> 配色</a><ul>
<li class="chapter" data-level="15.1.1" data-path="16-data-visualization-with-colors-fonts.html"><a href="16-data-visualization-with-colors-fonts.html#colourlovers"><i class="fa fa-check"></i><b>15.1.1</b> colourlovers</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="16-data-visualization-with-colors-fonts.html"><a href="16-data-visualization-with-colors-fonts.html#fonts"><i class="fa fa-check"></i><b>15.2</b> 字体</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="99-references.html"><a href="99-references.html"><i class="fa fa-check"></i>参考文献</a></li>
<li class="divider"></li>
<li><a href="https://r4charts.netlify.com/" target="blank">Published with netlify</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">数据可视化与R语言</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ggplot2-visualization" class="section level1">
<h1><span class="header-section-number">第 14 章</span> 数据可视化</h1>
<p>David Robinson 给出为何使用 ggplot2<a href="#fn33" class="footnote-ref" id="fnref33"><sup>33</sup></a> 当然也有 Jeff Leek 指出在某些重要场合不适合 ggplot2<a href="#fn34" class="footnote-ref" id="fnref34"><sup>34</sup></a> 并且给出强有力的 <a href="http://motioninsocial.com/tufte/">证据</a>，其实不管怎么样，适合自己的才是好的。也不枉费 Garrick Aden-Buie 花费 160 页幻灯片逐步分解介绍 <a href="https://pkg.garrickadenbuie.com/gentle-ggplot2">优雅的ggplot2</a>，<a href="https://malco.io/">Malcolm Barrett</a> 也介绍了 <a href="https://malco.io/slides/hs_ggplot2">ggplot2 基础用法</a>，还有 Selva Prabhakaran 精心总结给出了 50 个 ggplot2 数据可视化的 <a href="https://r-statistics.co/Top50-Ggplot2-Visualizations-MasterList-R-Code.html">例子</a> 以及 Victor Perrier 为小白用 ggplot2 操碎了心地开发 RStudio 插件 <a href="https://github.com/dreamRs/esquisse">esquisse</a> 包，Claus O. Wilke 教你一步步创建出版级的图形 <a href="https://github.com/clauswilke/practical_ggplot2" class="uri">https://github.com/clauswilke/practical_ggplot2</a>。</p>
<p>GGplot2 是十分方便的统计作图工具，相比 Base R，为了一张出版级的图形，不需要去调整每个参数，实现快速出图。集成了很多其它统计计算的 R 包，支持丰富的统计分析和计算功能，如回归、平滑等，实现了作图和模型的无缝连接。比如图<a href="15-data-visualization-with-ggplot2.html#fig:awesome-ggplot2">14.1</a>，使用 loess 局部多项式平滑得到数据的趋势，不仅仅是散点图，代码量也非常少。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(displ, hwy)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> class)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">TRUE</span>, <span class="dt">method =</span> <span class="st">&quot;loess&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">title =</span> <span class="st">&quot;Fuel efficiency generally decreases with engine size&quot;</span>,
    <span class="dt">subtitle =</span> <span class="st">&quot;Two seaters (sports cars) are an exception because of their light weight&quot;</span>,
    <span class="dt">caption =</span> <span class="st">&quot;Data from fueleconomy.gov&quot;</span>
  )</code></pre>
<div class="figure" style="text-align: center"><span id="fig:awesome-ggplot2"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/awesome-ggplot2-1.png" alt="简洁美观" width="70%" />
<p class="caption">
图 14.1: 简洁美观
</p>
</div>
<p>故事源于一幅图片，我不记得第一次见到这幅图是什么时候了，只因多次在多个场合中见过，所以留下了深刻的印象，后来才知道它出自于一篇博文 — <a href="https://medium.com/airbnb-engineering/using-r-packages-and-education-to-scale-data-science-at-airbnb">Using R packages and education to scale Data Science at Airbnb</a>，作者 Ricardo Bion 还在其 Github 上传了相关代码<a href="#fn35" class="footnote-ref" id="fnref35"><sup>35</sup></a>。除此之外还有几篇重要的参考资料：</p>
<ol style="list-style-type: decimal">
<li>Pablo Barberá 的 <a href="https://github.com/pablobarbera/Rdataviz">Data Visualization with R and ggplot2</a></li>
<li>Kieran Healy 的新书 <a href="https://kieranhealy.org/publications/dataviz/">Data Visualization: A Practical Introduction</a></li>
<li>Matt Leonawicz 的新作 <a href="https://github.com/leonawicz/mapmate">mapmate</a>, 可以去其主页欣赏系列作品<a href="#fn36" class="footnote-ref" id="fnref36"><sup>36</sup></a></li>
<li><a href="https://github.com/bbc/bbplot">bbplot</a></li>
<li><a href="https://github.com/rfordatascience/tidytuesday">tidytuesday 可视化挑战官方项目</a> 还有 <a href="https://github.com/abichat/tidytuesday">tidytuesday</a></li>
</ol>
<div id="intro-ggplot2" class="section level2">
<h2><span class="header-section-number">14.1</span> 基础语法</h2>
<p>以数据集 airquality 为例介绍GGplot2 图层、主题、配色、坐标、尺度、注释和组合等</p>
<div id="ggplot2-layer" class="section level3">
<h3><span class="header-section-number">14.1.1</span> 图层</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ls</span>(<span class="st">&quot;package:ggplot2&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;^geom_&quot;</span>)
<span class="co">#&gt;  [1] &quot;geom_abline&quot;     &quot;geom_area&quot;       &quot;geom_bar&quot;        &quot;geom_bin2d&quot;     </span>
<span class="co">#&gt;  [5] &quot;geom_blank&quot;      &quot;geom_boxplot&quot;    &quot;geom_col&quot;        &quot;geom_contour&quot;   </span>
<span class="co">#&gt;  [9] &quot;geom_count&quot;      &quot;geom_crossbar&quot;   &quot;geom_curve&quot;      &quot;geom_density&quot;   </span>
<span class="co">#&gt; [13] &quot;geom_density_2d&quot; &quot;geom_density2d&quot;  &quot;geom_dotplot&quot;    &quot;geom_errorbar&quot;  </span>
<span class="co">#&gt; [17] &quot;geom_errorbarh&quot;  &quot;geom_freqpoly&quot;   &quot;geom_hex&quot;        &quot;geom_histogram&quot; </span>
<span class="co">#&gt; [21] &quot;geom_hline&quot;      &quot;geom_jitter&quot;     &quot;geom_label&quot;      &quot;geom_line&quot;      </span>
<span class="co">#&gt; [25] &quot;geom_linerange&quot;  &quot;geom_map&quot;        &quot;geom_path&quot;       &quot;geom_point&quot;     </span>
<span class="co">#&gt; [29] &quot;geom_pointrange&quot; &quot;geom_polygon&quot;    &quot;geom_qq&quot;         &quot;geom_qq_line&quot;   </span>
<span class="co">#&gt; [33] &quot;geom_quantile&quot;   &quot;geom_raster&quot;     &quot;geom_rect&quot;       &quot;geom_ribbon&quot;    </span>
<span class="co">#&gt; [37] &quot;geom_rug&quot;        &quot;geom_segment&quot;    &quot;geom_sf&quot;         &quot;geom_sf_label&quot;  </span>
<span class="co">#&gt; [41] &quot;geom_sf_text&quot;    &quot;geom_smooth&quot;     &quot;geom_spoke&quot;      &quot;geom_step&quot;      </span>
<span class="co">#&gt; [45] &quot;geom_text&quot;       &quot;geom_tile&quot;       &quot;geom_violin&quot;     &quot;geom_vline&quot;</span></code></pre>
<p>生成一个散点图</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(airquality, <span class="kw">aes</span>(<span class="dt">x =</span> Temp, <span class="dt">y =</span> Ozone)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()
<span class="co">#&gt; Warning: Removed 37 rows containing missing values (geom_point).</span></code></pre>
<p><img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-4-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="ggplot2-theme" class="section level3">
<h3><span class="header-section-number">14.1.2</span> 主题</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ls</span>(<span class="st">&quot;package:ggplot2&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;^theme_&quot;</span>)
<span class="co">#&gt;  [1] &quot;theme_bw&quot;       &quot;theme_classic&quot;  &quot;theme_dark&quot;     &quot;theme_get&quot;     </span>
<span class="co">#&gt;  [5] &quot;theme_gray&quot;     &quot;theme_grey&quot;     &quot;theme_light&quot;    &quot;theme_linedraw&quot;</span>
<span class="co">#&gt;  [9] &quot;theme_minimal&quot;  &quot;theme_replace&quot;  &quot;theme_set&quot;      &quot;theme_test&quot;    </span>
<span class="co">#&gt; [13] &quot;theme_update&quot;   &quot;theme_void&quot;</span></code></pre>
<p>这里只展示 <code>theme_bw()</code> <code>theme_void()</code> <code>theme_minimal()</code> 和 <code>theme_void()</code> 等四个常见主题，更多主题参考 <a href="https://github.com/jrnold/ggthemes">ggthemes</a> 、<a href="https://github.com/hrbrmstr/hrbrthemes">hrbrthemes</a> 和 <a href="https://github.com/cttobin/ggthemr">ggthemr</a> 包</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(airquality, <span class="kw">aes</span>(<span class="dt">x =</span> Temp, <span class="dt">y =</span> Ozone)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>()
<span class="co">#&gt; Warning: Removed 37 rows containing missing values (geom_point).</span>
<span class="kw">ggplot</span>(airquality, <span class="kw">aes</span>(<span class="dt">x =</span> Temp, <span class="dt">y =</span> Ozone)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_void</span>()
<span class="co">#&gt; Warning: Removed 37 rows containing missing values (geom_point).</span>
<span class="kw">ggplot</span>(airquality, <span class="kw">aes</span>(<span class="dt">x =</span> Temp, <span class="dt">y =</span> Ozone)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_minimal</span>()
<span class="co">#&gt; Warning: Removed 37 rows containing missing values (geom_point).</span>
<span class="kw">ggplot</span>(airquality, <span class="kw">aes</span>(<span class="dt">x =</span> Temp, <span class="dt">y =</span> Ozone)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_void</span>()
<span class="co">#&gt; Warning: Removed 37 rows containing missing values (geom_point).</span></code></pre>
<p><img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-6-1.png" width="70%" style="display: block; margin: auto;" /><img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-6-2.png" width="70%" style="display: block; margin: auto;" /><img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-6-3.png" width="70%" style="display: block; margin: auto;" /><img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-6-4.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="ggplot2-color" class="section level3">
<h3><span class="header-section-number">14.1.3</span> 配色</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ls</span>(<span class="st">&quot;package:ggplot2&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;^scale_(color|fill)_&quot;</span>)
<span class="co">#&gt;  [1] &quot;scale_color_brewer&quot;     &quot;scale_color_continuous&quot; &quot;scale_color_discrete&quot;  </span>
<span class="co">#&gt;  [4] &quot;scale_color_distiller&quot;  &quot;scale_color_gradient&quot;   &quot;scale_color_gradient2&quot; </span>
<span class="co">#&gt;  [7] &quot;scale_color_gradientn&quot;  &quot;scale_color_grey&quot;       &quot;scale_color_hue&quot;       </span>
<span class="co">#&gt; [10] &quot;scale_color_identity&quot;   &quot;scale_color_manual&quot;     &quot;scale_color_viridis_c&quot; </span>
<span class="co">#&gt; [13] &quot;scale_color_viridis_d&quot;  &quot;scale_fill_brewer&quot;      &quot;scale_fill_continuous&quot; </span>
<span class="co">#&gt; [16] &quot;scale_fill_date&quot;        &quot;scale_fill_datetime&quot;    &quot;scale_fill_discrete&quot;   </span>
<span class="co">#&gt; [19] &quot;scale_fill_distiller&quot;   &quot;scale_fill_gradient&quot;    &quot;scale_fill_gradient2&quot;  </span>
<span class="co">#&gt; [22] &quot;scale_fill_gradientn&quot;   &quot;scale_fill_grey&quot;        &quot;scale_fill_hue&quot;        </span>
<span class="co">#&gt; [25] &quot;scale_fill_identity&quot;    &quot;scale_fill_manual&quot;      &quot;scale_fill_ordinal&quot;    </span>
<span class="co">#&gt; [28] &quot;scale_fill_viridis_c&quot;   &quot;scale_fill_viridis_d&quot;</span></code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(airquality, <span class="kw">aes</span>(<span class="dt">x =</span> Temp, <span class="dt">y =</span> Ozone, <span class="dt">color =</span> <span class="kw">as.factor</span>(Month))) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>()
<span class="co">#&gt; Warning: Removed 37 rows containing missing values (geom_point).</span>
<span class="kw">ggplot</span>(airquality, <span class="kw">aes</span>(<span class="dt">x =</span> Temp, <span class="dt">y =</span> Ozone, <span class="dt">color =</span> <span class="kw">as.ordered</span>(Month))) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>()
<span class="co">#&gt; Warning: Removed 37 rows containing missing values (geom_point).</span></code></pre>
<p><img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-8-1.png" width="70%" style="display: block; margin: auto;" /><img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-8-2.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="ggplot2-scale" class="section level3">
<h3><span class="header-section-number">14.1.4</span> 刻度</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ls</span>(<span class="st">&quot;package:ggplot2&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;^scale_(x|y)_&quot;</span>)
<span class="co">#&gt;  [1] &quot;scale_x_continuous&quot; &quot;scale_x_date&quot;       &quot;scale_x_datetime&quot;  </span>
<span class="co">#&gt;  [4] &quot;scale_x_discrete&quot;   &quot;scale_x_log10&quot;      &quot;scale_x_reverse&quot;   </span>
<span class="co">#&gt;  [7] &quot;scale_x_sqrt&quot;       &quot;scale_x_time&quot;       &quot;scale_y_continuous&quot;</span>
<span class="co">#&gt; [10] &quot;scale_y_date&quot;       &quot;scale_y_datetime&quot;   &quot;scale_y_discrete&quot;  </span>
<span class="co">#&gt; [13] &quot;scale_y_log10&quot;      &quot;scale_y_reverse&quot;    &quot;scale_y_sqrt&quot;      </span>
<span class="co">#&gt; [16] &quot;scale_y_time&quot;</span></code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">range</span>(airquality<span class="op">$</span>Temp, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; [1] 56 97</span>
<span class="kw">range</span>(airquality<span class="op">$</span>Ozone, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; [1]   1 168</span>
<span class="kw">ggplot</span>(airquality, <span class="kw">aes</span>(<span class="dt">x =</span> Temp, <span class="dt">y =</span> Ozone)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">5</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">200</span>, <span class="dv">20</span>))
<span class="co">#&gt; Warning: Removed 37 rows containing missing values (geom_point).</span></code></pre>
<p><img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-10-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="ggplot2-annotate" class="section level3">
<h3><span class="header-section-number">14.1.5</span> 注释</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ls</span>(<span class="st">&quot;package:ggplot2&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;^annotation_&quot;</span>)
<span class="co">#&gt; [1] &quot;annotation_custom&quot;   &quot;annotation_logticks&quot; &quot;annotation_map&quot;     </span>
<span class="co">#&gt; [4] &quot;annotation_raster&quot;</span></code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(airquality, <span class="kw">aes</span>(<span class="dt">x =</span> Temp, <span class="dt">y =</span> Ozone)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()
<span class="co">#&gt; Warning: Removed 37 rows containing missing values (geom_point).</span></code></pre>
<p><img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-12-1.png" width="70%" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(airquality, <span class="kw">aes</span>(<span class="dt">x =</span> Temp, <span class="dt">y =</span> Ozone)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="kw">substitute</span>(<span class="kw">paste</span>(d <span class="op">*</span>
<span class="st">    </span><span class="kw">bolditalic</span>(x)[<span class="kw">italic</span>(t)] <span class="op">==</span><span class="st"> </span>alpha <span class="op">*</span><span class="st"> </span>(theta <span class="op">-</span><span class="st"> </span><span class="kw">bolditalic</span>(x)[<span class="kw">italic</span>(t)]) <span class="op">*</span>
<span class="st">    </span>d <span class="op">*</span><span class="st"> </span><span class="kw">italic</span>(t) <span class="op">+</span><span class="st"> </span>lambda <span class="op">*</span><span class="st"> </span>d <span class="op">*</span><span class="st"> </span><span class="kw">italic</span>(B)[<span class="kw">italic</span>(t)]), <span class="kw">list</span>(<span class="dt">lambda =</span> <span class="dv">4</span>)))
<span class="co">#&gt; Warning: Removed 37 rows containing missing values (geom_point).</span></code></pre>
<p><img src="15-data-visualization-with-ggplot2_files/figure-html/math-expr-r-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="ggplot2-legend" class="section level3">
<h3><span class="header-section-number">14.1.6</span> 图例</h3>
</div>
<div id="ggplot2-grid" class="section level3">
<h3><span class="header-section-number">14.1.7</span> 组合</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(airquality) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Temp, <span class="dt">y =</span> Ozone)) <span class="op">+</span><span class="st"> </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span><span class="kw">as.ordered</span>(Month))
<span class="co">#&gt; Warning: Removed 37 rows containing missing values (geom_point).</span>
<span class="kw">ggplot</span>(airquality) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Temp, <span class="dt">y =</span> Ozone)) <span class="op">+</span><span class="st"> </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span><span class="kw">as.ordered</span>(Month), <span class="dt">nrow =</span> <span class="dv">1</span>)
<span class="co">#&gt; Warning: Removed 37 rows containing missing values (geom_point).</span></code></pre>
<p><img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-13-1.png" width="70%" style="display: block; margin: auto;" /><img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-13-2.png" width="70%" style="display: block; margin: auto;" /></p>
<p>gridExtra 和 patchwork</p>
</div>
<div id="ggplot2-coord" class="section level3">
<h3><span class="header-section-number">14.1.8</span> 坐标系</h3>
<p>极坐标，直角坐标</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ls</span>(<span class="st">&quot;package:ggplot2&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;^coord_&quot;</span>)
<span class="co">#&gt;  [1] &quot;coord_cartesian&quot; &quot;coord_equal&quot;     &quot;coord_fixed&quot;     &quot;coord_flip&quot;     </span>
<span class="co">#&gt;  [5] &quot;coord_map&quot;       &quot;coord_munch&quot;     &quot;coord_polar&quot;     &quot;coord_quickmap&quot; </span>
<span class="co">#&gt;  [9] &quot;coord_sf&quot;        &quot;coord_trans&quot;</span></code></pre>
</div>
<div id="ggplot2-axes" class="section level3">
<h3><span class="header-section-number">14.1.9</span> 坐标轴</h3>
<p>坐标轴标签位置、大小、字体</p>
</div>
</div>
<div id="ggplot2-gallary" class="section level2">
<h2><span class="header-section-number">14.2</span> 统计图形</h2>
<div id="ggplot2-scatter" class="section level3">
<h3><span class="header-section-number">14.2.1</span> 散点图</h3>
<p>下面以 diamonds 数据集为例展示 ggplot2 的绘图过程，首先加载 diamonds 数据集，查看数据集的内容</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(diamonds)
<span class="kw">str</span>(diamonds)
<span class="co">#&gt; Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    53940 obs. of  10 variables:</span>
<span class="co">#&gt;  $ carat  : num  0.23 0.21 0.23 0.29 0.31 0.24 0.24 0.26 0.22 0.23 ...</span>
<span class="co">#&gt;  $ cut    : Ord.factor w/ 5 levels &quot;Fair&quot;&lt;&quot;Good&quot;&lt;..: 5 4 2 4 2 3 3 3 1 3 ...</span>
<span class="co">#&gt;  $ color  : Ord.factor w/ 7 levels &quot;D&quot;&lt;&quot;E&quot;&lt;&quot;F&quot;&lt;&quot;G&quot;&lt;..: 2 2 2 6 7 7 6 5 2 5 ...</span>
<span class="co">#&gt;  $ clarity: Ord.factor w/ 8 levels &quot;I1&quot;&lt;&quot;SI2&quot;&lt;&quot;SI1&quot;&lt;..: 2 3 5 4 2 6 7 3 4 5 ...</span>
<span class="co">#&gt;  $ depth  : num  61.5 59.8 56.9 62.4 63.3 62.8 62.3 61.9 65.1 59.4 ...</span>
<span class="co">#&gt;  $ table  : num  55 61 65 58 58 57 57 55 61 61 ...</span>
<span class="co">#&gt;  $ price  : int  326 326 327 334 335 336 336 337 337 338 ...</span>
<span class="co">#&gt;  $ x      : num  3.95 3.89 4.05 4.2 4.34 3.94 3.95 4.07 3.87 4 ...</span>
<span class="co">#&gt;  $ y      : num  3.98 3.84 4.07 4.23 4.35 3.96 3.98 4.11 3.78 4.05 ...</span>
<span class="co">#&gt;  $ z      : num  2.43 2.31 2.31 2.63 2.75 2.48 2.47 2.53 2.49 2.39 ...</span></code></pre>
<p>数值型变量 carat 作为 x 轴</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat))
<span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price))
<span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">color =</span> cut))
<span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat), <span class="dt">color =</span> <span class="st">&quot;steelblue&quot;</span>)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:diamonds-axis"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/diamonds-axis-1.png" alt="指定 x 轴" width="35%" /><img src="15-data-visualization-with-ggplot2_files/figure-html/diamonds-axis-2.png" alt="数值变量 price 作为纵轴" width="35%" /><img src="15-data-visualization-with-ggplot2_files/figure-html/diamonds-axis-3.png" alt="有序分类变量 cut 指定颜色" width="35%" /><img src="15-data-visualization-with-ggplot2_files/figure-html/diamonds-axis-4.png" alt="指定统一颜色" width="35%" />
<p class="caption">
图 14.2: 指定统一颜色
</p>
</div>
<p>图 <a href="15-data-visualization-with-ggplot2.html#fig:diamonds-axis">14.2</a> 的基础上添加数据图层</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre>
<div class="figure" style="text-align: center"><span id="fig:scatter"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/scatter-1.png" alt="添加数据图层" width="70%" />
<p class="caption">
图 14.3: 添加数据图层
</p>
</div>
<p>给散点图<a href="15-data-visualization-with-ggplot2.html#fig:scatter">14.3</a>上色</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;steelblue&quot;</span>)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:scatter-color-1"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/scatter-color-1-1.png" alt="散点图配色" width="70%" />
<p class="caption">
图 14.4: 散点图配色
</p>
</div>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;steelblue&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(
    <span class="dt">labels =</span> scales<span class="op">::</span><span class="kw">unit_format</span>(<span class="dt">unit =</span> <span class="st">&quot;k&quot;</span>, <span class="dt">scale =</span> <span class="fl">1e-3</span>),
    <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">20000</span>, <span class="dv">4000</span>)
  )</code></pre>
<div class="figure" style="text-align: center"><span id="fig:scatter-scale-1"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/scatter-scale-1-1.png" alt="格式化坐标轴刻度标签" width="70%" />
<p class="caption">
图 14.5: 格式化坐标轴刻度标签
</p>
</div>
<p>让另一变量 cut 作为颜色分类指标</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price, <span class="dt">color =</span> cut)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre>
<div class="figure" style="text-align: center"><span id="fig:scatter-color-2"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/scatter-color-2-1.png" alt="分类散点图" width="70%" />
<p class="caption">
图 14.6: 分类散点图
</p>
</div>
<p>当然还有一种类似的表示就是分组，默认情况下，ggplot2将所有观测点视为一组，以分类变量 cut 来分组</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price, <span class="dt">group =</span> cut)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre>
<div class="figure" style="text-align: center"><span id="fig:scatter-group"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/scatter-group-1.png" alt="分组" width="70%" />
<p class="caption">
图 14.7: 分组
</p>
</div>
<p>在图<a href="15-data-visualization-with-ggplot2.html#fig:scatter-group">14.7</a> 上没有体现出来分组的意思，下面以 cut 分组线性回归为例</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>)
<span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price, <span class="dt">group =</span> cut)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:group-lm"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/group-lm-1.png" alt="分组线性回归" width="70%" /><img src="15-data-visualization-with-ggplot2_files/figure-html/group-lm-2.png" alt="分组线性回归" width="70%" />
<p class="caption">
图 14.8: 分组线性回归
</p>
</div>
<p>我们当然可以选择更加合适的拟合方式，如局部多项式平滑 <code>loess</code> 但是该方法不太适用观测值比较多的情况，因为它会占用比较多的内存，建议使用广义可加模型作平滑拟合</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price, <span class="dt">group =</span> cut)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;loess&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price, <span class="dt">group =</span> cut)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;gam&quot;</span>, <span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span><span class="kw">s</span>(x, <span class="dt">bs =</span> <span class="st">&quot;cs&quot;</span>))</code></pre>
<div class="figure" style="text-align: center"><span id="fig:group-gam"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/group-gam-1.png" alt="数据分组应用广义可加平滑" width="70%" />
<p class="caption">
图 14.9: 数据分组应用广义可加平滑
</p>
</div>
<div class="sidebar">
<p><a href="https://github.com/sinhrks/ggfortify">ggfortify</a> 包支持更多的统计分析结果的可视化</p>
</div>
<p>为了更好地区分开组别，我们在图<a href="15-data-visualization-with-ggplot2.html#fig:group-gam">14.9</a>的基础上分面或者配色</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price, <span class="dt">group =</span> cut)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;gam&quot;</span>, <span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span><span class="kw">s</span>(x, <span class="dt">bs =</span> <span class="st">&quot;cs&quot;</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(<span class="op">~</span>cut)
<span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price, <span class="dt">group =</span> cut, <span class="dt">color =</span> cut)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;gam&quot;</span>, <span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span><span class="kw">s</span>(x, <span class="dt">bs =</span> <span class="st">&quot;cs&quot;</span>))</code></pre>
<div class="figure" style="text-align: center"><span id="fig:group-facet"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/group-facet-1.png" alt="分组分面" width="70%" /><img src="15-data-visualization-with-ggplot2_files/figure-html/group-facet-2.png" alt="分组配色" width="70%" />
<p class="caption">
图 14.10: 分组配色
</p>
</div>
<p>在分类散点图的另一种表示方法就是分面图，以 cut 变量作为分面的依据</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(<span class="op">~</span>cut)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:scatter-facet"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/scatter-facet-1.png" alt="分面散点图" width="70%" />
<p class="caption">
图 14.11: 分面散点图
</p>
</div>
<p>给图 <a href="15-data-visualization-with-ggplot2.html#fig:scatter-facet">14.11</a> 上色</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">color =</span> <span class="st">&quot;steelblue&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(<span class="op">~</span>cut)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:scatter-facet-color-1"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/scatter-facet-color-1-1.png" alt="给分面散点图上色" width="70%" />
<p class="caption">
图 14.12: 给分面散点图上色
</p>
</div>
<p>在图<a href="15-data-visualization-with-ggplot2.html#fig:scatter-facet-color-1">14.12</a>的基础上，给不同的类上不同的颜色</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price, <span class="dt">color =</span> cut)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(<span class="op">~</span>cut)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:scatter-facet-color-2"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/scatter-facet-color-2-1.png" alt="给不同的类上不同的颜色" width="70%" />
<p class="caption">
图 14.13: 给不同的类上不同的颜色
</p>
</div>
<p>去掉图例，此时图例属于冗余信息了</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price, <span class="dt">color =</span> cut)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(<span class="op">~</span>cut)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:scatter-facet-color-3"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/scatter-facet-color-3-1.png" alt="去掉图例" width="70%" />
<p class="caption">
图 14.14: 去掉图例
</p>
</div>
<p>四块土地，所施肥料不同，肥力大小顺序 4 &lt; 2 &lt; 3 &lt; 1 小麦产量随肥力的变化</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(nlme)
<span class="kw">data</span>(Wheat2) <span class="co"># Wheat Yield Trials</span>
<span class="kw">library</span>(colorspace)
<span class="kw">ggplot</span>(Wheat2, <span class="kw">aes</span>(longitude, latitude)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">size =</span> yield, <span class="dt">colour =</span> Block)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_color_discrete_sequential</span>(<span class="dt">palette =</span> <span class="st">&quot;Viridis&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">30</span>, <span class="dv">5</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">50</span>, <span class="dv">10</span>))</code></pre>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-16"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-16-1.png" alt="多个图例" width="70%" />
<p class="caption">
图 12.20: 多个图例
</p>
</div>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mtcars, <span class="kw">aes</span>(<span class="dt">x =</span> hp, <span class="dt">y =</span> mpg, <span class="dt">color =</span> <span class="kw">factor</span>(am))) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>()</code></pre>
<div class="figure" style="text-align: center"><span id="fig:category-ggplot"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/category-ggplot-1.png" alt="分类散点图" width="70%" />
<p class="caption">
图 14.15: 分类散点图
</p>
</div>
<p>图层、分组、分面和散点图介绍完了，接下来就是其它统计图形，如箱线图，小提琴图和条形图</p>
<pre class="sourceCode r"><code class="sourceCode r">dat &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">cbind</span>(<span class="kw">rep</span>(<span class="dv">1948</span> <span class="op">+</span><span class="st"> </span><span class="kw">seq</span>(<span class="dv">12</span>), <span class="dt">each =</span> <span class="dv">12</span>), <span class="kw">rep</span>(<span class="kw">seq</span>(<span class="dv">12</span>), <span class="dv">12</span>), AirPassengers))
<span class="kw">colnames</span>(dat) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;month&quot;</span>, <span class="st">&quot;passengers&quot;</span>)

<span class="kw">ggplot</span>(<span class="dt">data =</span> dat, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">as.factor</span>(year), <span class="dt">y =</span> <span class="kw">as.factor</span>(month))) <span class="op">+</span>
<span class="st">  </span><span class="kw">stat_sum</span>(<span class="kw">aes</span>(<span class="dt">size =</span> passengers), <span class="dt">colour =</span> <span class="st">&quot;lightblue&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_size</span>(<span class="dt">range =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">10</span>), <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">100</span>, <span class="dv">650</span>, <span class="dv">50</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Month&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;Passengers&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_minimal</span>()</code></pre>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-17"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-17-1.png" alt="1948年至1960年航班乘客人数变化" width="70%" />
<p class="caption">
图 12.21: 1948年至1960年航班乘客人数变化
</p>
</div>
</div>
<div id="ggplot2-boxplot" class="section level3">
<h3><span class="header-section-number">14.2.2</span> 箱线图</h3>
<p>以 PlantGrowth 数据集为例展示箱线图，在两组不同实验条件下，植物生长的情况，纵坐标是干燥植物的量，横坐标表示不同的实验条件。这是非常典型的适合用箱线图来表达数据的场合，Y 轴对应数值型变量，X 轴对应分类变量，在 R 语言中，分类变量的类型是 factor</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">&quot;PlantGrowth&quot;</span>)
<span class="kw">str</span>(PlantGrowth)
<span class="co">#&gt; &#39;data.frame&#39;:    30 obs. of  2 variables:</span>
<span class="co">#&gt;  $ weight: num  4.17 5.58 5.18 6.11 4.5 4.61 5.17 4.53 5.33 5.14 ...</span>
<span class="co">#&gt;  $ group : Factor w/ 3 levels &quot;ctrl&quot;,&quot;trt1&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...</span></code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> PlantGrowth, <span class="kw">aes</span>(<span class="dt">x =</span> group, <span class="dt">y =</span> weight)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()</code></pre>
<p><img src="15-data-visualization-with-ggplot2_files/figure-html/PlantGrowth-boxplot-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>PlantGrowth 数据量比较小，此时比较适合采用抖动散点图，抖动是为了避免点之间相互重叠，为了增加不同类别之间的识别性，我们可以用不同的点的形状或者不同的颜色来表示类别</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> PlantGrowth, <span class="kw">aes</span>(<span class="dt">x =</span> group, <span class="dt">y =</span> weight, <span class="dt">shape =</span> group)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_jitter</span>()
<span class="kw">ggplot</span>(<span class="dt">data =</span> PlantGrowth, <span class="kw">aes</span>(<span class="dt">x =</span> group, <span class="dt">y =</span> weight, <span class="dt">color =</span> group)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_jitter</span>()</code></pre>
<p><img src="15-data-visualization-with-ggplot2_files/figure-html/PlantGrowth-jitter-1.png" width="70%" style="display: block; margin: auto;" /><img src="15-data-visualization-with-ggplot2_files/figure-html/PlantGrowth-jitter-2.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="base">
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">boxplot</span>(weight <span class="op">~</span><span class="st"> </span>group,
  <span class="dt">data =</span> PlantGrowth,
  <span class="dt">ylab =</span> <span class="st">&quot;Dried weight of plants&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;lightgray&quot;</span>,
  <span class="dt">notch =</span> <span class="ot">FALSE</span>, <span class="dt">varwidth =</span> <span class="ot">TRUE</span>
)</code></pre>
<p><img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-19-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<p>以钻石切割质量 cut 为分面依据，以钻石颜色类别 color 为 x 轴，钻石价格为 y 轴，绘制箱线图<a href="15-data-visualization-with-ggplot2.html#fig:boxplot-facet-color">14.16</a></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> color, <span class="dt">y =</span> price, <span class="dt">color =</span> cut)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(<span class="op">~</span>cut)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:boxplot-facet-color"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/boxplot-facet-color-1.png" alt="箱线图" width="70%" />
<p class="caption">
图 14.16: 箱线图
</p>
</div>
<p>我们当然还可以添加钻石的纯净度 clarity 作为分面依据，那么箱线图可以为图 <a href="15-data-visualization-with-ggplot2.html#fig:boxplot-facet-color-clarity-1">14.17</a>，但是经过观察，我们发现水平分类过多，考虑用切割质量 cut 替换钻石颜色 color 绘图，但是由于分类过细，图信息展示不简练，反而不好，如图 <a href="15-data-visualization-with-ggplot2.html#fig:boxplot-facet-color-clarity-2">14.18</a></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> color, <span class="dt">y =</span> price, <span class="dt">color =</span> cut)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(clarity <span class="op">~</span><span class="st"> </span>cut)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:boxplot-facet-color-clarity-1"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/boxplot-facet-color-clarity-1-1.png" alt="复合分面箱线图" width="70%" />
<p class="caption">
图 14.17: 复合分面箱线图
</p>
</div>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">y =</span> price, <span class="dt">color =</span> cut)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(clarity <span class="op">~</span><span class="st"> </span>color)
<span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">y =</span> price, <span class="dt">color =</span> color)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(clarity <span class="op">~</span><span class="st"> </span>color)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:boxplot-facet-color-clarity-2"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/boxplot-facet-color-clarity-2-1.png" alt="切割质量cut上色" width="70%" /><img src="15-data-visualization-with-ggplot2_files/figure-html/boxplot-facet-color-clarity-2-2.png" alt="钻石颜色配色" width="70%" />
<p class="caption">
图 14.18: 钻石颜色配色
</p>
</div>
</div>
<div id="ggplot2-barplot" class="section level3">
<h3><span class="header-section-number">14.2.3</span> 条形图</h3>
<p>条形图特别适合分类变量的展示，我们这里展示钻石切割质量 cut 不同等级的数量，当然我们可以直接展示各类的数目，在图层 <code>geom_bar</code> 中指定 <code>stat="identity"</code></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 需要映射数据框的两个变量，相当于自己先计算了每类的数量</span>
<span class="kw">with</span>(diamonds, <span class="kw">table</span>(cut))
cut_df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">table</span>(diamonds<span class="op">$</span>cut))
<span class="kw">ggplot</span>(cut_df, <span class="kw">aes</span>(<span class="dt">x =</span> Var1, <span class="dt">y =</span> Freq)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> cut)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>()</code></pre>
<div class="figure" style="text-align: center"><span id="fig:diamonds-barplot-1"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/diamonds-barplot-1-1.png" alt="频数条形图" width="70%" />
<p class="caption">
图 14.19: 频数条形图
</p>
</div>
<p>还有另外三种表示方法</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> cut)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;count&quot;</span>)
<span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">y =</span> ..count..)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>()
<span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">y =</span> <span class="kw">stat</span>(count))) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>()</code></pre>
<p>我们还可以在图 <a href="15-data-visualization-with-ggplot2.html#fig:diamonds-barplot-1">14.19</a> 的基础上再添加一个分类变量钻石的纯净度 clarity，形成堆积条形图</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">fill =</span> clarity)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>()</code></pre>
<div class="figure" style="text-align: center"><span id="fig:diamonds-barplot-2"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/diamonds-barplot-2-1.png" alt="堆积条形图" width="70%" />
<p class="caption">
图 14.20: 堆积条形图
</p>
</div>
<p>再添加一个分类变量钻石颜色 color 比较好的做法是分面</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> color, <span class="dt">fill =</span> clarity)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(<span class="op">~</span>cut)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:diamonds-barplot-3"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/diamonds-barplot-3-1.png" alt="分面堆积条形图" width="70%" />
<p class="caption">
图 14.21: 分面堆积条形图
</p>
</div>
<p>实际上，绘制图<a href="15-data-visualization-with-ggplot2.html#fig:diamonds-barplot-3">14.21</a>包含了对分类变量的分组计数过程，如下</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">with</span>(diamonds, <span class="kw">table</span>(cut, color))
<span class="co">#&gt;            color</span>
<span class="co">#&gt; cut            D    E    F    G    H    I    J</span>
<span class="co">#&gt;   Fair       163  224  312  314  303  175  119</span>
<span class="co">#&gt;   Good       662  933  909  871  702  522  307</span>
<span class="co">#&gt;   Very Good 1513 2400 2164 2299 1824 1204  678</span>
<span class="co">#&gt;   Premium   1603 2337 2331 2924 2360 1428  808</span>
<span class="co">#&gt;   Ideal     2834 3903 3826 4884 3115 2093  896</span></code></pre>
<p>还有一种堆积的方法是按比例，而不是按数量，如图<a href="15-data-visualization-with-ggplot2.html#fig:diamonds-barplot-4">14.22</a></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> color, <span class="dt">fill =</span> clarity)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">position =</span> <span class="st">&quot;fill&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(<span class="op">~</span>cut)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:diamonds-barplot-4"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/diamonds-barplot-4-1.png" alt="比例堆积条形图" width="70%" />
<p class="caption">
图 14.22: 比例堆积条形图
</p>
</div>
<p>接下来就是复合条形图</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> color, <span class="dt">fill =</span> clarity)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:diamonds-barplot-5"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/diamonds-barplot-5-1.png" alt="复合条形图" width="70%" />
<p class="caption">
图 14.23: 复合条形图
</p>
</div>
<p>再添加一个分类变量，就是需要分面大法了，图 <a href="15-data-visualization-with-ggplot2.html#fig:diamonds-barplot-5">14.23</a> 展示了三个分类变量，其实我们还可以再添加一个分类变量用作分面的列依据</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> color, <span class="dt">fill =</span> clarity)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(<span class="dt">rows =</span> <span class="kw">vars</span>(cut))</code></pre>
<div class="figure" style="text-align: center"><span id="fig:diamonds-barplot-6"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/diamonds-barplot-6-1.png" alt="分面复合条形图" width="70%" />
<p class="caption">
图 14.24: 分面复合条形图
</p>
</div>
<p>图 <a href="15-data-visualization-with-ggplot2.html#fig:diamonds-barplot-6">14.24</a> 展示的数据如下</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">with</span>(diamonds, <span class="kw">table</span>(color, clarity, cut))
<span class="co">#&gt; , , cut = Fair</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;      clarity</span>
<span class="co">#&gt; color   I1  SI2  SI1  VS2  VS1 VVS2 VVS1   IF</span>
<span class="co">#&gt;     D    4   56   58   25    5    9    3    3</span>
<span class="co">#&gt;     E    9   78   65   42   14   13    3    0</span>
<span class="co">#&gt;     F   35   89   83   53   33   10    5    4</span>
<span class="co">#&gt;     G   53   80   69   45   45   17    3    2</span>
<span class="co">#&gt;     H   52   91   75   41   32   11    1    0</span>
<span class="co">#&gt;     I   34   45   30   32   25    8    1    0</span>
<span class="co">#&gt;     J   23   27   28   23   16    1    1    0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; , , cut = Good</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;      clarity</span>
<span class="co">#&gt; color   I1  SI2  SI1  VS2  VS1 VVS2 VVS1   IF</span>
<span class="co">#&gt;     D    8  223  237  104   43   25   13    9</span>
<span class="co">#&gt;     E   23  202  355  160   89   52   43    9</span>
<span class="co">#&gt;     F   19  201  273  184  132   50   35   15</span>
<span class="co">#&gt;     G   19  163  207  192  152   75   41   22</span>
<span class="co">#&gt;     H   14  158  235  138   77   45   31    4</span>
<span class="co">#&gt;     I    9   81  165  110  103   26   22    6</span>
<span class="co">#&gt;     J    4   53   88   90   52   13    1    6</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; , , cut = Very Good</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;      clarity</span>
<span class="co">#&gt; color   I1  SI2  SI1  VS2  VS1 VVS2 VVS1   IF</span>
<span class="co">#&gt;     D    5  314  494  309  175  141   52   23</span>
<span class="co">#&gt;     E   22  445  626  503  293  298  170   43</span>
<span class="co">#&gt;     F   13  343  559  466  293  249  174   67</span>
<span class="co">#&gt;     G   16  327  474  479  432  302  190   79</span>
<span class="co">#&gt;     H   12  343  547  376  257  145  115   29</span>
<span class="co">#&gt;     I    8  200  358  274  205   71   69   19</span>
<span class="co">#&gt;     J    8  128  182  184  120   29   19    8</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; , , cut = Premium</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;      clarity</span>
<span class="co">#&gt; color   I1  SI2  SI1  VS2  VS1 VVS2 VVS1   IF</span>
<span class="co">#&gt;     D   12  421  556  339  131   94   40   10</span>
<span class="co">#&gt;     E   30  519  614  629  292  121  105   27</span>
<span class="co">#&gt;     F   34  523  608  619  290  146   80   31</span>
<span class="co">#&gt;     G   46  492  566  721  566  275  171   87</span>
<span class="co">#&gt;     H   46  521  655  532  336  118  112   40</span>
<span class="co">#&gt;     I   24  312  367  315  221   82   84   23</span>
<span class="co">#&gt;     J   13  161  209  202  153   34   24   12</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; , , cut = Ideal</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;      clarity</span>
<span class="co">#&gt; color   I1  SI2  SI1  VS2  VS1 VVS2 VVS1   IF</span>
<span class="co">#&gt;     D   13  356  738  920  351  284  144   28</span>
<span class="co">#&gt;     E   18  469  766 1136  593  507  335   79</span>
<span class="co">#&gt;     F   42  453  608  879  616  520  440  268</span>
<span class="co">#&gt;     G   16  486  660  910  953  774  594  491</span>
<span class="co">#&gt;     H   38  450  763  556  467  289  326  226</span>
<span class="co">#&gt;     I   17  274  504  438  408  178  179   95</span>
<span class="co">#&gt;     J    2  110  243  232  201   54   29   25</span></code></pre>
</div>
<div id="ggplot2-line" class="section level3">
<h3><span class="header-section-number">14.2.4</span> 折线图</h3>
<p>时间序列数据的展示，时序图</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(economics, <span class="kw">aes</span>(date, unemploy)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>()</code></pre>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-24"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-24-1.png" alt="时序图" width="70%" />
<p class="caption">
图 12.28: 时序图
</p>
</div>
</div>
<div id="ggplot2-histogram" class="section level3">
<h3><span class="header-section-number">14.2.5</span> 直方图</h3>
<p>直方图用来查看连续变量的分布</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(price)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">30</span>)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-25"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-25-1.png" alt="钻石价格的分布" width="70%" />
<p class="caption">
图 12.29: 钻石价格的分布
</p>
</div>
<p>堆积直方图</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> price, <span class="dt">fill =</span> cut)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">bins =</span> <span class="dv">30</span>)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-26"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-26-1.png" alt="钻石价格随切割质量的分布" width="70%" />
<p class="caption">
图 12.30: 钻石价格随切割质量的分布
</p>
</div>
<p>基础 R 包与 Ggplot2 包绘制的直方图的对比，Base R 绘图速度快，代码更加稳定，Ggplot2 代码简洁，更美观</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="fl">2.1</span>, <span class="fl">2.1</span>, <span class="fl">1.5</span>, <span class="fl">0.5</span>))
<span class="kw">plot</span>(<span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">350</span>), <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">10</span>),
  <span class="dt">type =</span> <span class="st">&quot;n&quot;</span>, <span class="dt">font.main =</span> <span class="dv">1</span>,
  <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">frame.plot =</span> <span class="ot">FALSE</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>,
  <span class="co"># xlab = &quot;hp&quot;, ylab = &quot;Frequency&quot;,</span>
  <span class="dt">main =</span> <span class="kw">paste</span>(<span class="st">&quot;Histogram with Base R&quot;</span>, <span class="kw">paste</span>(<span class="kw">rep</span>(<span class="st">&quot; &quot;</span>, <span class="dv">60</span>), <span class="dt">collapse =</span> <span class="st">&quot;&quot;</span>))
)
<span class="kw">axis</span>(
  <span class="dt">side =</span> <span class="dv">1</span>, <span class="dt">at =</span> <span class="kw">seq</span>(<span class="dv">50</span>, <span class="dv">350</span>, <span class="dv">50</span>), <span class="dt">labels =</span> <span class="kw">seq</span>(<span class="dv">50</span>, <span class="dv">350</span>, <span class="dv">50</span>),
  <span class="dt">tick =</span> <span class="ot">FALSE</span>, <span class="dt">las =</span> <span class="dv">1</span>, <span class="dt">padj =</span> <span class="dv">0</span>, <span class="dt">mgp =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="fl">0.1</span>, <span class="dv">0</span>)
)
<span class="kw">axis</span>(
  <span class="dt">side =</span> <span class="dv">2</span>, <span class="dt">at =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">2</span>), <span class="dt">labels =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">2</span>),
  <span class="co"># col = &quot;white&quot;, 坐标轴的颜色</span>
  <span class="co"># col.ticks 刻度线的颜色</span>
  <span class="dt">tick =</span> <span class="ot">FALSE</span>, <span class="co"># 取消刻度线</span>
  <span class="dt">las =</span> <span class="dv">1</span>, <span class="co"># 水平方向</span>
  <span class="dt">hadj =</span> <span class="dv">1</span>, <span class="co"># 右侧对齐</span>
  <span class="dt">mgp =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="fl">0.1</span>, <span class="dv">0</span>) <span class="co"># 纵轴边距线设置为 0.1</span>
)
<span class="kw">abline</span>(<span class="dt">h =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">2</span>), <span class="dt">v =</span> <span class="kw">seq</span>(<span class="dv">50</span>, <span class="dv">350</span>, <span class="dv">50</span>), <span class="dt">col =</span> <span class="st">&quot;gray90&quot;</span>, <span class="dt">lty =</span> <span class="st">&quot;solid&quot;</span>)
<span class="kw">abline</span>(<span class="dt">h =</span> <span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">9</span>, <span class="dv">2</span>), <span class="dt">v =</span> <span class="kw">seq</span>(<span class="dv">75</span>, <span class="dv">325</span>, <span class="dv">50</span>), <span class="dt">col =</span> <span class="st">&quot;gray95&quot;</span>, <span class="dt">lty =</span> <span class="st">&quot;solid&quot;</span>)
<span class="kw">hist</span>(mtcars<span class="op">$</span>hp,
  <span class="dt">col =</span> <span class="st">&quot;#56B4E9&quot;</span>, <span class="dt">border =</span> <span class="st">&quot;white&quot;</span>,
  <span class="dt">freq =</span> <span class="ot">TRUE</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>
  <span class="co"># labels = TRUE, axes = TRUE, ylim = c(0, 10.5),</span>
  <span class="co"># xlab = &quot;hp&quot;,main = &quot;Histogram with Base R&quot;</span>
)
<span class="kw">mtext</span>(<span class="st">&quot;hp&quot;</span>, <span class="dv">1</span>, <span class="dt">line =</span> <span class="fl">1.0</span>)
<span class="kw">mtext</span>(<span class="st">&quot;Frequency&quot;</span>, <span class="dv">2</span>, <span class="dt">line =</span> <span class="fl">1.0</span>)

<span class="kw">ggplot</span>(mtcars) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> hp), <span class="dt">fill =</span> <span class="st">&quot;#56B4E9&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">50</span>, <span class="dv">350</span>, <span class="dv">50</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">50</span>, <span class="dv">350</span>, <span class="dv">50</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">12</span>, <span class="dv">2</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;hp&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Frequency&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;Histogram with Ggplot2&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_minimal</span>(<span class="dt">base_size =</span> <span class="dv">12</span>)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-27"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-27-1.png" alt="直方图" width="70%" /><img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-27-2.png" alt="直方图" width="70%" />
<p class="caption">
图 12.32: 直方图
</p>
</div>
</div>
<div id="ggplot2-violin" class="section level3">
<h3><span class="header-section-number">14.2.6</span> 提琴图</h3>
<p>提琴图</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">y =</span> price)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()
<span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">y =</span> price)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_violin</span>()</code></pre>
<div class="figure" style="text-align: center"><span id="fig:violin"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/violin-1.png" alt="箱线图" width="70%" /><img src="15-data-visualization-with-ggplot2_files/figure-html/violin-2.png" alt="小提琴图" width="70%" />
<p class="caption">
图 14.25: 小提琴图
</p>
</div>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(class, cty)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_violin</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">title =</span> <span class="st">&quot;Violin plot&quot;</span>,
    <span class="dt">subtitle =</span> <span class="st">&quot;City Mileage vs Class of vehicle&quot;</span>,
    <span class="dt">caption =</span> <span class="st">&quot;Source: mpg&quot;</span>,
    <span class="dt">x =</span> <span class="st">&quot;Class of Vehicle&quot;</span>,
    <span class="dt">y =</span> <span class="st">&quot;City Mileage&quot;</span>
  ) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_minimal</span>()</code></pre>
<div class="figure" style="text-align: center"><span id="fig:violin-mpg"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/violin-mpg-1.png" alt="城市里程与车辆类别" width="70%" />
<p class="caption">
图 14.26: 城市里程与车辆类别
</p>
</div>
<p>蜂群图 <a href="https://github.com/eclarke/ggbeeswarm">ggbeeswarm</a> 是分类散点图加箱线图的合体</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> class, <span class="dt">y =</span> hwy, <span class="dt">color =</span> class)) <span class="op">+</span><span class="st"> </span>ggbeeswarm<span class="op">::</span><span class="kw">geom_quasirandom</span>()</code></pre>
<p><img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-28-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="ggplot2-jitter" class="section level3">
<h3><span class="header-section-number">14.2.7</span> 抖动图</h3>
<p>抖动图适合数据量比较小的情况</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> class, <span class="dt">y =</span> hwy, <span class="dt">color =</span> class)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_jitter</span>()</code></pre>
<p><img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-29-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>在数据量比较大的时候，可以用箱线图、密度图、提琴图</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">y =</span> price)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_jitter</span>()</code></pre>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-30"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-30-1.png" alt="抖动图的反例" width="70%" />
<p class="caption">
图 12.35: 抖动图的反例
</p>
</div>
<p>上色和分面都不好使的抖动图，因为区分度变小</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> color, <span class="dt">y =</span> price, <span class="dt">color =</span> color)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_jitter</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(clarity <span class="op">~</span><span class="st"> </span>cut)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-31"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-31-1.png" alt="根据钻石颜色上色" width="70%" />
<p class="caption">
图 12.37: 根据钻石颜色上色
</p>
</div>
<p>箱线图此时不宜分的过细</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> color, <span class="dt">y =</span> price, <span class="dt">color =</span> color)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(cut <span class="op">~</span><span class="st"> </span>clarity)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-32"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-32-1.png" alt="箱线图" width="70%" />
<p class="caption">
图 12.38: 箱线图
</p>
</div>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> color, <span class="dt">y =</span> price, <span class="dt">color =</span> color)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(<span class="op">~</span>clarity)</code></pre>
<p><img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-33-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>最好只比较一个维度</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> color, <span class="dt">y =</span> price, <span class="dt">color =</span> color)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>()</code></pre>
<p><img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-34-1.png" width="70%" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds) <span class="op">+</span>
<span class="st">  </span>ggridges<span class="op">::</span><span class="kw">geom_density_ridges</span>(<span class="kw">aes</span>(<span class="dt">y =</span> color, <span class="dt">x =</span> price, <span class="dt">fill =</span> color))
<span class="co">#&gt; Picking joint bandwidth of 535</span></code></pre>
<p><img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-35-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="ggplot2-ridge" class="section level3">
<h3><span class="header-section-number">14.2.8</span> 密度图</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(cty)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> <span class="kw">factor</span>(cyl)), <span class="dt">alpha =</span> <span class="fl">0.8</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">title =</span> <span class="st">&quot;Density plot&quot;</span>,
    <span class="dt">subtitle =</span> <span class="st">&quot;City Mileage Grouped by Number of cylinders&quot;</span>,
    <span class="dt">caption =</span> <span class="st">&quot;Source: mpg&quot;</span>,
    <span class="dt">x =</span> <span class="st">&quot;City Mileage&quot;</span>,
    <span class="dt">fill =</span> <span class="st">&quot;# Cylinders&quot;</span>
  )</code></pre>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-36"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-36-1.png" alt="按汽缸数分组的城市里程" width="70%" />
<p class="caption">
图 14.27: 按汽缸数分组的城市里程
</p>
</div>
<p>添加透明度，解决遮挡</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> price, <span class="dt">fill =</span> cut)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_density</span>()
<span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> price, <span class="dt">fill =</span> cut)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_density</span>(<span class="dt">alpha =</span> <span class="fl">0.5</span>)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:density"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/density-1.png" alt="密度图" width="70%" /><img src="15-data-visualization-with-ggplot2_files/figure-html/density-2.png" alt="添加透明度的密度图" width="70%" />
<p class="caption">
图 14.28: 添加透明度的密度图
</p>
</div>
<p>堆积密度图</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> price, <span class="dt">fill =</span> cut)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_density</span>(<span class="dt">position =</span> <span class="st">&quot;stack&quot;</span>)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:stack-density"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/stack-density-1.png" alt="堆积密度图" width="70%" />
<p class="caption">
图 14.29: 堆积密度图
</p>
</div>
<p>条件密度估计</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># You can use position=&quot;fill&quot; to produce a conditional density estimate</span>
<span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(carat, <span class="kw">stat</span>(count), <span class="dt">fill =</span> cut)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">position =</span> <span class="st">&quot;fill&quot;</span>)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-37"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-37-1.png" alt="条件密度估计图" width="70%" />
<p class="caption">
图 12.40: 条件密度估计图
</p>
</div>
<p>岭线图是密度图的一种变体，可以防止密度曲线重叠在一起</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds) <span class="op">+</span>
<span class="st">  </span>ggridges<span class="op">::</span><span class="kw">geom_density_ridges</span>(<span class="kw">aes</span>(<span class="dt">x =</span> price, <span class="dt">y =</span> color, <span class="dt">fill =</span> color))
<span class="co">#&gt; Picking joint bandwidth of 535</span></code></pre>
<p><img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-38-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>二维的密度图又是一种延伸</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density_2d</span>(<span class="kw">aes</span>(<span class="dt">color =</span> cut)) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(<span class="op">~</span>cut) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_viridis_d</span>()</code></pre>
<p><img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-39-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p><code>stat</code> 函数，特别是 nlevel 参数，在密度曲线之间填充我们又可以得到热力图</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price)) <span class="op">+</span>
<span class="st">  </span><span class="kw">stat_density_2d</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> <span class="kw">stat</span>(nlevel)), <span class="dt">geom =</span> <span class="st">&quot;polygon&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(. <span class="op">~</span><span class="st"> </span>cut) <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_viridis_c</span>()
<span class="co">#&gt; Warning in validDetails.polygon(x): NAs introduced by coercion</span>

<span class="co">#&gt; Warning in validDetails.polygon(x): NAs introduced by coercion</span>

<span class="co">#&gt; Warning in validDetails.polygon(x): NAs introduced by coercion</span>

<span class="co">#&gt; Warning in validDetails.polygon(x): NAs introduced by coercion</span>

<span class="co">#&gt; Warning in validDetails.polygon(x): NAs introduced by coercion</span></code></pre>
<p><img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-40-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p><code>gemo_hex</code> 也是二维密度图的一种变体，特别适合数据量比较大的情形</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_hex</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_viridis_c</span>()</code></pre>
<p><img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-41-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="ggplot2-rose" class="section level3">
<h3><span class="header-section-number">14.2.9</span> 玫瑰图</h3>
<p>南丁格尔风玫瑰图<a href="#fn37" class="footnote-ref" id="fnref37"><sup>37</sup></a> 可以作为堆积条形图，分组条形图</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> color, <span class="dt">fill =</span> clarity)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>()
<span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> color, <span class="dt">fill =</span> clarity)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_polar</span>()</code></pre>
<div class="figure" style="text-align: center"><span id="fig:stack-to-rose"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/stack-to-rose-1.png" alt="堆积条形图转风玫瑰图" width="70%" /><img src="15-data-visualization-with-ggplot2_files/figure-html/stack-to-rose-2.png" alt="堆积条形图转风玫瑰图" width="70%" />
<p class="caption">
图 14.30: 堆积条形图转风玫瑰图
</p>
</div>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 风玫瑰图 http://blog.csdn.net/Bone_ACE/article/details/47624987</span>
<span class="kw">library</span>(ggplot2)
<span class="kw">set.seed</span>(<span class="dv">2018</span>)
<span class="co"># 随机生成100次风向，并汇集到16个区间内</span>
direction &lt;-<span class="st"> </span><span class="kw">cut_interval</span>(<span class="kw">runif</span>(<span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">360</span>), <span class="dt">n =</span> <span class="dv">16</span>)
<span class="co"># 随机生成100次风速，并划分成4种强度</span>
mag &lt;-<span class="st"> </span><span class="kw">cut_interval</span>(<span class="kw">rgamma</span>(<span class="dv">100</span>, <span class="dv">15</span>), <span class="dv">4</span>)
dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">direction =</span> direction, <span class="dt">mag =</span> mag)
<span class="co"># 将风向映射到X轴，频数映射到Y轴，风速大小映射到填充色，生成条形图后再转为极坐标形式即可</span>
p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x =</span> direction, <span class="dt">y =</span> ..count.., <span class="dt">fill =</span> mag))
p <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">colour =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_polar</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(), <span class="dt">axis.text.y =</span> <span class="kw">element_blank</span>()) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;Magnitude&quot;</span>)

<span class="co"># p + geom_bar(position = &quot;stack&quot;) +</span>
<span class="co">#   coord_polar() +</span>
<span class="co">#   theme_minimal() +</span>
<span class="co">#   theme(axis.ticks = element_line(colour = &quot;white&quot;))</span></code></pre>
<div class="figure" style="text-align: center"><span id="fig:wind-rose"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/wind-rose-1.png" alt="风玫瑰图" width="70%" />
<p class="caption">
图 14.31: 风玫瑰图
</p>
</div>
<p>词云 <a href="https://github.com/lepennec/ggwordcloud">ggwordcloud</a></p>
</div>
</div>
<div id="ggplot2-spatial" class="section level2">
<h2><span class="header-section-number">14.3</span> 空间数据</h2>
<p>课程案例学习</p>
<ol style="list-style-type: decimal">
<li><a href="https://datacarpentry.org/r-raster-vector-geospatial/">2018-Introduction to Geospatial Raster and Vector Data with R</a> 空间数据分析课程</li>
<li><a href="http://freerangestats.info">Peter Ellis</a> 新西兰大选和普查数据 <a href="http://freerangestats.info/blog/nz.html">More cartograms of New Zealand census data: district and city level</a></li>
<li><a href="http://sharpsightlabs.com/blog/map-oil-production-country-r/">2017-Mapping oil production by country in R</a> 石油产量在全球的分布</li>
<li><a href="https://www.sharpsightlabs.com/blog/highlight-countries-on-map/">2017-How to highlight countries on a map</a> 高亮地图上的国家</li>
<li><a href="https://ryanpeek.github.io/2017-11-21-mapping-with-sf-part-3/">2017-Mapping With Sf: Part 3</a></li>
</ol>
<p>美国各州的犯罪率数据 USArrests</p>
<p>准备数据集</p>
<pre class="sourceCode r"><code class="sourceCode r">crimes &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">state =</span> <span class="kw">tolower</span>(<span class="kw">rownames</span>(USArrests)), USArrests)
crimesm &lt;-<span class="st"> </span>reshape2<span class="op">::</span><span class="kw">melt</span>(crimes, <span class="dt">id =</span> <span class="dv">1</span>)
<span class="kw">head</span>(crimesm)
<span class="co">#&gt;        state variable value</span>
<span class="co">#&gt; 1    alabama   Murder  13.2</span>
<span class="co">#&gt; 2     alaska   Murder  10.0</span>
<span class="co">#&gt; 3    arizona   Murder   8.1</span>
<span class="co">#&gt; 4   arkansas   Murder   8.8</span>
<span class="co">#&gt; 5 california   Murder   9.0</span>
<span class="co">#&gt; 6   colorado   Murder   7.9</span></code></pre>
<p>添加地图数据</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(maps)
states_map &lt;-<span class="st"> </span><span class="kw">map_data</span>(<span class="st">&quot;state&quot;</span>)
<span class="kw">head</span>(states_map)
<span class="co">#&gt;    long  lat group order  region subregion</span>
<span class="co">#&gt; 1 -87.5 30.4     1     1 alabama      &lt;NA&gt;</span>
<span class="co">#&gt; 2 -87.5 30.4     1     2 alabama      &lt;NA&gt;</span>
<span class="co">#&gt; 3 -87.5 30.4     1     3 alabama      &lt;NA&gt;</span>
<span class="co">#&gt; 4 -87.5 30.3     1     4 alabama      &lt;NA&gt;</span>
<span class="co">#&gt; 5 -87.6 30.3     1     5 alabama      &lt;NA&gt;</span>
<span class="co">#&gt; 6 -87.6 30.3     1     6 alabama      &lt;NA&gt;</span></code></pre>
<p>绘图</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(crimes, <span class="kw">aes</span>(<span class="dt">map_id =</span> state)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_map</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> Murder), <span class="dt">map =</span> states_map) <span class="op">+</span>
<span class="st">  </span><span class="kw">expand_limits</span>(<span class="dt">x =</span> states_map<span class="op">$</span>long, <span class="dt">y =</span> states_map<span class="op">$</span>lat) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_map</span>()</code></pre>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-44"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-44-1.png" alt="1973年美国各州的犯罪率数据" width="70%" />
<p class="caption">
图 14.32: 1973年美国各州的犯罪率数据
</p>
</div>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(crimesm, <span class="kw">aes</span>(<span class="dt">map_id =</span> state)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_map</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> value), <span class="dt">map =</span> states_map) <span class="op">+</span>
<span class="st">  </span><span class="kw">expand_limits</span>(<span class="dt">x =</span> states_map<span class="op">$</span>long, <span class="dt">y =</span> states_map<span class="op">$</span>lat) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>variable)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-45"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-45-1.png" alt="四类犯罪在各州的分布" width="70%" />
<p class="caption">
图 14.33: 四类犯罪在各州的分布
</p>
</div>
<p>比较 viridis 和 Spectral 两块调色板，如图 <a href="15-data-visualization-with-ggplot2.html#fig:pickcolor">14.34</a> 所示，可见 Spectral 的可识别性高些</p>
<pre class="sourceCode r"><code class="sourceCode r">dat &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">cbind</span>(<span class="kw">rep</span>(<span class="dv">1948</span> <span class="op">+</span><span class="st"> </span><span class="kw">seq</span>(<span class="dv">12</span>), <span class="dt">each =</span> <span class="dv">12</span>), <span class="kw">rep</span>(<span class="kw">seq</span>(<span class="dv">12</span>), <span class="dv">12</span>), AirPassengers))
<span class="kw">colnames</span>(dat) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;month&quot;</span>, <span class="st">&quot;passengers&quot;</span>)
<span class="kw">library</span>(colormap)
<span class="kw">ggplot</span>(<span class="dt">data =</span> dat, <span class="kw">aes</span>(<span class="kw">as.factor</span>(year), <span class="kw">as.factor</span>(month))) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> passengers), <span class="dt">pch =</span> <span class="dv">15</span>, <span class="dt">size =</span> <span class="dv">8</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_colour_distiller</span>(<span class="dt">palette =</span> <span class="st">&quot;Spectral&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Month&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_minimal</span>()</code></pre>
<div class="figure" style="text-align: center"><span id="fig:pickcolor"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/pickcolor-1.png" alt="viridis 和 Spectral对比" width="70%" />
<p class="caption">
图 14.34: viridis 和 Spectral对比
</p>
</div>
<p>再举栗子，图<a href="15-data-visualization-with-ggplot2.html#fig:faithfuld">14.35</a>是正负例对比，其中好在哪里呢？这张图要表达美国黄石国家公园的老忠实泉间歇喷发的时间规律，那么好的标准就是层次分明，以突出不同颜色之间的时间差异。这个差异，还要看起来不那么费眼睛，越一目了然越好。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(gridExtra)
erupt &lt;-<span class="st"> </span><span class="kw">ggplot</span>(faithfuld, <span class="kw">aes</span>(waiting, eruptions, <span class="dt">fill =</span> density)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_raster</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="ot">NULL</span>, <span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)
erupt1 &lt;-<span class="st"> </span>erupt <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_gradientn</span>(<span class="dt">colours =</span> <span class="kw">gray.colors</span>(<span class="dv">7</span>))
erupt2 &lt;-<span class="st"> </span>erupt <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_distiller</span>(<span class="dt">palette =</span> <span class="st">&quot;Spectral&quot;</span>)
erupt3 &lt;-<span class="st"> </span>erupt <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_gradientn</span>(<span class="dt">colours =</span> <span class="kw">terrain.colors</span>(<span class="dv">7</span>))
erupt4 &lt;-<span class="st"> </span>erupt <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_colormap</span>(<span class="dt">colormap =</span> colormaps<span class="op">$</span>RdBu)
<span class="kw">grid.arrange</span>(erupt1, erupt2, erupt3, erupt4, <span class="dt">ncol =</span> <span class="dv">2</span>)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:faithfuld"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/faithfuld-1.png" alt="美国黄石国家公园的老忠实泉" width="70%" />
<p class="caption">
图 14.35: 美国黄石国家公园的老忠实泉
</p>
</div>
<p>此处调用 RColorBrewer 中 Spectral 调色板，它本来只有11中颜色，通过 <code>scale_colour_distiller</code> 却可以把它映射到连续型数值变量 <code>mag</code> 上，发散型调色板本身的对比性也可以起到很好的区分度，如图 <a href="15-data-visualization-with-ggplot2.html#fig:fiji-map">14.36</a> 所示</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(mapdata)
FijiMap &lt;-<span class="st"> </span><span class="kw">map_data</span>(<span class="st">&quot;worldHires&quot;</span>, <span class="dt">region =</span> <span class="st">&quot;Fiji&quot;</span>)
<span class="kw">ggplot</span>(FijiMap, <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_map</span>(<span class="dt">map =</span> FijiMap, <span class="kw">aes</span>(<span class="dt">map_id =</span> region), <span class="dt">size =</span> <span class="fl">.2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> quakes, <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">colour =</span> mag), <span class="dt">pch =</span> <span class="dv">16</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlim</span>(<span class="dv">160</span>, <span class="dv">195</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_colour_distiller</span>(<span class="dt">palette =</span> <span class="st">&quot;Spectral&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> (<span class="op">-</span><span class="dv">18</span><span class="op">:</span><span class="dv">18</span>) <span class="op">*</span><span class="st"> </span><span class="dv">5</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_map</span>(<span class="st">&quot;ortho&quot;</span>, <span class="dt">orientation =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">10</span>, <span class="dv">180</span>, <span class="dv">0</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">colour =</span> <span class="st">&quot;Magnitude&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Longitude&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Latitude&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>()</code></pre>
<div class="figure" style="text-align: center"><span id="fig:fiji-map"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/fiji-map-1.png" alt="斐济地震带" width="70%" />
<p class="caption">
图 14.36: 斐济地震带
</p>
</div>
<p>此外， colormap 包提供更加丰富的调色板，通过 <code>scale_color_colormap</code> 支持 ggplot2 绘图风格</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 数据来源 http://datasets.flowingdata.com/unemployment09.csv</span>
unemp &lt;-<span class="st"> </span><span class="kw">read.csv</span>(
  <span class="dt">file =</span> <span class="st">&quot;http://datasets.flowingdata.com/unemployment09.csv&quot;</span>,
  <span class="dt">header =</span> <span class="ot">FALSE</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>
)
<span class="kw">names</span>(unemp) &lt;-<span class="st"> </span><span class="kw">c</span>(
  <span class="st">&quot;id&quot;</span>, <span class="st">&quot;state_fips&quot;</span>, <span class="st">&quot;county_fips&quot;</span>, <span class="st">&quot;name&quot;</span>, <span class="st">&quot;year&quot;</span>,
  <span class="st">&quot;?&quot;</span>, <span class="st">&quot;?&quot;</span>, <span class="st">&quot;?&quot;</span>, <span class="st">&quot;rate&quot;</span>
)
unemp<span class="op">$</span>county &lt;-<span class="st"> </span><span class="kw">tolower</span>(<span class="kw">gsub</span>(<span class="st">&quot; County, [A-Z]{2}&quot;</span>, <span class="st">&quot;&quot;</span>, unemp<span class="op">$</span>name))
unemp<span class="op">$</span>state &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;^.*([A-Z]{2}).*$&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1&quot;</span>, unemp<span class="op">$</span>name)

county_df &lt;-<span class="st"> </span><span class="kw">map_data</span>(<span class="st">&quot;county&quot;</span>)
<span class="kw">names</span>(county_df) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;long&quot;</span>, <span class="st">&quot;lat&quot;</span>, <span class="st">&quot;group&quot;</span>, <span class="st">&quot;order&quot;</span>, <span class="st">&quot;state_name&quot;</span>, <span class="st">&quot;county&quot;</span>)
county_df<span class="op">$</span>state &lt;-<span class="st"> </span>state.abb[<span class="kw">match</span>(county_df<span class="op">$</span>state_name, <span class="kw">tolower</span>(state.name))]
county_df<span class="op">$</span>state_name &lt;-<span class="st"> </span><span class="ot">NULL</span>

state_df &lt;-<span class="st"> </span><span class="kw">map_data</span>(<span class="st">&quot;state&quot;</span>)
<span class="co"># Combine together</span>
choropleth &lt;-<span class="st"> </span><span class="kw">merge</span>(county_df, unemp, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;state&quot;</span>, <span class="st">&quot;county&quot;</span>))
choropleth &lt;-<span class="st"> </span>choropleth[<span class="kw">order</span>(choropleth<span class="op">$</span>order), ]
choropleth<span class="op">$</span>rate_d &lt;-<span class="st"> </span><span class="kw">cut</span>(choropleth<span class="op">$</span>rate, <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dt">by =</span> <span class="dv">2</span>), <span class="dv">35</span>))

<span class="kw">library</span>(ggthemes)
<span class="kw">ggplot</span>(choropleth, <span class="kw">aes</span>(long, lat, <span class="dt">group =</span> group)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_polygon</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> rate_d), <span class="dt">colour =</span> <span class="kw">alpha</span>(<span class="st">&quot;white&quot;</span>, <span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="dv">4</span>), <span class="dt">size =</span> <span class="fl">0.2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> state_df, <span class="dt">colour =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">fill =</span> <span class="ot">NA</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;PuRd&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(
    <span class="dt">fill =</span> <span class="st">&quot;ratio of unemployment&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;unemployment by county, 2009&quot;</span>,
    <span class="dt">caption =</span> <span class="st">&quot;data source: http://datasets.flowingdata.com/unemployment09.csv&quot;</span>
  ) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_map</span>(<span class="st">&quot;polyconic&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_map</span>()</code></pre>
<div class="figure" style="text-align: center"><span id="fig:unemploymentGG"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/unemploymentGG-1.png" alt="2009年美国各城镇失业率" width="70%" />
<p class="caption">
图 14.37: 2009年美国各城镇失业率
</p>
</div>
<p>美国各地区失业率地图，配不同颜色， <a href="https://github.com/bhaskarvk/colormap">colormap</a> 适合给静态图配色</p>
<div id="ggplot2-raster" class="section level3">
<h3><span class="header-section-number">14.3.1</span> raster</h3>
<p>raster 包定义了获取和操作空间 raster 类型数据集的类和方法，rasterVis 补充加强了 raster 包在数据可视化和交互方面的功能。可视化是基于 lattice 的</p>
<p><a href="https://github.com/rspatial/raster">raster</a> 包的开发已经被作者 <a href="https://desp.ucdavis.edu/people/robert-j-hijmans">Robert J. Hijmans</a> 迁移到 Github 上啦，官方文档 <a href="https://www.rspatial.org/" class="uri">https://www.rspatial.org/</a></p>
<p>星号 * 标记的是 S3 方法</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">methods</span>(plot)
<span class="co">#&gt;  [1] plot,ANY,ANY-method                       </span>
<span class="co">#&gt;  [2] plot,color,ANY-method                     </span>
<span class="co">#&gt;  [3] plot,hexbin,missing-method                </span>
<span class="co">#&gt;  [4] plot,Spatial,missing-method               </span>
<span class="co">#&gt;  [5] plot,SpatialGrid,missing-method           </span>
<span class="co">#&gt;  [6] plot,SpatialGridDataFrame,missing-method  </span>
<span class="co">#&gt;  [7] plot,SpatialLines,missing-method          </span>
<span class="co">#&gt;  [8] plot,SpatialMultiPoints,missing-method    </span>
<span class="co">#&gt;  [9] plot,SpatialPixels,missing-method         </span>
<span class="co">#&gt; [10] plot,SpatialPixelsDataFrame,missing-method</span>
<span class="co">#&gt; [11] plot,SpatialPoints,missing-method         </span>
<span class="co">#&gt; [12] plot,SpatialPolygons,missing-method       </span>
<span class="co">#&gt; [13] plot.acf*                                 </span>
<span class="co">#&gt; [14] plot.ACF*                                 </span>
<span class="co">#&gt; [15] plot.augPred*                             </span>
<span class="co">#&gt; [16] plot.bclust*                              </span>
<span class="co">#&gt; [17] plot.classIntervals*                      </span>
<span class="co">#&gt; [18] plot.compareFits*                         </span>
<span class="co">#&gt; [19] plot.correspondence*                      </span>
<span class="co">#&gt; [20] plot.data.frame*                          </span>
<span class="co">#&gt; [21] plot.decomposed.ts*                       </span>
<span class="co">#&gt; [22] plot.default                              </span>
<span class="co">#&gt; [23] plot.dendrogram*                          </span>
<span class="co">#&gt; [24] plot.density*                             </span>
<span class="co">#&gt; [25] plot.ecdf                                 </span>
<span class="co">#&gt; [26] plot.factor*                              </span>
<span class="co">#&gt; [27] plot.formula*                             </span>
<span class="co">#&gt; [28] plot.function                             </span>
<span class="co">#&gt; [29] plot.ggplot*                              </span>
<span class="co">#&gt; [30] plot.gls*                                 </span>
<span class="co">#&gt; [31] plot.gtable*                              </span>
<span class="co">#&gt; [32] plot.hcl_palettes*                        </span>
<span class="co">#&gt; [33] plot.hclust*                              </span>
<span class="co">#&gt; [34] plot.histogram*                           </span>
<span class="co">#&gt; [35] plot.HoltWinters*                         </span>
<span class="co">#&gt; [36] plot.ica*                                 </span>
<span class="co">#&gt; [37] plot.intervals.lmList*                    </span>
<span class="co">#&gt; [38] plot.isoreg*                              </span>
<span class="co">#&gt; [39] plot.lda*                                 </span>
<span class="co">#&gt; [40] plot.lm*                                  </span>
<span class="co">#&gt; [41] plot.lme                                  </span>
<span class="co">#&gt; [42] plot.lmList*                              </span>
<span class="co">#&gt; [43] plot.mca*                                 </span>
<span class="co">#&gt; [44] plot.medpolish*                           </span>
<span class="co">#&gt; [45] plot.mlm*                                 </span>
<span class="co">#&gt; [46] plot.nffGroupedData*                      </span>
<span class="co">#&gt; [47] plot.nfnGroupedData*                      </span>
<span class="co">#&gt; [48] plot.nls*                                 </span>
<span class="co">#&gt; [49] plot.nmGroupedData*                       </span>
<span class="co">#&gt; [50] plot.pdMat*                               </span>
<span class="co">#&gt; [51] plot.ppr*                                 </span>
<span class="co">#&gt; [52] plot.prcomp*                              </span>
<span class="co">#&gt; [53] plot.princomp*                            </span>
<span class="co">#&gt; [54] plot.profile*                             </span>
<span class="co">#&gt; [55] plot.profile.nls*                         </span>
<span class="co">#&gt; [56] plot.R6*                                  </span>
<span class="co">#&gt; [57] plot.ranef.lme*                           </span>
<span class="co">#&gt; [58] plot.ranef.lmList*                        </span>
<span class="co">#&gt; [59] plot.raster*                              </span>
<span class="co">#&gt; [60] plot.ridgelm*                             </span>
<span class="co">#&gt; [61] plot.sf*                                  </span>
<span class="co">#&gt; [62] plot.sfc_CIRCULARSTRING*                  </span>
<span class="co">#&gt; [63] plot.sfc_GEOMETRY*                        </span>
<span class="co">#&gt; [64] plot.sfc_GEOMETRYCOLLECTION*              </span>
<span class="co">#&gt; [65] plot.sfc_LINESTRING*                      </span>
<span class="co">#&gt; [66] plot.sfc_MULTILINESTRING*                 </span>
<span class="co">#&gt; [67] plot.sfc_MULTIPOINT*                      </span>
<span class="co">#&gt; [68] plot.sfc_MULTIPOLYGON*                    </span>
<span class="co">#&gt; [69] plot.sfc_POINT*                           </span>
<span class="co">#&gt; [70] plot.sfc_POLYGON*                         </span>
<span class="co">#&gt; [71] plot.sfg*                                 </span>
<span class="co">#&gt; [72] plot.shingle*                             </span>
<span class="co">#&gt; [73] plot.simulate.lme*                        </span>
<span class="co">#&gt; [74] plot.SOM*                                 </span>
<span class="co">#&gt; [75] plot.somgrid*                             </span>
<span class="co">#&gt; [76] plot.spec*                                </span>
<span class="co">#&gt; [77] plot.stars*                               </span>
<span class="co">#&gt; [78] plot.stars_proxy*                         </span>
<span class="co">#&gt; [79] plot.stepfun                              </span>
<span class="co">#&gt; [80] plot.stft*                                </span>
<span class="co">#&gt; [81] plot.stl*                                 </span>
<span class="co">#&gt; [82] plot.svm*                                 </span>
<span class="co">#&gt; [83] plot.table*                               </span>
<span class="co">#&gt; [84] plot.trellis*                             </span>
<span class="co">#&gt; [85] plot.ts                                   </span>
<span class="co">#&gt; [86] plot.tskernel*                            </span>
<span class="co">#&gt; [87] plot.TukeyHSD*                            </span>
<span class="co">#&gt; [88] plot.tune*                                </span>
<span class="co">#&gt; [89] plot.units*                               </span>
<span class="co">#&gt; [90] plot.Variogram*                           </span>
<span class="co">#&gt; see &#39;?methods&#39; for accessing help and source code</span></code></pre>
<p>查看函数的定义</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">getAnywhere</span>(plot.raster)
<span class="co">#&gt; A single object matching &#39;plot.raster&#39; was found</span>
<span class="co">#&gt; It was found in the following places</span>
<span class="co">#&gt;   registered S3 method for plot from namespace graphics</span>
<span class="co">#&gt;   namespace:graphics</span>
<span class="co">#&gt; with value</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; function (x, y, xlim = c(0, ncol(x)), ylim = c(0, nrow(x)), xaxs = &quot;i&quot;, </span>
<span class="co">#&gt;     yaxs = &quot;i&quot;, asp = 1, add = FALSE, ...) </span>
<span class="co">#&gt; {</span>
<span class="co">#&gt;     if (!add) {</span>
<span class="co">#&gt;         plot.new()</span>
<span class="co">#&gt;         plot.window(xlim = xlim, ylim = ylim, asp = asp, xaxs = xaxs, </span>
<span class="co">#&gt;             yaxs = yaxs)</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     rasterImage(x, 0, 0, ncol(x), nrow(x), ...)</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; &lt;bytecode: 0x00000000336a66f8&gt;</span>
<span class="co">#&gt; &lt;environment: namespace:graphics&gt;</span></code></pre>
<p>rasterImage 函数来绘制图像，如果想知道 <code>rasterImage</code> 的内容可以继续看 <code>getAnywhere(rasterImage)</code></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">getAnywhere</span>(rasterImage)
<span class="co">#&gt; A single object matching &#39;rasterImage&#39; was found</span>
<span class="co">#&gt; It was found in the following places</span>
<span class="co">#&gt;   package:graphics</span>
<span class="co">#&gt;   namespace:graphics</span>
<span class="co">#&gt; with value</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; function (image, xleft, ybottom, xright, ytop, angle = 0, interpolate = TRUE, </span>
<span class="co">#&gt;     ...) </span>
<span class="co">#&gt; {</span>
<span class="co">#&gt;     .External.graphics(C_raster, if (inherits(image, &quot;nativeRaster&quot;)) image else as.raster(image), </span>
<span class="co">#&gt;         as.double(xleft), as.double(ybottom), as.double(xright), </span>
<span class="co">#&gt;         as.double(ytop), as.double(angle), as.logical(interpolate), </span>
<span class="co">#&gt;         ...)</span>
<span class="co">#&gt;     invisible()</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; &lt;bytecode: 0x0000000034395960&gt;</span>
<span class="co">#&gt; &lt;environment: namespace:graphics&gt;</span></code></pre>
<p>通过查看函数的帮助 <code>?rasterImage</code> ，我们需要重点关注一下
参数 <em>image</em> 传递的 raster 对象</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="kw">c</span>(<span class="dv">100</span>, <span class="dv">250</span>), <span class="kw">c</span>(<span class="dv">300</span>, <span class="dv">450</span>), <span class="dt">type =</span> <span class="st">&quot;n&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>)
image &lt;-<span class="st"> </span><span class="kw">as.raster</span>(<span class="kw">matrix</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">1</span>, <span class="dt">ncol =</span> <span class="dv">5</span>, <span class="dt">nrow =</span> <span class="dv">3</span>))
<span class="kw">rasterImage</span>(image, <span class="dv">100</span>, <span class="dv">300</span>, <span class="dv">150</span>, <span class="dv">350</span>, <span class="dt">interpolate =</span> <span class="ot">FALSE</span>)
<span class="kw">rasterImage</span>(image, <span class="dv">100</span>, <span class="dv">400</span>, <span class="dv">150</span>, <span class="dv">450</span>)
<span class="kw">rasterImage</span>(image, <span class="dv">200</span>, <span class="dv">300</span>, <span class="dv">200</span> <span class="op">+</span><span class="st"> </span><span class="kw">xinch</span>(.<span class="dv">5</span>), <span class="dv">300</span> <span class="op">+</span><span class="st"> </span><span class="kw">yinch</span>(.<span class="dv">3</span>),
  <span class="dt">interpolate =</span> <span class="ot">FALSE</span>
)
<span class="kw">rasterImage</span>(image, <span class="dv">200</span>, <span class="dv">400</span>, <span class="dv">250</span>, <span class="dv">450</span>, <span class="dt">angle =</span> <span class="dv">15</span>, <span class="dt">interpolate =</span> <span class="ot">FALSE</span>)</code></pre>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-49"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-49-1.png" alt="raster 图像" width="50%" />
<p class="caption">
图 14.38: raster 图像
</p>
</div>
<p>Edzer Pebesma 开发了 stars 包</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># https://resources.rstudio.com/rstudio-conf-2019/spatial-data-science-in-the-tidyverse</span>
<span class="kw">library</span>(abind)
<span class="kw">library</span>(sf)
<span class="kw">library</span>(stars)
x &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;tif/L7_ETMs.tif&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;stars&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">read_stars</span>()
<span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_stars</span>(<span class="dt">data =</span> x) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_equal</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>band) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_void</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_viridis_c</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_discrete</span>(<span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_discrete</span>(<span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))</code></pre>
<p><img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-50-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="ggplot2-sp" class="section level3">
<h3><span class="header-section-number">14.3.2</span> sp</h3>
<p>空间数据对象，以类 sp 方式存储 <span class="citation">(Pebesma and Bivand <a href="#ref-Pebesma_2005_sp" role="doc-biblioref">2005</a>)</span></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(sp)
<span class="kw">data</span>(meuse)
coords &lt;-<span class="st"> </span><span class="kw">SpatialPoints</span>(meuse[<span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>)])
meuse &lt;-<span class="st"> </span><span class="kw">SpatialPointsDataFrame</span>(coords, meuse)
<span class="kw">plot</span>(meuse, <span class="dt">pch =</span> <span class="dv">1</span>, <span class="dt">cex =</span> <span class="fl">.05</span> <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(meuse<span class="op">$</span>zinc))</code></pre>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-51"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-51-1.png" alt="气泡图" width="70%" />
<p class="caption">
图 12.51: 气泡图
</p>
</div>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(maptools)
fname &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;shapes/sids.shp&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;maptools&quot;</span>)
p4s &lt;-<span class="st"> </span><span class="kw">CRS</span>(<span class="st">&quot;+proj=longlat +datum=NAD27&quot;</span>)
nc &lt;-<span class="st"> </span><span class="kw">readShapePoly</span>(fname, <span class="dt">proj4string =</span> p4s)
<span class="co">#&gt; Warning: readShapePoly is deprecated; use rgdal::readOGR or sf::st_read</span>
<span class="kw">plot</span>(nc, <span class="dt">axes =</span> <span class="ot">TRUE</span>, <span class="dt">col =</span> <span class="kw">grey</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>nc<span class="op">$</span>SID79 <span class="op">/</span><span class="st"> </span><span class="dv">57</span>))</code></pre>
<p><img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-52-1.png" width="70%" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Trellis maps</span>
arrow &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;SpatialPolygonsRescale&quot;</span>,
  <span class="kw">layout.north.arrow</span>(<span class="dv">2</span>),
  <span class="dt">offset =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">76</span>, <span class="dv">34</span>), <span class="dt">scale =</span> <span class="fl">0.5</span>, <span class="dt">which =</span> <span class="dv">2</span>
)
<span class="kw">spplot</span>(nc, <span class="kw">c</span>(<span class="st">&quot;SID74&quot;</span>, <span class="st">&quot;SID79&quot;</span>),
  <span class="dt">as.table =</span> <span class="ot">TRUE</span>,
  <span class="dt">scales =</span> <span class="kw">list</span>(<span class="dt">draw =</span> T), <span class="dt">sp.layout =</span> arrow
)</code></pre>
<p><img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-53-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="warning">
<p>maptools 提供的 <code>readShapePoly</code> 函数去读取 shp 文件的方式已经过时，推荐使用 <code>rgdal::readOGR</code> 或者 <code>sf::st_read</code> 方式读取</p>
</div>
</div>
<div id="ggplot2-sf" class="section level3">
<h3><span class="header-section-number">14.3.3</span> sf</h3>
<ul>
<li><p>maps</p></li>
<li><p>mapdata</p></li>
<li><p>maptools</p></li>
<li><p>mapproj</p></li>
<li><p>rgeos</p></li>
<li><p>rgdal</p></li>
<li><p>sp</p></li>
<li><p>ggmap</p></li>
<li><p>sf</p></li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r">nc &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;gpkg/nc.gpkg&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;sf&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">read_sf</span>()
nc2 &lt;-<span class="st"> </span>nc <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(SID74, SID79) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(VAR, SID, <span class="op">-</span>geom)
<span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> nc2, <span class="kw">aes</span>(<span class="dt">fill =</span> SID)) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>VAR, <span class="dt">ncol =</span> <span class="dv">1</span>)</code></pre>
<p><img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-54-1.png" width="70%" style="display: block; margin: auto;" /></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(GADMTools)
<span class="kw">data</span>(<span class="st">&quot;Corsica&quot;</span>)
<span class="co"># basefile 文件存放路径</span>
<span class="co"># FRA Corse 的国家代码</span>
map &lt;-<span class="st"> </span><span class="kw">gadm_sf_loadCountries</span>(<span class="st">&quot;FRA&quot;</span>, <span class="dt">basefile =</span> <span class="st">&quot;./&quot;</span>)
<span class="kw">gadm_plot</span>(map) <span class="op">+</span><span class="st"> </span><span class="kw">theme_minimal</span>()</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(maps) <span class="co"># For map data</span>
<span class="kw">library</span>(mapdata)
<span class="kw">library</span>(ggplot2)
east_asia &lt;-<span class="st"> </span><span class="kw">map_data</span>(<span class="st">&quot;worldHires&quot;</span>, <span class="dt">region =</span> <span class="kw">c</span>(<span class="st">&quot;Japan&quot;</span>, <span class="st">&quot;China&quot;</span>, <span class="st">&quot;North Korea&quot;</span>, <span class="st">&quot;South Korea&quot;</span>))

<span class="co"># Map region to fill color</span>
<span class="kw">ggplot</span>(east_asia, <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group, <span class="dt">fill =</span> region)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Set2&quot;</span>)</code></pre>
<p><img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-56-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="ggplot2-network" class="section level2">
<h2><span class="header-section-number">14.4</span> 网络数据</h2>
<p><a href="https://igraph.org/">igraph</a> 提供了 R 和 Python 接口 <a href="https://github.com/igraph" class="uri">https://github.com/igraph</a>。 <a href="https://github.com/SachaEpskamp/qgraph">qgraph</a> 开发者 <a href="http://sachaepskamp.com">Sacha Epskamp</a> 在个人主页上提供了很多网络数据分析的学习资料， <a href="https://www.bioconductor.org/packages/release/bioc/html/Rgraphviz.html">Rgraphviz</a> 基于 <a href="https://www.graphviz.org/">Graphviz</a></p>
<pre class="sourceCode r"><code class="sourceCode r">BiocManager<span class="op">::</span><span class="kw">install</span>(<span class="st">&quot;Rgraphviz&quot;</span>, <span class="dt">version =</span> <span class="st">&quot;3.8&quot;</span>)</code></pre>
<p>Gephi <span class="citation">(Bastian, Heymann, and Jacomy <a href="#ref-ICWSM_2009_Gephi" role="doc-biblioref">2009</a>)</span> 和 igraph 能处理的最大网络，R 包和作者依赖关系图 14000+ 包和 7000+ 作者，CRAN 是全球R包开发者之网，自发布 R 1.0.0 (February, 2000) 距今19年</p>
<p>案例学习</p>
<ol style="list-style-type: decimal">
<li><a href="https://www.buzzfeed.com/johntemplon/help-us-map-trumpworld">2017-Help Us Map TrumpWorld</a></li>
<li><a href="https://lucidmanager.org/trumpworld-analysis/">2017-Trumpworld Analysis: Ownership Relations in his Business Network</a></li>
<li><a href="https://shirinsplayground.netlify.com/2017/07/twitter-analysis-codecentric/">2017-Social Network Analysis and Topic Modeling of codecentric’s Twitter friends and followers</a></li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(DiagrammeR)
<span class="kw">library</span>(DiagrammeRsvg)
svg &lt;-<span class="st"> </span><span class="kw">export_svg</span>(
  <span class="kw">grViz</span>(<span class="st">&quot;</span>
<span class="st">digraph neato {</span>

<span class="st">graph [layout = neato]</span>

<span class="st">node [shape = circle,</span>
<span class="st">      style = filled,</span>
<span class="st">      color = grey,</span>
<span class="st">      label = &#39;&#39;]</span>

<span class="st">node [fillcolor = red]</span>
<span class="st">yihui_pkgs$Package</span>

<span class="st">node [fillcolor = green]</span>
<span class="st">unique(unlist(ctb))</span>

<span class="st">node [fillcolor = orange]</span>

<span class="st">edge [color = grey]</span>
<span class="st">yihui_pkgs$Package[1] -&gt; ctb[[1]]</span>
<span class="st">yihui_pkgs$Package[2] -&gt; ctb[[2]]</span>
<span class="st">yihui_pkgs$Package[3] -&gt; ctb[[3]]</span>
<span class="st">yihui_pkgs$Package[4] -&gt; ctb[[4]]</span>
<span class="st">}&quot;</span>)
)
<span class="co"># this can then be used with htmltools and can save significantly</span>
<span class="co"># on size of output using svg rather than unrendered grViz</span>
<span class="kw">library</span>(htmltools)
<span class="kw">HTML</span>(svg) <span class="co"># 将输出结果保存在svg格式矢量文件 即可</span>
<span class="kw">html_print</span>(<span class="kw">HTML</span>(svg))</code></pre>
<ul>
<li><a href="https://smallstats.blogspot.com/search/label/igraph">igraph 使用</a></li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># https://smallstats.blogspot.jp/2012/12/loading-huge-graphs-with-igraph-and-r.html</span>
<span class="co"># Loading huge graphs with igraph and R</span>
df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">src =</span> <span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">1000</span>, <span class="dv">1000000</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>),

  <span class="dt">dst =</span> <span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">1000</span>, <span class="dv">1000000</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)
)

<span class="kw">library</span>(igraph)
<span class="kw">cat</span>(<span class="st">&quot;--- Creating data.frame ---&quot;</span>)
start &lt;-<span class="st"> </span><span class="kw">proc.time</span>()
df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">src =</span> <span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">1000</span>, <span class="dv">10000000</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>),
  <span class="dt">dst =</span> <span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">1000</span>, <span class="dv">10000000</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)
)

<span class="kw">cat</span>(<span class="kw">sprintf</span>(<span class="st">&quot;— elapsed time: %fs &quot;</span>, (<span class="kw">proc.time</span>() <span class="op">-</span><span class="st"> </span>start)[<span class="dv">1</span>]))
<span class="kw">cat</span>(<span class="st">&quot;— Creating graph… &quot;</span>)
start &lt;-<span class="st"> </span><span class="kw">proc.time</span>()
G &lt;-<span class="st"> </span><span class="kw">graph.data.frame</span>(df, <span class="dt">directed =</span> <span class="ot">TRUE</span>)
<span class="kw">cat</span>(<span class="kw">sprintf</span>(<span class="st">&quot;---elapsed user-time: %fs &quot;</span>, (<span class="kw">proc.time</span>() <span class="op">-</span><span class="st"> </span>start)[<span class="dv">1</span>]))


<span class="kw">cat</span>(<span class="st">&quot;...Creating graph...&quot;</span>)

start &lt;-<span class="st"> </span><span class="kw">proc.time</span>()

vertex.attrs &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">name =</span> <span class="kw">unique</span>(<span class="kw">c</span>(df<span class="op">$</span>src, df<span class="op">$</span>dst)))
edges &lt;-<span class="st"> </span><span class="kw">rbind</span>(
  <span class="kw">match</span>(df<span class="op">$</span>src, vertex.attrs<span class="op">$</span>name),
  <span class="kw">match</span>(df<span class="op">$</span>dst, vertex.attrs<span class="op">$</span>name)
)

G &lt;-<span class="st"> </span><span class="kw">graph.empty</span>(<span class="dt">n =</span> <span class="dv">0</span>, <span class="dt">directed =</span> T)
G &lt;-<span class="st"> </span><span class="kw">add.vertices</span>(G, <span class="kw">length</span>(vertex.attrs<span class="op">$</span>name), <span class="dt">attr =</span> vertex.attrs)
G &lt;-<span class="st"> </span><span class="kw">add.edges</span>(G, edges)

<span class="kw">remove</span>(edges)
<span class="kw">remove</span>(vertex.attrs)

<span class="kw">cat</span>(<span class="kw">sprintf</span>(<span class="st">&quot;--- elapsed user-time: %fs &quot;</span>, (<span class="kw">proc.time</span>() <span class="op">-</span><span class="st"> </span>start)[<span class="dv">1</span>]))</code></pre>
</div>
<div id="analysis-cran" class="section level2">
<h2><span class="header-section-number">14.5</span> CRAN 分析</h2>
<blockquote>
<p>ggraph 和 igraph 可视化</p>
</blockquote>
<p>首先我们从 CRAN 官网下载 R 包描述信息<a href="#fn38" class="footnote-ref" id="fnref38"><sup>38</sup></a></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># CRAN R 包 metadata 信息</span>
<span class="cf">if</span> (<span class="kw">file.exists</span>(<span class="st">&quot;data/packages.rds&quot;</span>)) {
  pdb &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;data/packages.rds&quot;</span>)
} <span class="cf">else</span> {
  pdb &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="dt">file =</span> <span class="kw">file</span>(<span class="kw">sprintf</span>(<span class="st">&quot;%s/web/packages/packages.rds&quot;</span>, <span class="kw">getOption</span>(<span class="st">&quot;repos&quot;</span>)[<span class="st">&quot;CRAN&quot;</span>])))
}</code></pre>
<p>接着，我们可以看看CRAN 上发布的 R 包数量</p>
<pre class="sourceCode r"><code class="sourceCode r">pdb[, <span class="st">&quot;Package&quot;</span>] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">length</span>()
<span class="co">#&gt; [1] 14339</span></code></pre>
<p>经过与官网发布的数据来对比，我们发现这里计算的结果与实际不符，多出来了几十个R包，所以我们再观察一下是否有重复的 R 包描述信息</p>
<pre class="sourceCode r"><code class="sourceCode r">pdb[, <span class="st">&quot;Package&quot;</span>][<span class="kw">duplicated</span>(pdb[, <span class="st">&quot;Package&quot;</span>])]
<span class="co">#&gt;  [1] &quot;boot&quot;       &quot;class&quot;      &quot;cluster&quot;    &quot;codetools&quot;  &quot;foreign&quot;   </span>
<span class="co">#&gt;  [6] &quot;KernSmooth&quot; &quot;lattice&quot;    &quot;MASS&quot;       &quot;Matrix&quot;     &quot;mgcv&quot;      </span>
<span class="co">#&gt; [11] &quot;nlme&quot;       &quot;nnet&quot;       &quot;rpart&quot;      &quot;spatial&quot;    &quot;survival&quot;</span></code></pre>
<p>不难发现，果然有！所以去掉重复的 R 包信息，就是 CRAN 上实际发布的 R 包数量</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">subset</span>(pdb, <span class="dt">subset =</span> <span class="op">!</span><span class="kw">duplicated</span>(pdb[, <span class="st">&quot;Package&quot;</span>]), <span class="dt">select =</span> <span class="kw">c</span>(<span class="st">&quot;Package&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">length</span>()
<span class="co">#&gt; [1] 14324</span></code></pre>
<p>接下来，我们再来查看一些比较高产的 R 包开发者谢益辉都维护了哪些R包，如表 <a href="15-data-visualization-with-ggplot2.html#tab:rmarkdown-eco">14.1</a> 所示</p>
<pre class="sourceCode r"><code class="sourceCode r">yihui_pkg &lt;-<span class="st"> </span><span class="kw">subset</span>(pdb,
  <span class="dt">subset =</span> <span class="kw">grepl</span>(<span class="st">&quot;Yihui Xie&quot;</span>, pdb[, <span class="st">&quot;Maintainer&quot;</span>]),
  <span class="dt">select =</span> <span class="kw">c</span>(<span class="st">&quot;Package&quot;</span>, <span class="st">&quot;Maintainer&quot;</span>, <span class="st">&quot;Title&quot;</span>)
)
yihui_pkg[, <span class="st">&quot;Title&quot;</span>] &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;(</span><span class="ch">\\\n</span><span class="st">)&quot;</span>, <span class="st">&quot; &quot;</span>, yihui_pkg[, <span class="st">&quot;Title&quot;</span>])

yihui_pkg <span class="op">%&gt;%</span>
<span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>(<span class="dt">caption =</span> <span class="st">&quot;谢益辉维护的 R Markdown 生态&quot;</span>, <span class="dt">booktabs =</span> <span class="ot">TRUE</span>)</code></pre>
<table>
<caption><span id="tab:rmarkdown-eco">表 14.1: </span>谢益辉维护的 R Markdown 生态</caption>
<thead>
<tr class="header">
<th align="left">Package</th>
<th align="left">Maintainer</th>
<th align="left">Title</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">animation</td>
<td align="left">Yihui Xie <a href="mailto:xie@yihui.name" class="email">xie@yihui.name</a></td>
<td align="left">A Gallery of Animations in Statistics and Utilities to Create Animations</td>
</tr>
<tr class="even">
<td align="left">blogdown</td>
<td align="left">Yihui Xie <a href="mailto:xie@yihui.name" class="email">xie@yihui.name</a></td>
<td align="left">Create Blogs and Websites with R Markdown</td>
</tr>
<tr class="odd">
<td align="left">bookdown</td>
<td align="left">Yihui Xie <a href="mailto:xie@yihui.name" class="email">xie@yihui.name</a></td>
<td align="left">Authoring Books and Technical Documents with R Markdown</td>
</tr>
<tr class="even">
<td align="left">DT</td>
<td align="left">Yihui Xie <a href="mailto:xie@yihui.name" class="email">xie@yihui.name</a></td>
<td align="left">A Wrapper of the JavaScript Library ‘DataTables’</td>
</tr>
<tr class="odd">
<td align="left">evaluate</td>
<td align="left">Yihui Xie <a href="mailto:xie@yihui.name" class="email">xie@yihui.name</a></td>
<td align="left">Parsing and Evaluation Tools that Provide More Details than the Default</td>
</tr>
<tr class="even">
<td align="left">formatR</td>
<td align="left">Yihui Xie <a href="mailto:xie@yihui.name" class="email">xie@yihui.name</a></td>
<td align="left">Format R Code Automatically</td>
</tr>
<tr class="odd">
<td align="left">fun</td>
<td align="left">Yihui Xie <a href="mailto:xie@yihui.name" class="email">xie@yihui.name</a></td>
<td align="left">Use R for Fun</td>
</tr>
<tr class="even">
<td align="left">highr</td>
<td align="left">Yihui Xie <a href="mailto:xie@yihui.name" class="email">xie@yihui.name</a></td>
<td align="left">Syntax Highlighting for R Source Code</td>
</tr>
<tr class="odd">
<td align="left">knitr</td>
<td align="left">Yihui Xie <a href="mailto:xie@yihui.name" class="email">xie@yihui.name</a></td>
<td align="left">A General-Purpose Package for Dynamic Report Generation in R</td>
</tr>
<tr class="even">
<td align="left">markdown</td>
<td align="left">Yihui Xie <a href="mailto:xie@yihui.name" class="email">xie@yihui.name</a></td>
<td align="left">‘Markdown’ Rendering for R</td>
</tr>
<tr class="odd">
<td align="left">mime</td>
<td align="left">Yihui Xie <a href="mailto:xie@yihui.name" class="email">xie@yihui.name</a></td>
<td align="left">Map Filenames to MIME Types</td>
</tr>
<tr class="even">
<td align="left">MSG</td>
<td align="left">Yihui Xie <a href="mailto:xie@yihui.name" class="email">xie@yihui.name</a></td>
<td align="left">Data and Functions for the Book Modern Statistical Graphics</td>
</tr>
<tr class="odd">
<td align="left">pagedown</td>
<td align="left">Yihui Xie <a href="mailto:xie@yihui.name" class="email">xie@yihui.name</a></td>
<td align="left">Paginate the HTML Output of R Markdown with CSS for Print</td>
</tr>
<tr class="even">
<td align="left">printr</td>
<td align="left">Yihui Xie <a href="mailto:xie@yihui.name" class="email">xie@yihui.name</a></td>
<td align="left">Automatically Print R Objects to Appropriate Formats According to the ‘knitr’ Output Format</td>
</tr>
<tr class="odd">
<td align="left">Rd2roxygen</td>
<td align="left">Yihui Xie <a href="mailto:xie@yihui.name" class="email">xie@yihui.name</a></td>
<td align="left">Convert Rd to ‘Roxygen’ Documentation</td>
</tr>
<tr class="even">
<td align="left">rmarkdown</td>
<td align="left">Yihui Xie <a href="mailto:xie@yihui.name" class="email">xie@yihui.name</a></td>
<td align="left">Dynamic Documents for R</td>
</tr>
<tr class="odd">
<td align="left">rticles</td>
<td align="left">Yihui Xie <a href="mailto:xie@yihui.name" class="email">xie@yihui.name</a></td>
<td align="left">Article Formats for R Markdown</td>
</tr>
<tr class="even">
<td align="left">servr</td>
<td align="left">Yihui Xie <a href="mailto:xie@yihui.name" class="email">xie@yihui.name</a></td>
<td align="left">A Simple HTTP Server to Serve Static Files or Dynamic Documents</td>
</tr>
<tr class="odd">
<td align="left">testit</td>
<td align="left">Yihui Xie <a href="mailto:xie@yihui.name" class="email">xie@yihui.name</a></td>
<td align="left">A Simple Package for Testing R Packages</td>
</tr>
<tr class="even">
<td align="left">tinytex</td>
<td align="left">Yihui Xie <a href="mailto:xie@yihui.name" class="email">xie@yihui.name</a></td>
<td align="left">Helper Functions to Install and Maintain ‘TeX Live’, and Compile ‘LaTeX’ Documents</td>
</tr>
<tr class="odd">
<td align="left">tufte</td>
<td align="left">Yihui Xie <a href="mailto:xie@yihui.name" class="email">xie@yihui.name</a></td>
<td align="left">Tufte’s Styles for R Markdown Documents</td>
</tr>
<tr class="even">
<td align="left">xaringan</td>
<td align="left">Yihui Xie <a href="mailto:xie@yihui.name" class="email">xie@yihui.name</a></td>
<td align="left">Presentation Ninja</td>
</tr>
<tr class="odd">
<td align="left">xfun</td>
<td align="left">Yihui Xie <a href="mailto:xie@yihui.name" class="email">xie@yihui.name</a></td>
<td align="left">Miscellaneous Functions by ‘Yihui Xie’</td>
</tr>
</tbody>
</table>
<p>接下来，我们想看看 R 包维护者数量有多少</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">subset</span>(pdb,
  <span class="dt">subset =</span> <span class="op">!</span><span class="kw">duplicated</span>(pdb[, <span class="st">&quot;Package&quot;</span>]),
  <span class="dt">select =</span> <span class="st">&quot;Maintainer&quot;</span>
) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unique</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">length</span>()
<span class="co">#&gt; [1] 8448</span></code></pre>
<p>可实际上没有这么多的开发者，因为存在这样的情况，以 R 包维护者 Hadley Wickham 为例，由于他曾使用过不同的邮箱，所以在维护者字段出现了不一致的情况，实际却是同一个人。</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">subset</span>(pdb,
  <span class="dt">subset =</span> <span class="kw">grepl</span>(<span class="st">&quot;Hadley Wickham&quot;</span>, pdb[, <span class="st">&quot;Maintainer&quot;</span>]),
  <span class="dt">select =</span> <span class="kw">c</span>(<span class="st">&quot;Package&quot;</span>, <span class="st">&quot;Maintainer&quot;</span>)
)
<span class="co">#&gt;       Package         Maintainer                              </span>
<span class="co">#&gt;  [1,] &quot;assertthat&quot;    &quot;Hadley Wickham &lt;hadley@rstudio.com&gt;&quot;   </span>
<span class="co">#&gt;  [2,] &quot;babynames&quot;     &quot;Hadley Wickham &lt;hadley@rstudio.com&gt;&quot;   </span>
<span class="co">#&gt;  [3,] &quot;bigrquery&quot;     &quot;Hadley Wickham &lt;hadley@rstudio.com&gt;&quot;   </span>
<span class="co">#&gt;  [4,] &quot;classifly&quot;     &quot;Hadley Wickham &lt;h.wickham@gmail.com&gt;&quot;  </span>
<span class="co">#&gt;  [5,] &quot;clusterfly&quot;    &quot;Hadley Wickham &lt;h.wickham@gmail.com&gt;&quot;  </span>
<span class="co">#&gt;  [6,] &quot;conflicted&quot;    &quot;Hadley Wickham &lt;hadley@rstudio.com&gt;&quot;   </span>
<span class="co">#&gt;  [7,] &quot;dbplyr&quot;        &quot;Hadley Wickham &lt;hadley@rstudio.com&gt;&quot;   </span>
<span class="co">#&gt;  [8,] &quot;dplyr&quot;         &quot;Hadley Wickham &lt;hadley@rstudio.com&gt;&quot;   </span>
<span class="co">#&gt;  [9,] &quot;ellipsis&quot;      &quot;Hadley Wickham &lt;hadley@rstudio.com&gt;&quot;   </span>
<span class="co">#&gt; [10,] &quot;feather&quot;       &quot;Hadley Wickham &lt;hadley@rstudio.com&gt;&quot;   </span>
<span class="co">#&gt; [11,] &quot;forcats&quot;       &quot;Hadley Wickham &lt;hadley@rstudio.com&gt;&quot;   </span>
<span class="co">#&gt; [12,] &quot;fueleconomy&quot;   &quot;&#39;Hadley Wickham&#39; &lt;h.wickham@gmail.com&gt;&quot;</span>
<span class="co">#&gt; [13,] &quot;ggplot2&quot;       &quot;Hadley Wickham &lt;hadley@rstudio.com&gt;&quot;   </span>
<span class="co">#&gt; [14,] &quot;ggplot2movies&quot; &quot;Hadley Wickham &lt;hadley@rstudio.com&gt;&quot;   </span>
<span class="co">#&gt; [15,] &quot;gtable&quot;        &quot;Hadley Wickham &lt;hadley@rstudio.com&gt;&quot;   </span>
<span class="co">#&gt; [16,] &quot;haven&quot;         &quot;Hadley Wickham &lt;hadley@rstudio.com&gt;&quot;   </span>
<span class="co">#&gt; [17,] &quot;hflights&quot;      &quot;Hadley Wickham &lt;h.wickham@gmail.com&gt;&quot;  </span>
<span class="co">#&gt; [18,] &quot;httr&quot;          &quot;Hadley Wickham &lt;hadley@rstudio.com&gt;&quot;   </span>
<span class="co">#&gt; [19,] &quot;lazyeval&quot;      &quot;Hadley Wickham &lt;hadley@rstudio.com&gt;&quot;   </span>
<span class="co">#&gt; [20,] &quot;lvplot&quot;        &quot;Hadley Wickham &lt;hadley@rstudio.com&gt;&quot;   </span>
<span class="co">#&gt; [21,] &quot;meifly&quot;        &quot;Hadley Wickham &lt;h.wickham@gmail.com&gt;&quot;  </span>
<span class="co">#&gt; [22,] &quot;modelr&quot;        &quot;Hadley Wickham &lt;hadley@rstudio.com&gt;&quot;   </span>
<span class="co">#&gt; [23,] &quot;nasaweather&quot;   &quot;&#39;Hadley Wickham&#39; &lt;h.wickham@gmail.com&gt;&quot;</span>
<span class="co">#&gt; [24,] &quot;nycflights13&quot;  &quot;Hadley Wickham &lt;hadley@rstudio.com&gt;&quot;   </span>
<span class="co">#&gt; [25,] &quot;pkgdown&quot;       &quot;Hadley Wickham &lt;hadley@rstudio.com&gt;&quot;   </span>
<span class="co">#&gt; [26,] &quot;plyr&quot;          &quot;Hadley Wickham &lt;hadley@rstudio.com&gt;&quot;   </span>
<span class="co">#&gt; [27,] &quot;productplots&quot;  &quot;Hadley Wickham &lt;hadley@rstudio.com&gt;&quot;   </span>
<span class="co">#&gt; [28,] &quot;profr&quot;         &quot;Hadley Wickham &lt;hadley@rstudio.com&gt;&quot;   </span>
<span class="co">#&gt; [29,] &quot;proto&quot;         &quot;Hadley Wickham &lt;hadley@rstudio.com&gt;&quot;   </span>
<span class="co">#&gt; [30,] &quot;pryr&quot;          &quot;Hadley Wickham &lt;hadley@rstudio.com&gt;&quot;   </span>
<span class="co">#&gt; [31,] &quot;rappdirs&quot;      &quot;Hadley Wickham &lt;hadley@rstudio.com&gt;&quot;   </span>
<span class="co">#&gt; [32,] &quot;reshape&quot;       &quot;Hadley Wickham &lt;hadley@rstudio.com&gt;&quot;   </span>
<span class="co">#&gt; [33,] &quot;reshape2&quot;      &quot;Hadley Wickham &lt;h.wickham@gmail.com&gt;&quot;  </span>
<span class="co">#&gt; [34,] &quot;rggobi&quot;        &quot;Hadley Wickham &lt;h.wickham@gmail.com&gt;&quot;  </span>
<span class="co">#&gt; [35,] &quot;roxygen2&quot;      &quot;Hadley Wickham &lt;hadley@rstudio.com&gt;&quot;   </span>
<span class="co">#&gt; [36,] &quot;rvest&quot;         &quot;Hadley Wickham &lt;hadley@rstudio.com&gt;&quot;   </span>
<span class="co">#&gt; [37,] &quot;scales&quot;        &quot;Hadley Wickham &lt;hadley@rstudio.com&gt;&quot;   </span>
<span class="co">#&gt; [38,] &quot;sloop&quot;         &quot;Hadley Wickham &lt;hadley@rstudio.com&gt;&quot;   </span>
<span class="co">#&gt; [39,] &quot;stringr&quot;       &quot;Hadley Wickham &lt;hadley@rstudio.com&gt;&quot;   </span>
<span class="co">#&gt; [40,] &quot;testthat&quot;      &quot;Hadley Wickham &lt;hadley@rstudio.com&gt;&quot;   </span>
<span class="co">#&gt; [41,] &quot;tidyr&quot;         &quot;Hadley Wickham &lt;hadley@rstudio.com&gt;&quot;   </span>
<span class="co">#&gt; [42,] &quot;tidyverse&quot;     &quot;Hadley Wickham &lt;hadley@rstudio.com&gt;&quot;   </span>
<span class="co">#&gt; [43,] &quot;vctrs&quot;         &quot;Hadley Wickham &lt;hadley@rstudio.com&gt;&quot;</span></code></pre>
<p>因此，有必要先把 Maintainer 字段中的邮箱部分去掉</p>
<pre class="sourceCode r"><code class="sourceCode r">clean_maintainer &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
  <span class="co"># 去掉邮箱</span>
  x &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;&lt;([^&lt;&gt;]*)&gt;&quot;</span>, <span class="st">&quot;&quot;</span>, x)
  <span class="co"># 去掉 \n \t \&#39; \&quot; 和 &#39;</span>
  x &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;(</span><span class="ch">\\\n</span><span class="st">)|(</span><span class="ch">\\\t</span><span class="st">)|(</span><span class="ch">\\\&quot;</span><span class="st">)|(</span><span class="ch">\\\&#39;</span><span class="st">)|(&#39;)&quot;</span>, <span class="st">&quot;&quot;</span>, x)
  <span class="co"># 去掉末尾空格</span>
  x &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot; +$&quot;</span>, <span class="st">&quot;&quot;</span>, x)
}</code></pre>
<p>这样我们可以得到比较靠谱的R包维护者数量了！</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 去重之后</span>
cran_maintainers &lt;-<span class="st"> </span><span class="kw">subset</span>(pdb,
  <span class="dt">subset =</span> <span class="op">!</span><span class="kw">duplicated</span>(pdb[, <span class="st">&quot;Package&quot;</span>]),
  <span class="dt">select =</span> <span class="st">&quot;Maintainer&quot;</span>
) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">lapply</span>(clean_maintainer) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># 清理 Maintainer 字段</span>
<span class="st">  </span><span class="kw">unlist</span>() <span class="co"># 列表转成字符串向量</span>
cran_maintainers <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unique</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># 去重</span>
<span class="st">  </span><span class="kw">length</span>()
<span class="co">#&gt; [1] 7828</span></code></pre>
<p>接下来，我们还想把 R 包维护者，按照其维护的R包数量排个序，用条形图<a href="15-data-visualization-with-ggplot2.html#fig:top-maintainers">14.39</a> 表示</p>
<pre class="sourceCode r"><code class="sourceCode r">myData &lt;-<span class="st"> </span>cran_maintainers <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">table</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># 按照维护者分组计数</span>
<span class="st">  </span><span class="kw">sort</span>(<span class="dt">decreasing =</span> T) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># 降序排列</span>
<span class="st">  </span><span class="kw">head</span>(<span class="dv">20</span>) <span class="co"># 取 Top 20</span>
<span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">7</span>, <span class="dv">1</span>, <span class="dv">1</span>))
barCenters &lt;-<span class="st"> </span><span class="kw">barplot</span>(myData,
  <span class="dt">col =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>,
  <span class="dt">axisnames =</span> <span class="ot">FALSE</span>, <span class="dt">horiz =</span> <span class="ot">TRUE</span>, <span class="dt">border =</span> <span class="st">&quot;white&quot;</span>
)
<span class="kw">text</span>(
  <span class="dt">y =</span> barCenters, <span class="dt">x =</span> <span class="kw">par</span>(<span class="st">&quot;usr&quot;</span>)[<span class="dv">3</span>],
  <span class="dt">adj =</span> <span class="dv">1</span>, <span class="dt">labels =</span> <span class="kw">names</span>(myData), <span class="dt">xpd =</span> <span class="ot">TRUE</span>
)
<span class="kw">axis</span>(<span class="dv">1</span>,
  <span class="dt">labels =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">90</span>, <span class="dt">by =</span> <span class="dv">10</span>), <span class="dt">at =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">90</span>, <span class="dt">by =</span> <span class="dv">10</span>),
  <span class="dt">las =</span> <span class="dv">1</span>, <span class="dt">col =</span> <span class="st">&quot;gray&quot;</span>
)
<span class="kw">grid</span>()</code></pre>
<div class="figure" style="text-align: center"><span id="fig:top-maintainers"></span>
<img src="15-data-visualization-with-ggplot2_files/figure-html/top-maintainers-1.png" alt="维护R包数量最多的20个人39" width="55%" />
<p class="caption">
图 14.39: 维护R包数量最多的20个人<a href="#fn39" class="footnote-ref" id="fnref39"><sup>39</sup></a>
</p>
</div>
<p>调用 ggplot2 包绘图要求输入的数据类型是 data.frame，所以我们首先将 myData 转化为数据框类型</p>
<pre class="sourceCode r"><code class="sourceCode r">myData &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(myData)
<span class="kw">colnames</span>(myData) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Maintainer&quot;</span>, <span class="st">&quot;Freq&quot;</span>)
<span class="kw">ggplot</span>(myData) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Maintainer, <span class="dt">y =</span> Freq), <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Maintainer&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Numbers of Package&quot;</span>)</code></pre>
<p><img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-68-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>条形图在柱子很多的情况下，点线图是一种更加简洁的替代方式</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(myData, <span class="kw">aes</span>(<span class="dt">x =</span> Freq, <span class="dt">y =</span> Maintainer)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_segment</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="dv">20</span>, <span class="dt">xend =</span> Freq, <span class="dt">yend =</span> Maintainer), <span class="dt">colour =</span> <span class="st">&quot;grey50&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot; # of Packages &quot;</span>, <span class="dt">y =</span> <span class="st">&quot; Maintainer &quot;</span>)</code></pre>
<p><img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-69-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>接下来，我们想看看开发者维护的 R 包数量的分布，仅从上图，我们知道有的人能维护 80 多个 R 包，总体的分布情况又是如何呢？如图所示，我们将纵轴刻度设置为 log 模式，随着开发的R包数量的增加，开发者人数是指数级递减，可见开发R包依然是一个门槛很高的工作！</p>
<pre class="sourceCode r"><code class="sourceCode r">cran_maintainers <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">table</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>table <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">barplot</span>(<span class="dt">col =</span> <span class="st">&quot;lightblue&quot;</span>, <span class="dt">log =</span> <span class="st">&quot;y&quot;</span>, <span class="dt">border =</span> <span class="st">&quot;white&quot;</span>, 
          <span class="dt">xlab =</span> <span class="st">&quot;# of Packages&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;# of Maintainers (log)&quot;</span>,
          <span class="dt">panel.first =</span> <span class="kw">grid</span>())</code></pre>
<p><img src="15-data-visualization-with-ggplot2_files/figure-html/unnamed-chunk-70-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>只开发一个 R 包的人数达到 5276 人，占开发者总数的 67.31%，约为2/3。我们还想进一步了解这些人是不是就自己开发自己维护，没有其他人参与，而且他们也不参与其它 R 包的贡献？如果是，则他们对社区的贡献非常有限，仅限于为社区带来数量上的堆积！那么社区的主要推动者是余下的 1/3，他们相互之间的合作应该比较多，我们接下来想分析一下他们之间的贡献网络。</p>

<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 为这张图寻求一个完美的解释</span>
<span class="co"># 每天更新的 R包数量随日期的分布，发布数量最多的日期，好好想想是不是这样</span>
largest_update_num &lt;-<span class="st"> </span><span class="kw">sort</span>(<span class="kw">table</span>(pdb<span class="op">$</span>Published), <span class="dt">decreasing =</span> T)[<span class="dv">1</span>]
smallest_update_num &lt;-<span class="st"> </span><span class="kw">sort</span>(<span class="kw">table</span>(pdb<span class="op">$</span>Published), <span class="dt">decreasing =</span> F)[<span class="dv">1</span>]
pdb_df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(pdb)
<span class="kw">ggplot</span>(pdb_df[, <span class="kw">c</span>(<span class="st">&quot;Package&quot;</span>, <span class="st">&quot;Published&quot;</span>)], <span class="kw">aes</span>(<span class="kw">as.Date</span>(Published))) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">color =</span> <span class="st">&quot;firebrick&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(
    <span class="dt">data =</span> <span class="kw">data.frame</span>(
      <span class="dt">date =</span> <span class="kw">as.Date</span>(<span class="kw">c</span>(<span class="st">&quot;2011-01-01&quot;</span>, <span class="st">&quot;2012-10-20&quot;</span>)),
      <span class="dt">count =</span> <span class="kw">c</span>(<span class="dv">130</span>, <span class="dv">155</span>)
    ), <span class="kw">aes</span>(<span class="dt">x =</span> date, <span class="dt">y =</span> count),
    <span class="dt">arrow =</span> <span class="kw">arrow</span>(<span class="dt">angle =</span> <span class="dv">15</span>, <span class="dt">length =</span> <span class="kw">unit</span>(<span class="fl">0.15</span>, <span class="st">&quot;inches&quot;</span>))
  ) <span class="op">+</span>
<span class="st">  </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="kw">as.Date</span>(<span class="st">&quot;2010-11-01&quot;</span>), <span class="dt">y =</span> <span class="dv">128</span>, <span class="dt">label =</span> <span class="st">&quot;(2012-10-29,172)&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_date</span>(<span class="dt">date_breaks =</span> <span class="st">&quot;1 year&quot;</span>, <span class="dt">date_labels =</span> <span class="st">&quot;%Y&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Published Date&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Count&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_minimal</span>()</code></pre>
</div>
<div id="ggplot2-session-info" class="section level2">
<h2><span class="header-section-number">14.6</span> 软件信息</h2>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sessionInfo</span>()
<span class="co">#&gt; R version 3.6.0 (2019-04-26)</span>
<span class="co">#&gt; Platform: x86_64-w64-mingw32/x64 (64-bit)</span>
<span class="co">#&gt; Running under: Windows 8.1 x64 (build 9600)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Matrix products: default</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; locale:</span>
<span class="co">#&gt; [1] LC_COLLATE=Chinese (Simplified)_China.936 </span>
<span class="co">#&gt; [2] LC_CTYPE=Chinese (Simplified)_China.936   </span>
<span class="co">#&gt; [3] LC_MONETARY=Chinese (Simplified)_China.936</span>
<span class="co">#&gt; [4] LC_NUMERIC=C                              </span>
<span class="co">#&gt; [5] LC_TIME=Chinese (Simplified)_China.936    </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attached base packages:</span>
<span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; other attached packages:</span>
<span class="co">#&gt;  [1] hexbin_1.27.3    maptools_0.9-5   sp_1.3-1         stars_0.3-1     </span>
<span class="co">#&gt;  [5] sf_0.7-4         abind_1.4-5      ggthemes_4.2.0   mapdata_2.3.0   </span>
<span class="co">#&gt;  [9] gridExtra_2.3    colormap_0.1.4   maps_3.3.0       colorspace_1.4-1</span>
<span class="co">#&gt; [13] nlme_3.1-140     forcats_0.4.0    stringr_1.4.0    dplyr_0.8.1     </span>
<span class="co">#&gt; [17] purrr_0.3.2      readr_1.3.1      tidyr_0.8.3      tibble_2.1.2    </span>
<span class="co">#&gt; [21] ggplot2_3.1.1    tidyverse_1.2.1 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; loaded via a namespace (and not attached):</span>
<span class="co">#&gt;  [1] Rcpp_1.0.1         lubridate_1.7.4    lattice_0.20-38   </span>
<span class="co">#&gt;  [4] class_7.3-15       assertthat_0.2.1   digest_0.6.19     </span>
<span class="co">#&gt;  [7] V8_2.2             R6_2.4.0           cellranger_1.1.0  </span>
<span class="co">#&gt; [10] plyr_1.8.4         backports_1.1.4    evaluate_0.14     </span>
<span class="co">#&gt; [13] e1071_1.7-1        highr_0.8          httr_1.4.0        </span>
<span class="co">#&gt; [16] pillar_1.4.1       rlang_0.3.4        lazyeval_0.2.2    </span>
<span class="co">#&gt; [19] curl_3.3           readxl_1.3.1       rstudioapi_0.10   </span>
<span class="co">#&gt; [22] rmarkdown_1.13     foreign_0.8-71     munsell_0.5.0     </span>
<span class="co">#&gt; [25] broom_0.5.2        compiler_3.6.0     modelr_0.1.4      </span>
<span class="co">#&gt; [28] xfun_0.7           pkgconfig_2.0.2    htmltools_0.3.6   </span>
<span class="co">#&gt; [31] tidyselect_0.2.5   bookdown_0.11      codetools_0.2-16  </span>
<span class="co">#&gt; [34] crayon_1.3.4       withr_2.1.2        grid_3.6.0        </span>
<span class="co">#&gt; [37] jsonlite_1.6       gtable_0.3.0       DBI_1.0.0         </span>
<span class="co">#&gt; [40] magrittr_1.5       units_0.6-3        scales_1.0.0      </span>
<span class="co">#&gt; [43] KernSmooth_2.23-15 cli_1.1.0          stringi_1.4.3     </span>
<span class="co">#&gt; [46] xml2_1.2.0         generics_0.0.2     tools_3.6.0       </span>
<span class="co">#&gt; [49] glue_1.3.1         hms_0.4.2          parallel_3.6.0    </span>
<span class="co">#&gt; [52] yaml_2.2.0         classInt_0.3-3     rvest_0.3.4       </span>
<span class="co">#&gt; [55] knitr_1.23         haven_2.1.0</span></code></pre>

</div>
</div>
<h3>参考文献</h3>
<div id="refs" class="references">
<div id="ref-ICWSM_2009_Gephi">
<p>Bastian, Mathieu, Sebastien Heymann, and Mathieu Jacomy. 2009. “Gephi: An Open Source Software for Exploring and Manipulating Networks.” <a href="http://www.aaai.org/ocs/index.php/ICWSM/09/paper/view/154">http://www.aaai.org/ocs/index.php/ICWSM/09/paper/view/154</a>.</p>
</div>
<div id="ref-Pebesma_2005_sp">
<p>Pebesma, Edzer J., and Roger S. Bivand. 2005. “Classes and Methods for Spatial Data in R.” <em>R News</em> 5 (2): 9–13. <a href="https://cran.r-project.org/doc/Rnews/Rnews_2005-2.pdf">https://cran.r-project.org/doc/Rnews/Rnews_2005-2.pdf</a>.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="33">
<li id="fn33"><p><a href="http://varianceexplained.org/r/why-I-use-ggplot2/" class="uri">http://varianceexplained.org/r/why-I-use-ggplot2/</a><a href="15-data-visualization-with-ggplot2.html#fnref33" class="footnote-back">↩</a></p></li>
<li id="fn34"><p><a href="https://simplystatistics.org/2016/02/11/why-i-dont-use-ggplot2/" class="uri">https://simplystatistics.org/2016/02/11/why-i-dont-use-ggplot2/</a><a href="15-data-visualization-with-ggplot2.html#fnref34" class="footnote-back">↩</a></p></li>
<li id="fn35"><p><a href="https://github.com/ricardo-bion/medium_visualization" class="uri">https://github.com/ricardo-bion/medium_visualization</a><a href="15-data-visualization-with-ggplot2.html#fnref35" class="footnote-back">↩</a></p></li>
<li id="fn36"><p><a href="https://leonawicz.github.io/" class="uri">https://leonawicz.github.io/</a><a href="15-data-visualization-with-ggplot2.html#fnref36" class="footnote-back">↩</a></p></li>
<li id="fn37"><p><a href="https://mbostock.github.io/protovis/ex/crimea-rose-full.html" class="uri">https://mbostock.github.io/protovis/ex/crimea-rose-full.html</a><a href="15-data-visualization-with-ggplot2.html#fnref37" class="footnote-back">↩</a></p></li>
<li id="fn38"><p>现在有更加方便的方式获取 R 包元数据 <code>pdb &lt;- tools::CRAN_package_db()</code> 返回一个 data.frame<a href="15-data-visualization-with-ggplot2.html#fnref38" class="footnote-back">↩</a></p></li>
<li id="fn39"><p>其中 Orphaned 表示之前的R包维护者不愿意继续维护了，后来有人接手维护，Orphaned 表示这一类接盘侠<a href="15-data-visualization-with-ggplot2.html#fnref39" class="footnote-back">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="14-data-visualization-with-plot3d.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="16-data-visualization-with-colors-fonts.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": {}
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/XiangyunHuang/RGraphics/edit/master/15-data-visualization-with-ggplot2.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["RGraphics.pdf", "RGraphics.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
