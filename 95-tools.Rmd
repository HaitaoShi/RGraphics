# 软件工具 {#software-tools}

## 版本控制 {#version-control}

只考虑 Ubuntu 18.04 环境

三剑客 Git & Github & Gitlab

1. 安装[^install-git]

   ```bash
   sudo add-apt-repository -y ppa:git-core/ppa
   sudo apt update && sudo apt install git
   ```

1. 配置

   ```bash
   git config --global user.name "Your Name Comes Here"
   git config --global user.email you@yourdomain.example.com
   ```

Git 使用的数据库

[^install-git]: 官网安装指导 https://git-scm.com/download/linux 

## 动态文档 {#dynamic-documents}

三剑客 Markdown & Pandoc's Markdown & R Markdown

Pandoc 是一个万能文档转化器

1. 安装 calibre

   ```bash
   sudo -v && wget -nv -O- https://download.calibre-ebook.com/linux-installer.sh | sudo sh /dev/stdin
   ```

   calibre 可以将 epub 格式电子书文档转化为 mobi 格式，bookdown 已经给这个工具穿上了一件马甲，所以用户只需调用 `bookdown::calibre` 函数即可。

1. 安装 pandoc

   ```bash
   sudo apt-get install gdebi-core
   wget https://github.com/jgm/pandoc/releases/download/2.2.2/pandoc-2.2.2-1-amd64.deb
   sudo chmod +x pandoc-2.2.2-1-amd64.deb
   sudo gdebi pandoc-2.2.2-1-amd64.deb
   ```
   
   rmarkdown 包裹了 Pandoc 工具，所以使用 `rmarkdown::render` 函数，即可将 R Markdown 文档转化为 HTML、LaTeX 和 Markdown 等格式。

### Markdown

Markdown 基础语法见 RStudio IDE自带的手册 Markdown Quick Reference，这里主要介绍一下Markdown高级语法，特别是 Pandoc's Markdown^[Pandoc 提供了很多对 Markdown 的扩展支持]表格、图片和公式的使用

- 表格

插入表格很简单的，如表 \@ref(tab:insert-tab) 所示，还带脚注哦

Table: (\#tab:insert-tab) A table caption^[With a footnote]

| First Header | Second Header |
| :----------- | :------------ |
| Content Cell | Content Cell  |
| Content Cell | Content Cell  |

- 图片

插入图片也很简单的，所示，图、表的标题很长或者需要插入脚注，可以使用[文本引用][text-references]

```{r knitr-footnote, fig.cap='(ref:footnote)', out.width="45%", echo=FALSE}
knitr::include_graphics(path = "figures/mai.png")
```

(ref:footnote) caption 插入 footnote 但是 ebooks 不支持这样插入脚注[^longnote]

[^longnote]: Here's one with multiple blocks.

[text-references]: https://bookdown.org/yihui/bookdown/markdown-extensions-by-bookdown.html#text-references

- 公式

行内公式一对美元符号 $\alpha$ 或者 \(\alpha+\beta\)，行间公式 $$\alpha$$ 或者 \[\alpha + \beta\]

对公式编号，如公式 \@ref(eq:likelihood)

\begin{equation}
L(\beta,\boldsymbol{\theta}) = f(y;\beta,\boldsymbol{\theta}) = \int_{\mathbb{R}^{n}}N(t;D\beta,\Sigma(\boldsymbol{\theta}))f(y|t)dt (\#eq:likelihood)
\end{equation}

多行公式分别编号，如公式\@ref(eq:BL-SGLMM) 和公式\@ref(eq:Poss-SGLMM) 

\begin{align}
\log\{\frac{p_i}{1-p_i}\} & = T_{i} = d(x_i)'\beta + S(x_i) + Z_i (\#eq:BL-SGLMM)\\
\log(\lambda_i)           & = T_{i} = d(x_i)'\beta + S(x_i) + Z_i (\#eq:Poss-SGLMM)
\end{align}

多行公式中对某一（些）行编号，如公式 \@ref(eq:align) 和 公式 \@ref(eq:Poss-SGLMM2)

\begin{align} 
g(X_{n}) &= g(\theta)+g'({\tilde{\theta}})(X_{n}-\theta) \\
\sqrt{n}[g(X_{n})-g(\theta)] &= g'\left({\tilde{\theta}}\right) 
  \sqrt{n}[X_{n}-\theta ] (\#eq:align) \\
\log(\lambda_i)  & = T_{i} = d(x_i)'\beta + S(x_i) + Z_i (\#eq:Poss-SGLMM2)  
\end{align} 

多行公式共用一个编号，如公式 \@ref(eq:likelihood2)

\begin{equation}
\begin{aligned}
L(\beta,\boldsymbol{\theta})
& = \int_{\mathbb{R}^{n}} \frac{N(t;D\beta,\Sigma(\boldsymbol{\theta}))f(y|t)}{N(t;D\beta_{0},\Sigma(\boldsymbol{\theta}_{0}))f(y|t)}f(y,t)dt\\
& \varpropto \int_{\mathbb{R}^{n}} \frac{N(t;D\beta,\Sigma(\boldsymbol{\theta}))}{N(t;D\beta_{0},\Sigma(\boldsymbol{\theta}_{0}))}f(t|y)dt \\
&= E_{T|y}\left[\frac{N(t;D\beta,\Sigma(\boldsymbol{\theta}))}{N(t;D\beta_{0},\Sigma(\boldsymbol{\theta}_{0}))}\right] 
\end{aligned}
(\#eq:likelihood2)
\end{equation}

推荐在 `equation` 公式中，使用 `split` 环境，意思是一个公式很长，需要拆成多行，如公式\@ref(eq:var-beta)

\begin{equation} 
\begin{split}
\mathrm{Var}(\hat{\beta}) & =\mathrm{Var}((X'X)^{-1}X'y)\\
 & =(X'X)^{-1}X'\mathrm{Var}(y)((X'X)^{-1}X')'\\
 & =(X'X)^{-1}X'\mathrm{Var}(y)X(X'X)^{-1}\\
 & =(X'X)^{-1}X'\sigma^{2}IX(X'X)^{-1}\\
 & =(X'X)^{-1}\sigma^{2}
\end{split}
(\#eq:var-beta)
\end{equation} 

注意，`\mathbf` 只对字母 $a,b,c,A,B,C$ 加粗，mathjax 不支持公式中使用 `\bm` 对 $\theta,\alpha,\beta,\ldots,\gamma$ 加粗，应该使用 `\boldsymbol`

### bookdown

The **bookdown** package can be installed from CRAN or Github:

`par()` 图形版面设置，如图\@ref(fig:par) 所示


```{r par,fig.cap="图形参数设置",fig.subcap=c("单图环境","多图环境"),out.width="33%",echo=FALSE, fig.link='https://github.com/rstudio/rmarkdown'}
knitr::include_graphics(path = c("figures/mai.png","figures/mai.png"))
```


```{r eval=FALSE}
install.packages("bookdown")
# or the development version
# devtools::install_github("rstudio/bookdown")
```

Remember each Rmd file contains one and only one chapter, and a chapter is defined by the first-level heading `#`.

通过 <https://bookdown.org/> 发布书籍

### TinyTeX

如何编译获取电子版，拉取镜像，安装缺失的依赖

```bash
docker run --name book -d -p 8282:8787 -e ROOT=TRUE \
 -e USER=rstudio -e PASSWORD=cloud rocker/geospatial
```

为方便起见，建议选择就近的站点

```bash
tlmgr option repository https://mirrors.tuna.tsinghua.edu.cn/CTAN/systems/texlive/tlnet
echo 'options(repos = c(CRAN = "https://mirrors.tuna.tsinghua.edu.cn/CRAN"))' > ~/.Rprofile.site
```

安装软件

```bash
sudo apt-get install libgit2-dev libssh2-1-dev libglu1-mesa-dev libfreetype6-dev
libxpm-dev libx11-dev libxaw7-dev tk-dev tcl-dev graphviz-dev 
# for asy
libosmesa6 libosmesa6-dev freeglut3 freeglut3-dev phantomjs
# gobjc-5 glibc-source
./configure --enable-memory-profiling 
sudo apt-get install imagemagick optipng ghostscript fonts-liberation graphviz
```

imagemagick 用于格式转化，optipng 用于 png 格式的图片优化，ghostscript 字体处理

然后安装 TeX 包

```r
tinytex::tlmgr_install(pkgs = c(
  "ctex", "ms", "xecjk", "ulem"
  , "environ", "trimspaces", "zhnumber"
  , "fandol", "filehook", "xcolor", "colortbl"
  , "jknapltx", "lm-math", "rsfs", "pdfcrop", "subfig"
))
```

我用了两个 R 包编译这本书，分别是 **knitr**\index{knitr}  和 **bookdown**\index{bookdown}。



## 集成开发环境 {#ide}

RStudio 开源桌面版 & RStudio Server 开源服务器版 & RStudio Shiny Server 开源服务器版

## 容器 {#container}

Docker & 容器管理工具 Docker Swarm

### Docker

Docker & Docker Machine & Docker Swarm

```bash
docker --version
# Docker version 18.03.0-ce, build 0520e24302
```

### Docker Machine

开源贡献站点 https://github.com/docker/machine

基本命令

* 查看 docker machine 版本信息

   ```{r,engine="bash",eval=FALSE,echo=TRUE}
   docker-machine --version
   # docker-machine.exe version 0.14.0, build 89b8332
   ```

* 列出创建的虚拟机

   ```{r, engine = "bash",eval=FALSE,echo=TRUE}
   # 启动前
   docker-machine ls
   # NAME      ACTIVE   DRIVER       STATE     URL   SWARM   DOCKER    ERRORS
   # default   -        virtualbox   Stopped                 Unknown
   # 启动后
   docker-machine ls
   # NAME      ACTIVE   DRIVER       STATE     URL                         SWARM   DOCKER        ERRORS
   # default   *        virtualbox   Running   tcp://192.168.99.100:2376           v18.03.0-ce
   ```

* 查看虚拟机 default 的 ip

   ```{r, engine = "bash",eval=FALSE,echo=TRUE}
   docker-machine ip default
   # 192.168.99.100
   ```

* 启动虚拟机

   ```{r, engine = "bash",eval=FALSE,echo=TRUE}
   docker-machine start default
   # Starting "default"...
   # (default) Check network to re-create if needed...
   # (default) Windows might ask for the permission to configure a dhcp server. Sometimes, such confirmation window is minimized in the taskbar.
   # (default) Waiting for an IP...
   # Machine "default" was started.
   # Waiting for SSH to be available...
   # Detecting the provisioner...
   # Started machines may have new IP addresses. You may need to re-run the `docker-machine env` command.
   ```

* 查看虚拟机 default 的环境

   ```{r, engine = "bash",eval=FALSE,echo=TRUE}
   docker-machine env default
   # export DOCKER_TLS_VERIFY="1"
   # export DOCKER_HOST="tcp://192.168.99.100:2376"
   # export DOCKER_CERT_PATH="D:\Docker\machines\default"
   # export DOCKER_MACHINE_NAME="default"
   # export COMPOSE_CONVERT_WINDOWS_PATHS="true"
   # # Run this command to configure your shell:
   # # eval $("C:\Program Files\Docker Toolbox\docker-machine.exe" env default)
   ```

* 关闭虚拟机 default

   ```{r, engine = "bash",eval=FALSE,echo=TRUE}
   docker-machine stop default
   # Stopping "default"...
   # Machine "default" was stopped.
   ```


帮助文档 https://docs.docker.com/machine/get-started



### Docker Swarm

### Kubernetes (k8s)

## 数据库 {#database}
