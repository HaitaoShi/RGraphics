# 字符串操作 II {#string-manipulation-with-stringr}

相比于第\@ref(string-manipulation)章，本章主要介绍字符串处理 stringr 包以及一些高级应用。


[Handling Strings with R](https://www.gastonsanchez.com/r4strings/) 和 [Text Mining with R A Tidy Approach](https://www.tidytextmining.com/) 字符串入门介绍 [R for Data Science](https://r4ds.had.co.nz/strings.html)

[stringr](https://stringr.tidyverse.org/) 基于 [stringi](https://github.com/gagolews/stringi) 包字符串处理包， [re2r](https://github.com/qinwf/re2r/) 包基于 Google 开发的 C++ 库 [re2](https://github.com/google/re2)，Google 编程之夏项目提供了一份 [正则表达式性能综述](https://github.com/rstats-gsoc/gsoc2016/wiki/re2-regular-expressions)

- [正则表达式速查表 Python3](https://www.dataquest.io/blog/large_files/python-regular-expressions-cheat-sheet.pdf)
- [Online regex tester and debugger](https://regex101.com/)
- [Python Regular expression operations](https://docs.python.org/3/library/re.html)
- [janitor](https://github.com/sfirke/janitor)
- [Manipulating strings with the stringr package](https://www.brodrigues.co/blog/2019-02-10-stringr_package/)


## 处理性能 {#performance}

当你对一个很长的字符串进行大量的正则表达式匹配的时候，你需要考虑性能问题了，这时候该考虑启用合适的选项，一般来讲， PCRE 比默认的正则表达式引擎快，`fixed=TRUE` 可以继续加快匹配速度，特别是当每个模式只匹配少量次数时。

连接字符串，`paste/c/bfile/bracket` 函数性能比较
<https://wch.github.io/string_builder/index.html>

基于 PCRE 的匹配

`options` 默认控制 PCRE 的三个选项 `PCRE_limit_recursion=NA` 、`PCRE_study=10` 和 `PCRE_use_JIT=TRUE`

看看本系统环境下 PCRE 的支持情况

```{r,echo=TRUE}
pcre_config()
```

查看系统的PCRE配置

```{r,echo=TRUE}
sapply(c("PCRE_limit_recursion", "PCRE_study", "PCRE_use_JIT"), getOption)
```


## 网络爬虫 {#Web-crawler}

用 R 语言写爬虫 curl、 xml2 、RCurl、 XML 和 rvest 解析网页

libcurl 库的版本

```{r,echo=TRUE}
libcurlVersion()
```

## 文本挖掘 {#text-mining}

[How did Axios rectangle Trump's PDF schedule? A try with R](https://masalmon.eu/2019/02/11/trump-schedule/) 使用 pdftools 和 magick 处理表格，这两个R包分别依赖 Poppler C++ 和 ImageMagick++

如何在 Ubuntu 18.04 上安装 `poppler >= 0.73` [^install-poppler]

[^install-poppler]: https://askubuntu.com/questions/1112856

PDF 表格抽取工具 [tabulizer](https://github.com/ropensci/tabulizer)

在 Ubuntu 上安装 pdftools 和 magick

```bash
sudo apt-get install libpoppler-cpp-dev libmagick++-dev
```

```{r,echo=TRUE,eval=FALSE}
install.packages(c("pdftools", "magick"))
```

OCR 扫描 PDF 文字识别 tesseract
  
